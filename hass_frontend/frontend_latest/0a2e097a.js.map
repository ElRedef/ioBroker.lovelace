{"version":3,"file":"0a2e097a.js","mappings":";;;;;;;;;AAuBA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC6EA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACsCA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACpFA;ACNA;;;AAGA;;;;AAMA;;AAEA;;;;AAIA;;;AAKA;;;;AAIA;;;;;AAKA;;;AAIA;;AAGA;AAGA;;AAIA;;AAIA;;AAIA;;;;AAMA;;AAIA;;AAIA;AAGA;;AAIA;;AAIA;;;AAIA;AAEA;AACA;AACA;AACA;;AAGA;;AAGA;;AAEA;;;AAGA;;;AAKA;;AAGA;;;AAIA;AACA;AACA;;;AAGA;;;AAGA;AAEA;;AA7IA;;AAiMA;;AAEA;;AAEA;;;AAGA;;AAEA;AACA;;;AA3MA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;;ACqBA;;AAIA;;;AAIA;;AAIA;AAKA;AACA;;;AASA;;;;AAMA;;;AAGA;;AAIA;;;AAKA;;;AAIA;;;;;;AAQA;AACA;;AAEA;;AAGA;;;;;;AAOA;AAEA;;;AAIA;;;AAKA;;;;AAIA;AACA;;AAEA;AAEA;;;;;AAMA;AAEA;;;AAIA;;AAEA;AACA;AACA;AACA;;;;AAIA;AAEA;;;AAIA;;;AAKA;;;;AAIA;AACA;;;AAGA;;;AAKA;;;;;AAOA;;AAGA;;AAEA;;;AAMA;;;AAGA;;AAEA;;;AAKA;AAEA;;;AA1LA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACkCA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACmCA;;;ACvEA;;;;AAIA;;;;;;AAMA;;AAEA;AAEA;;;;;;;AAzBA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACoYA","sources":["webpack://home-assistant-frontend/./src/components/buttons/ha-call-service-button.js","webpack://home-assistant-frontend/./src/layouts/ha-app-layout.js","webpack://home-assistant-frontend/./src/panels/config/integrations/integration-panels/zwave/zwave-groups.js","webpack://home-assistant-frontend/./src/panels/config/integrations/integration-panels/zwave/zwave-log.js","webpack://home-assistant-frontend/./src/panels/config/integrations/integration-panels/zwave/zwave-network.ts","webpack://home-assistant-frontend/./src/panels/config/integrations/integration-panels/zwave/zwave-node-config.ts","webpack://home-assistant-frontend/./src/panels/config/integrations/integration-panels/zwave/zwave-node-protection.js","webpack://home-assistant-frontend/./src/panels/config/integrations/integration-panels/zwave/zwave-usercodes.js","webpack://home-assistant-frontend/./src/panels/config/integrations/integration-panels/zwave/zwave-values.ts","webpack://home-assistant-frontend/./src/panels/config/integrations/integration-panels/zwave/ha-config-zwave.js"],"sourcesContent":["import { html } from \"@polymer/polymer/lib/utils/html-tag\";\n/* eslint-plugin-disable lit */\nimport { PolymerElement } from \"@polymer/polymer/polymer-element\";\nimport { showConfirmationDialog } from \"../../dialogs/generic/show-dialog-box\";\nimport { EventsMixin } from \"../../mixins/events-mixin\";\nimport \"./ha-progress-button\";\n\n/*\n * @appliesMixin EventsMixin\n */\nclass HaCallServiceButton extends EventsMixin(PolymerElement) {\n  static get template() {\n    return html`\n      <ha-progress-button\n        id=\"progress\"\n        progress=\"[[progress]]\"\n        on-click=\"buttonTapped\"\n        tabindex=\"0\"\n        ><slot></slot\n      ></ha-progress-button>\n    `;\n  }\n\n  static get properties() {\n    return {\n      hass: {\n        type: Object,\n      },\n\n      progress: {\n        type: Boolean,\n        value: false,\n      },\n\n      domain: {\n        type: String,\n      },\n\n      service: {\n        type: String,\n      },\n\n      serviceData: {\n        type: Object,\n        value: {},\n      },\n\n      confirmation: {\n        type: String,\n      },\n    };\n  }\n\n  callService() {\n    this.progress = true;\n    // eslint-disable-next-line @typescript-eslint/no-this-alias\n    const el = this;\n    const eventData = {\n      domain: this.domain,\n      service: this.service,\n      serviceData: this.serviceData,\n    };\n\n    this.hass\n      .callService(this.domain, this.service, this.serviceData)\n      .then(\n        () => {\n          el.progress = false;\n          el.$.progress.actionSuccess();\n          eventData.success = true;\n        },\n        () => {\n          el.progress = false;\n          el.$.progress.actionError();\n          eventData.success = false;\n        }\n      )\n      .then(() => {\n        el.fire(\"hass-service-called\", eventData);\n      });\n  }\n\n  buttonTapped() {\n    if (this.confirmation) {\n      showConfirmationDialog(this, {\n        text: this.confirmation,\n        confirm: () => this.callService(),\n      });\n    } else {\n      this.callService();\n    }\n  }\n}\n\ncustomElements.define(\"ha-call-service-button\", HaCallServiceButton);\n","/* eslint-plugin-disable lit */\n/**\n@license\nCopyright (c) 2015 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\nThe complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\nThe complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\nCode distributed by Google as part of the polymer project is also\nsubject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\n*/\n/*\nThis code is copied from app-header-layout.\n'fullbleed' support is removed as Home Assisstant doesn't use it.\ntransform: translate(0) is added.\n*/\n/*\n  FIXME(polymer-modulizer): the above comments were extracted\n  from HTML and may be out of place here. Review them and\n  then delete this comment!\n*/\nimport \"@polymer/app-layout/app-header-layout/app-header-layout\";\nimport { html } from \"@polymer/polymer/lib/utils/html-tag\";\nimport \"@polymer/polymer/polymer-element\";\n\nclass HaAppLayout extends customElements.get(\"app-header-layout\") {\n  static get template() {\n    return html`\n      <style>\n        :host {\n          display: block;\n          /**\n         * Force app-header-layout to have its own stacking context so that its parent can\n         * control the stacking of it relative to other elements (e.g. app-drawer-layout).\n         * This could be done using \\`isolation: isolate\\`, but that's not well supported\n         * across browsers.\n         */\n          position: relative;\n          z-index: 0;\n        }\n\n        #wrapper ::slotted([slot=\"header\"]) {\n          @apply --layout-fixed-top;\n          z-index: 1;\n        }\n\n        #wrapper.initializing ::slotted([slot=\"header\"]) {\n          position: relative;\n        }\n\n        :host([has-scrolling-region]) {\n          height: 100%;\n        }\n\n        :host([has-scrolling-region]) #wrapper ::slotted([slot=\"header\"]) {\n          position: absolute;\n        }\n\n        :host([has-scrolling-region])\n          #wrapper.initializing\n          ::slotted([slot=\"header\"]) {\n          position: relative;\n        }\n\n        :host([has-scrolling-region]) #wrapper #contentContainer {\n          @apply --layout-fit;\n          overflow-y: auto;\n          -webkit-overflow-scrolling: touch;\n        }\n\n        :host([has-scrolling-region]) #wrapper.initializing #contentContainer {\n          position: relative;\n        }\n\n        #contentContainer {\n          /* Create a stacking context here so that all children appear below the header. */\n          position: relative;\n          z-index: 0;\n          /* Using 'transform' will cause 'position: fixed' elements to behave like\n           'position: absolute' relative to this element. */\n          transform: translate(0);\n          margin-left: env(safe-area-inset-left);\n          margin-right: env(safe-area-inset-right);\n        }\n\n        @media print {\n          :host([has-scrolling-region]) #wrapper #contentContainer {\n            overflow-y: visible;\n          }\n        }\n      </style>\n\n      <div id=\"wrapper\" class=\"initializing\">\n        <slot id=\"headerSlot\" name=\"header\"></slot>\n\n        <div id=\"contentContainer\"><slot></slot></div>\n        <slot id=\"fab\" name=\"fab\"></slot>\n      </div>\n    `;\n  }\n}\ncustomElements.define(\"ha-app-layout\", HaAppLayout);\n","import \"@polymer/paper-dropdown-menu/paper-dropdown-menu\";\nimport \"@polymer/paper-item/paper-item\";\nimport \"@polymer/paper-listbox/paper-listbox\";\nimport { html } from \"@polymer/polymer/lib/utils/html-tag\";\n/* eslint-plugin-disable lit */\nimport { PolymerElement } from \"@polymer/polymer/polymer-element\";\nimport { computeStateName } from \"../../../../../common/entity/compute_state_name\";\nimport \"../../../../../components/buttons/ha-call-service-button\";\nimport \"../../../../../components/ha-card\";\nimport LocalizeMixin from \"../../../../../mixins/localize-mixin\";\nimport \"../../../../../styles/polymer-ha-style\";\n\nclass ZwaveGroups extends LocalizeMixin(PolymerElement) {\n  static get template() {\n    return html`\n      <style include=\"iron-flex ha-style\">\n        .content {\n          margin-top: 24px;\n        }\n\n        ha-card {\n          margin: 0 auto;\n          max-width: 600px;\n        }\n\n        .device-picker {\n          @apply --layout-horizontal;\n          @apply --layout-center-center;\n          padding-left: 24px;\n          padding-right: 24px;\n          padding-bottom: 24px;\n        }\n\n        .help-text {\n          padding-left: 24px;\n          padding-right: 24px;\n          padding-bottom: 12px;\n        }\n      </style>\n      <ha-card\n        class=\"content\"\n        header=\"[[localize('ui.panel.config.zwave.node_management.node_group_associations')]]\"\n      >\n        <!-- TODO make api for getting groups and members -->\n        <div class=\"device-picker\">\n          <paper-dropdown-menu\n            label=\"[[localize('ui.panel.config.zwave.node_management.group')]]\"\n            dynamic-align=\"\"\n            class=\"flex\"\n          >\n            <paper-listbox\n              slot=\"dropdown-content\"\n              selected=\"{{_selectedGroup}}\"\n            >\n              <template is=\"dom-repeat\" items=\"[[groups]]\" as=\"state\">\n                <paper-item>[[_computeSelectCaptionGroup(state)]]</paper-item>\n              </template>\n            </paper-listbox>\n          </paper-dropdown-menu>\n        </div>\n        <template is=\"dom-if\" if=\"[[_computeIsGroupSelected(_selectedGroup)]]\">\n          <div class=\"device-picker\">\n            <paper-dropdown-menu\n              label=\"[[localize('ui.panel.config.zwave.node_management.node_to_control')]]\"\n              dynamic-align=\"\"\n              class=\"flex\"\n            >\n              <paper-listbox\n                slot=\"dropdown-content\"\n                selected=\"{{_selectedTargetNode}}\"\n              >\n                <template is=\"dom-repeat\" items=\"[[nodes]]\" as=\"state\">\n                  <paper-item>[[_computeSelectCaption(state)]]</paper-item>\n                </template>\n              </paper-listbox>\n            </paper-dropdown-menu>\n          </div>\n\n          <div class=\"help-text\">\n            <span\n              >[[localize('ui.panel.config.zwave.node_management.nodes_in_group')]]</span\n            >\n            <template is=\"dom-repeat\" items=\"[[_otherGroupNodes]]\" as=\"state\">\n              <div>[[state]]</div>\n            </template>\n          </div>\n          <div class=\"help-text\">\n            <span\n              >[[localize('ui.panel.config.zwave.node_management.max_associations')]]</span\n            >\n            <span>[[_maxAssociations]]</span>\n          </div>\n        </template>\n\n        <template\n          is=\"dom-if\"\n          if=\"[[_computeIsTargetNodeSelected(_selectedTargetNode)]]\"\n        >\n          <div class=\"card-actions\">\n            <template is=\"dom-if\" if=\"[[!_noAssociationsLeft]]\">\n              <ha-call-service-button\n                hass=\"[[hass]]\"\n                domain=\"zwave\"\n                service=\"change_association\"\n                service-data=\"[[_addAssocServiceData]]\"\n              >\n                [[localize('ui.panel.config.zwave.node_management.add_to_group')]]\n              </ha-call-service-button>\n            </template>\n            <template\n              is=\"dom-if\"\n              if=\"[[_computeTargetInGroup(_selectedGroup, _selectedTargetNode)]]\"\n            >\n              <ha-call-service-button\n                hass=\"[[hass]]\"\n                domain=\"zwave\"\n                service=\"change_association\"\n                service-data=\"[[_removeAssocServiceData]]\"\n              >\n                [[localize('ui.panel.config.zwave.node_management.remove_from_group')]]\n              </ha-call-service-button>\n            </template>\n            <template is=\"dom-if\" if=\"[[_isBroadcastNodeInGroup]]\">\n              <ha-call-service-button\n                hass=\"[[hass]]\"\n                domain=\"zwave\"\n                service=\"change_association\"\n                service-data=\"[[_removeBroadcastNodeServiceData]]\"\n              >\n                [[localize('ui.panel.config.zwave.node_management.remove_broadcast')]]\n              </ha-call-service-button>\n            </template>\n          </div>\n        </template>\n      </ha-card>\n    `;\n  }\n\n  static get properties() {\n    return {\n      hass: Object,\n\n      nodes: Array,\n\n      groups: Array,\n\n      selectedNode: {\n        type: Number,\n        observer: \"_selectedNodeChanged\",\n      },\n\n      _selectedTargetNode: {\n        type: Number,\n        value: -1,\n        observer: \"_selectedTargetNodeChanged\",\n      },\n\n      _selectedGroup: {\n        type: Number,\n        value: -1,\n      },\n\n      _otherGroupNodes: {\n        type: Array,\n        value: -1,\n        computed: \"_computeOtherGroupNodes(_selectedGroup)\",\n      },\n\n      _maxAssociations: {\n        type: String,\n        value: \"\",\n        computed: \"_computeMaxAssociations(_selectedGroup)\",\n      },\n\n      _noAssociationsLeft: {\n        type: Boolean,\n        value: true,\n        computed: \"_computeAssociationsLeft(_selectedGroup)\",\n      },\n\n      _addAssocServiceData: {\n        type: String,\n        value: \"\",\n      },\n\n      _removeAssocServiceData: {\n        type: String,\n        value: \"\",\n      },\n\n      _removeBroadcastNodeServiceData: {\n        type: String,\n        value: \"\",\n      },\n\n      _isBroadcastNodeInGroup: {\n        type: Boolean,\n        value: false,\n      },\n    };\n  }\n\n  static get observers() {\n    return [\"_selectedGroupChanged(groups, _selectedGroup)\"];\n  }\n\n  ready() {\n    super.ready();\n    this.addEventListener(\"hass-service-called\", (ev) =>\n      this.serviceCalled(ev)\n    );\n  }\n\n  serviceCalled(ev) {\n    if (ev.detail.success) {\n      setTimeout(() => {\n        this._refreshGroups(this.selectedNode);\n      }, 5000);\n    }\n  }\n\n  _computeAssociationsLeft(selectedGroup) {\n    if (selectedGroup === -1) return true;\n    return this._maxAssociations === this._otherGroupNodes.length;\n  }\n\n  _computeMaxAssociations(selectedGroup) {\n    if (selectedGroup === -1) return -1;\n    const maxAssociations = this.groups[selectedGroup].value.max_associations;\n    if (!maxAssociations) return \"None\";\n    return maxAssociations;\n  }\n\n  _computeOtherGroupNodes(selectedGroup) {\n    if (selectedGroup === -1) return -1;\n    this.setProperties({ _isBroadcastNodeInGroup: false });\n    const associations = Object.values(\n      this.groups[selectedGroup].value.association_instances\n    );\n    if (!associations.length) return [\"None\"];\n    return associations.map((assoc) => {\n      if (!assoc.length || assoc.length !== 2) {\n        return `Unknown Node: ${assoc}`;\n      }\n      const id = assoc[0];\n      const instance = assoc[1];\n      const node = this.nodes.find((n) => n.attributes.node_id === id);\n      if (id === 255) {\n        this.setProperties({\n          _isBroadcastNodeInGroup: true,\n          _removeBroadcastNodeServiceData: {\n            node_id: this.nodes[this.selectedNode].attributes.node_id,\n            association: \"remove\",\n            target_node_id: 255,\n            group: this.groups[selectedGroup].key,\n          },\n        });\n      }\n      if (!node) {\n        return `Unknown Node (${id}: (${instance} ? ${id}.${instance} : ${id}))`;\n      }\n      let caption = this._computeSelectCaption(node);\n      if (instance) {\n        caption += `/ Instance: ${instance}`;\n      }\n      return caption;\n    });\n  }\n\n  _computeTargetInGroup(selectedGroup, selectedTargetNode) {\n    if (selectedGroup === -1 || selectedTargetNode === -1) return false;\n    const associations = Object.values(\n      this.groups[selectedGroup].value.associations\n    );\n    if (!associations.length) return false;\n    return (\n      associations.indexOf(\n        this.nodes[selectedTargetNode].attributes.node_id\n      ) !== -1\n    );\n  }\n\n  _computeSelectCaption(stateObj) {\n    return `${computeStateName(stateObj)}\n      (Node: ${stateObj.attributes.node_id}\n      ${stateObj.attributes.query_stage})`;\n  }\n\n  _computeSelectCaptionGroup(stateObj) {\n    return `${stateObj.key}: ${stateObj.value.label}`;\n  }\n\n  _computeIsTargetNodeSelected(selectedTargetNode) {\n    return this.nodes && selectedTargetNode !== -1;\n  }\n\n  _computeIsGroupSelected(selectedGroup) {\n    return this.nodes && this.selectedNode !== -1 && selectedGroup !== -1;\n  }\n\n  _computeAssocServiceData(selectedGroup, type) {\n    if (\n      !this.groups ||\n      selectedGroup === -1 ||\n      this.selectedNode === -1 ||\n      this._selectedTargetNode === -1\n    ) {\n      return -1;\n    }\n    return {\n      node_id: this.nodes[this.selectedNode].attributes.node_id,\n      association: type,\n      target_node_id: this.nodes[this._selectedTargetNode].attributes.node_id,\n      group: this.groups[selectedGroup].key,\n    };\n  }\n\n  async _refreshGroups(selectedNode) {\n    const groupData = [];\n    const groups = await this.hass.callApi(\n      \"GET\",\n      `zwave/groups/${this.nodes[selectedNode].attributes.node_id}`\n    );\n    Object.keys(groups).forEach((key) => {\n      groupData.push({\n        key,\n        value: groups[key],\n      });\n    });\n    this.setProperties({\n      groups: groupData,\n      _maxAssociations: groupData[this._selectedGroup].value.max_associations,\n      _otherGroupNodes: Object.values(\n        groupData[this._selectedGroup].value.associations\n      ),\n      _isBroadcastNodeInGroup: false,\n    });\n    const oldGroup = this._selectedGroup;\n    this.setProperties({ _selectedGroup: -1 });\n    this.setProperties({ _selectedGroup: oldGroup });\n  }\n\n  _selectedGroupChanged() {\n    if (this._selectedGroup === -1) return;\n    this.setProperties({\n      _maxAssociations: this.groups[this._selectedGroup].value.max_associations,\n      _otherGroupNodes: Object.values(\n        this.groups[this._selectedGroup].value.associations\n      ),\n    });\n  }\n\n  _selectedTargetNodeChanged() {\n    if (this._selectedGroup === -1) return;\n    if (\n      this._computeTargetInGroup(this._selectedGroup, this._selectedTargetNode)\n    ) {\n      this.setProperties({\n        _removeAssocServiceData: this._computeAssocServiceData(\n          this._selectedGroup,\n          \"remove\"\n        ),\n      });\n    } else {\n      this.setProperties({\n        _addAssocServiceData: this._computeAssocServiceData(\n          this._selectedGroup,\n          \"add\"\n        ),\n      });\n    }\n  }\n\n  _selectedNodeChanged() {\n    if (this.selectedNode === -1) return;\n    this.setProperties({ _selectedTargetNode: -1, _selectedGroup: -1 });\n  }\n}\n\ncustomElements.define(\"zwave-groups\", ZwaveGroups);\n","import \"@material/mwc-button\";\nimport \"@polymer/paper-input/paper-input\";\nimport { html } from \"@polymer/polymer/lib/utils/html-tag\";\n/* eslint-plugin-disable lit */\nimport { PolymerElement } from \"@polymer/polymer/polymer-element\";\nimport isPwa from \"../../../../../common/config/is_pwa\";\nimport \"../../../../../components/ha-card\";\nimport { EventsMixin } from \"../../../../../mixins/events-mixin\";\nimport LocalizeMixin from \"../../../../../mixins/localize-mixin\";\nimport \"../../../../../styles/polymer-ha-style\";\nimport \"../../../ha-config-section\";\n\nlet registeredDialog = false;\n\nclass OzwLog extends LocalizeMixin(EventsMixin(PolymerElement)) {\n  static get template() {\n    return html`\n    <style include=\"iron-flex ha-style\">\n      .content {\n        margin-top: 24px;\n      }\n\n      ha-card {\n        margin: 0 auto;\n        max-width: 600px;\n      }\n\n      .device-picker {\n        padding-left: 24px;\n        padding-right: 24px;\n        padding-bottom: 24px;\n      }\n\n    </style>\n    <ha-config-section is-wide=\"[[isWide]]\">\n      <span slot=\"header\">\n        [[localize('ui.panel.config.zwave.ozw_log.header')]]\n      </span>\n      <span slot=\"introduction\">\n        [[localize('ui.panel.config.zwave.ozw_log.introduction')]]\n      </span>\n      <ha-card class=\"content\">\n        <div class=\"device-picker\">\n          <paper-input label=\"[[localize('ui.panel.config.zwave.ozw_log.last_log_lines')]]\" type=\"number\" min=\"0\" max=\"1000\" step=\"10\" value=\"{{numLogLines}}\">\n          </paper-input>\n        </div>\n        <div class=\"card-actions\">\n          <mwc-button raised=\"true\" on-click=\"_openLogWindow\">[[localize('ui.panel.config.zwave.ozw_log.load')]]</mwc-button>\n          <mwc-button raised=\"true\" on-click=\"_tailLog\" disabled=\"{{_completeLog}}\">[[localize('ui.panel.config.zwave.ozw_log.tail')]]</mwc-button>\n      </ha-card>\n    </ha-config-section>\n`;\n  }\n\n  static get properties() {\n    return {\n      hass: Object,\n\n      isWide: {\n        type: Boolean,\n        value: false,\n      },\n\n      _ozwLogs: String,\n\n      _completeLog: {\n        type: Boolean,\n        value: true,\n      },\n\n      numLogLines: {\n        type: Number,\n        value: 0,\n        observer: \"_isCompleteLog\",\n      },\n\n      _intervalId: String,\n\n      tail: Boolean,\n    };\n  }\n\n  async _tailLog() {\n    this.setProperties({ tail: true });\n    const ozwWindow = await this._openLogWindow();\n    if (!isPwa()) {\n      this.setProperties({\n        _intervalId: setInterval(() => {\n          this._refreshLog(ozwWindow);\n        }, 1500),\n      });\n    }\n  }\n\n  async _openLogWindow() {\n    const info = await this.hass.callApi(\n      \"GET\",\n      \"zwave/ozwlog?lines=\" + this.numLogLines\n    );\n    this.setProperties({ _ozwLogs: info });\n    if (isPwa()) {\n      this._showOzwlogDialog();\n      return -1;\n    }\n    const ozwWindow = open(\"\", \"ozwLog\", \"toolbar\");\n    ozwWindow.document.body.innerHTML = `<pre>${this._ozwLogs}</pre>`;\n    return ozwWindow;\n  }\n\n  async _refreshLog(ozwWindow) {\n    if (ozwWindow.closed === true) {\n      clearInterval(this._intervalId);\n      this.setProperties({ _intervalId: null });\n    } else {\n      const info = await this.hass.callApi(\n        \"GET\",\n        \"zwave/ozwlog?lines=\" + this.numLogLines\n      );\n      this.setProperties({ _ozwLogs: info });\n      ozwWindow.document.body.innerHTML = `<pre>${this._ozwLogs}</pre>`;\n    }\n  }\n\n  _isCompleteLog() {\n    if (this.numLogLines !== \"0\") {\n      this.setProperties({ _completeLog: false });\n    } else {\n      this.setProperties({ _completeLog: true });\n    }\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n    if (!registeredDialog) {\n      registeredDialog = true;\n      this.fire(\"register-dialog\", {\n        dialogShowEvent: \"show-ozwlog-dialog\",\n        dialogTag: \"zwave-log-dialog\",\n        dialogImport: () => import(\"./zwave-log-dialog\"),\n      });\n    }\n  }\n\n  _showOzwlogDialog() {\n    this.fire(\"show-ozwlog-dialog\", {\n      hass: this.hass,\n      _numLogLines: this.numLogLines,\n      _ozwLog: this._ozwLogs,\n      _tail: this.tail,\n      dialogClosedCallback: () => this._dialogClosed(),\n    });\n  }\n\n  _dialogClosed() {\n    this.setProperties({\n      tail: false,\n    });\n  }\n}\ncustomElements.define(\"ozw-log\", OzwLog);\n","import { mdiCheckboxMarkedCircle, mdiClose, mdiHelpCircle } from \"@mdi/js\";\nimport { UnsubscribeFunc } from \"home-assistant-js-websocket\";\nimport { css, CSSResultGroup, html, LitElement, TemplateResult } from \"lit\";\nimport { customElement, property, state } from \"lit/decorators\";\nimport \"../../../../../components/buttons/ha-call-api-button\";\nimport \"../../../../../components/buttons/ha-call-service-button\";\nimport \"../../../../../components/ha-card\";\nimport \"../../../../../components/ha-circular-progress\";\nimport \"../../../../../components/ha-svg-icon\";\nimport \"../../../../../components/ha-icon-button\";\nimport \"../../../../../components/ha-service-description\";\nimport {\n  fetchNetworkStatus,\n  ZWaveNetworkStatus,\n  ZWAVE_NETWORK_STATE_AWAKED,\n  ZWAVE_NETWORK_STATE_READY,\n  ZWAVE_NETWORK_STATE_STARTED,\n  ZWAVE_NETWORK_STATE_STOPPED,\n} from \"../../../../../data/zwave\";\nimport { haStyle } from \"../../../../../resources/styles\";\nimport { HomeAssistant } from \"../../../../../types\";\nimport { documentationUrl } from \"../../../../../util/documentation-url\";\nimport \"../../../ha-config-section\";\n\n@customElement(\"zwave-network\")\nexport class ZwaveNetwork extends LitElement {\n  @property({ attribute: false }) public hass!: HomeAssistant;\n\n  @property() public isWide!: boolean;\n\n  @state() private _showHelp = false;\n\n  @state() private _networkStatus?: ZWaveNetworkStatus;\n\n  @state() private _unsubs: Array<Promise<UnsubscribeFunc>> = [];\n\n  public disconnectedCallback(): void {\n    this._unsubscribe();\n  }\n\n  protected firstUpdated(changedProps): void {\n    super.firstUpdated(changedProps);\n    this._getNetworkStatus();\n    this._subscribe();\n  }\n\n  protected render(): TemplateResult {\n    return html`\n      <ha-config-section .isWide=${this.isWide}>\n        <div class=\"sectionHeader\" slot=\"header\">\n          <span>\n            ${this.hass!.localize(\n              \"ui.panel.config.zwave.network_management.header\"\n            )}\n          </span>\n          <ha-icon-button\n            class=\"toggle-help-icon\"\n            @click=${this._onHelpTap}\n            .path=${mdiHelpCircle}\n            .label=${this.hass!.localize(\"ui.common.help\")}\n          ></ha-icon-button>\n        </div>\n        <div slot=\"introduction\">\n          ${this.hass!.localize(\n            \"ui.panel.config.zwave.network_management.introduction\"\n          )}\n          <p>\n            <a\n              href=${documentationUrl(this.hass, \"/docs/z-wave/control-panel/\")}\n              target=\"_blank\"\n              rel=\"noreferrer\"\n            >\n              ${this.hass!.localize(\"ui.panel.config.zwave.learn_more\")}\n            </a>\n          </p>\n        </div>\n\n        ${this._networkStatus\n          ? html`\n              <ha-card class=\"content network-status\">\n                <div class=\"details\">\n                  ${this._networkStatus.state === ZWAVE_NETWORK_STATE_STOPPED\n                    ? html`\n                        <ha-svg-icon .path=${mdiClose}></ha-svg-icon>\n                        ${this.hass!.localize(\n                          \"ui.panel.config.zwave.network_status.network_stopped\"\n                        )}\n                      `\n                    : this._networkStatus.state === ZWAVE_NETWORK_STATE_STARTED\n                    ? html`\n                        <ha-circular-progress active></ha-circular-progress>\n                        ${this.hass!.localize(\n                          \"ui.panel.config.zwave.network_status.network_starting\"\n                        )}<br />\n                        <small>\n                          ${this.hass!.localize(\n                            \"ui.panel.config.zwave.network_status.network_starting_note\"\n                          )}\n                        </small>\n                      `\n                    : this._networkStatus.state === ZWAVE_NETWORK_STATE_AWAKED\n                    ? html`\n                        <ha-svg-icon\n                          .path=${mdiCheckboxMarkedCircle}\n                        ></ha-svg-icon>\n                        ${this.hass!.localize(\n                          \"ui.panel.config.zwave.network_status.network_started\"\n                        )}<br />\n                        <small>\n                          ${this.hass!.localize(\n                            \"ui.panel.config.zwave.network_status.network_started_note_some_queried\"\n                          )}\n                        </small>\n                      `\n                    : this._networkStatus.state === ZWAVE_NETWORK_STATE_READY\n                    ? html`\n                        ${this.hass!.localize(\n                          \"ui.panel.config.zwave.network_status.network_started\"\n                        )}<br />\n                        <small>\n                          ${this.hass!.localize(\n                            \"ui.panel.config.zwave.network_status.network_started_note_all_queried\"\n                          )}\n                        </small>\n                      `\n                    : \"\"}\n                </div>\n                <div class=\"card-actions\">\n                  ${this._networkStatus.state >= ZWAVE_NETWORK_STATE_AWAKED\n                    ? html`\n                        ${this._generateServiceButton(\"stop_network\")}\n                        ${this._generateServiceButton(\"heal_network\")}\n                        ${this._generateServiceButton(\"test_network\")}\n                      `\n                    : html` ${this._generateServiceButton(\"start_network\")} `}\n                </div>\n                ${this._networkStatus.state >= ZWAVE_NETWORK_STATE_AWAKED\n                  ? html`\n                      <div class=\"card-actions\">\n                        ${this._generateServiceButton(\"soft_reset\")}\n                        <ha-call-api-button\n                          .hass=${this.hass}\n                          path=\"zwave/saveconfig\"\n                        >\n                          ${this.hass!.localize(\n                            \"ui.panel.config.zwave.services.save_config\"\n                          )}\n                        </ha-call-api-button>\n                      </div>\n                    `\n                  : \"\"}\n              </ha-card>\n              ${this._networkStatus.state >= ZWAVE_NETWORK_STATE_AWAKED\n                ? html`\n                    <ha-card class=\"content\">\n                      <div class=\"card-actions\">\n                        ${this._generateServiceButton(\"add_node_secure\")}\n                        ${this._generateServiceButton(\"add_node\")}\n                        ${this._generateServiceButton(\"remove_node\")}\n                      </div>\n                      <div class=\"card-actions\">\n                        ${this._generateServiceButton(\"cancel_command\")}\n                      </div>\n                    </ha-card>\n                  `\n                : \"\"}\n            `\n          : \"\"}\n      </ha-config-section>\n    `;\n  }\n\n  private async _getNetworkStatus(): Promise<void> {\n    this._networkStatus = await fetchNetworkStatus(this.hass!);\n  }\n\n  private _subscribe(): void {\n    this._unsubs = [\n      \"zwave.network_start\",\n      \"zwave.network_stop\",\n      \"zwave.network_ready\",\n      \"zwave.network_complete\",\n      \"zwave.network_complete_some_dead\",\n    ].map((e) =>\n      this.hass!.connection.subscribeEvents(\n        (event) => this._handleEvent(event),\n        e\n      )\n    );\n  }\n\n  private _unsubscribe(): void {\n    while (this._unsubs.length) {\n      this._unsubs.pop()!.then((unsub) => unsub());\n    }\n  }\n\n  private _handleEvent(event) {\n    if (event.event_type === \"zwave.network_start\") {\n      // Optimistically set the state, wait 1s and poll the backend\n      // The backend will still report a state of 0 when the 'network_start'\n      // event is first fired.\n      if (this._networkStatus) {\n        this._networkStatus = { ...this._networkStatus, state: 5 };\n      }\n      setTimeout(() => this._getNetworkStatus, 1000);\n    } else {\n      this._getNetworkStatus();\n    }\n  }\n\n  private _onHelpTap(): void {\n    this._showHelp = !this._showHelp;\n  }\n\n  private _generateServiceButton(service: string) {\n    return html`\n      <ha-call-service-button\n        .hass=${this.hass}\n        domain=\"zwave\"\n        service=${service}\n      >\n        ${this.hass!.localize(\"ui.panel.config.zwave.services.\" + service)}\n      </ha-call-service-button>\n      <ha-service-description\n        .hass=${this.hass}\n        domain=\"zwave\"\n        service=${service}\n        ?hidden=${!this._showHelp}\n      >\n      </ha-service-description>\n    `;\n  }\n\n  static get styles(): CSSResultGroup {\n    return [\n      haStyle,\n      css`\n        .content {\n          margin-top: 24px;\n        }\n\n        .sectionHeader {\n          position: relative;\n          padding-right: 40px;\n        }\n\n        .network-status {\n          text-align: center;\n        }\n\n        .network-status div.details {\n          font-size: 1.5rem;\n          padding: 24px;\n        }\n\n        .network-status ha-svg-icon {\n          display: block;\n          margin: 0px auto 16px;\n          width: 48px;\n          height: 48px;\n        }\n\n        .network-status small {\n          font-size: 1rem;\n        }\n\n        ha-card {\n          margin: 0 auto;\n          max-width: 600px;\n        }\n\n        .card-actions.warning ha-call-service-button {\n          color: var(--error-color);\n        }\n\n        .toggle-help-icon {\n          position: absolute;\n          top: -6px;\n          right: 0;\n          color: var(--primary-color);\n        }\n\n        ha-service-description {\n          display: block;\n          color: grey;\n          padding: 0 8px 12px;\n        }\n\n        [hidden] {\n          display: none;\n        }\n      `,\n    ];\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"zwave-network\": ZwaveNetwork;\n  }\n}\n","import \"@polymer/paper-dropdown-menu/paper-dropdown-menu\";\nimport \"@polymer/paper-input/paper-input\";\nimport \"@polymer/paper-item/paper-item\";\nimport \"@polymer/paper-listbox/paper-listbox\";\nimport {\n  css,\n  CSSResultGroup,\n  html,\n  LitElement,\n  PropertyValues,\n  TemplateResult,\n} from \"lit\";\nimport { customElement, property, state } from \"lit/decorators\";\nimport \"../../../../../components/buttons/ha-call-service-button\";\nimport \"../../../../../components/ha-card\";\nimport {\n  fetchNodeConfig,\n  ZWaveConfigItem,\n  ZWaveConfigServiceData,\n  ZWaveNode,\n} from \"../../../../../data/zwave\";\nimport { haStyle } from \"../../../../../resources/styles\";\nimport { HomeAssistant } from \"../../../../../types\";\n\n@customElement(\"zwave-node-config\")\nexport class ZwaveNodeConfig extends LitElement {\n  @property({ attribute: false }) public hass!: HomeAssistant;\n\n  @property() public nodes: ZWaveNode[] = [];\n\n  @property() public config: ZWaveConfigItem[] = [];\n\n  @property() public selectedNode = -1;\n\n  @state() private _configItem?: ZWaveConfigItem;\n\n  @state() private _wakeupInput = -1;\n\n  @state() private _selectedConfigParameter = -1;\n\n  @state() private _selectedConfigValue: number | string = -1;\n\n  protected render(): TemplateResult {\n    return html`\n      <div class=\"content\">\n        <ha-card\n          .header=${this.hass!.localize(\n            \"ui.panel.config.zwave.node_config.header\"\n          )}\n        >\n          ${\"wake_up_interval\" in this.nodes[this.selectedNode].attributes\n            ? html`\n                <div class=\"card-actions\">\n                  <paper-input\n                    .floatLabel=${this.hass!.localize(\n                      \"ui.panel.config.zwave.common.wakeup_interval\"\n                    )}\n                    type=\"number\"\n                    .value=${this._wakeupInput !== -1\n                      ? this._wakeupInput\n                      : this.hass!.localize(\n                          \"ui.panel.config.zwave.common.unknown\"\n                        )}\n                    @value-changed=${this._onWakeupIntervalChanged}\n                    .placeholder=${this.nodes[this.selectedNode].attributes\n                      .wake_up_interval\n                      ? this.nodes[this.selectedNode].attributes\n                          .wake_up_interval\n                      : this.hass!.localize(\n                          \"ui.panel.config.zwave.common.unknown\"\n                        )}\n                  >\n                    <div suffix>\n                      ${this.hass!.localize(\n                        \"ui.panel.config.zwave.node_config.seconds\"\n                      )}\n                    </div>\n                  </paper-input>\n                  <ha-call-service-button\n                    .hass=${this.hass}\n                    domain=\"zwave\"\n                    service=\"set_wakeup\"\n                    .serviceData=${this._computeWakeupServiceData(\n                      this._wakeupInput\n                    )}\n                  >\n                    ${this.hass!.localize(\n                      \"ui.panel.config.zwave.node_config.set_wakeup\"\n                    )}\n                  </ha-call-service-button>\n                </div>\n              `\n            : \"\"}\n          <div class=\"device-picker\">\n            <paper-dropdown-menu\n              .label=${this.hass!.localize(\n                \"ui.panel.config.zwave.node_config.config_parameter\"\n              )}\n              dynamic-align\n              class=\"flex\"\n            >\n              <paper-listbox\n                slot=\"dropdown-content\"\n                .selected=${this._selectedConfigParameter}\n                @iron-select=${this._selectedConfigParameterChanged}\n              >\n                ${this.config.map(\n                  (entityState) => html`\n                    <paper-item>\n                      ${entityState.key}: ${entityState.value.label}\n                    </paper-item>\n                  `\n                )}\n              </paper-listbox>\n            </paper-dropdown-menu>\n          </div>\n          ${this._configItem\n            ? html`\n                ${this._configItem.value.type === \"List\"\n                  ? html`\n                      <div class=\"device-picker\">\n                        <paper-dropdown-menu\n                          .label=${this.hass!.localize(\n                            \"ui.panel.config.zwave.node_config.config_value\"\n                          )}\n                          dynamic-align\n                          class=\"flex\"\n                          .placeholder=${this._configItem.value.data}\n                        >\n                          <paper-listbox\n                            slot=\"dropdown-content\"\n                            .selected=${this._configItem.value.data}\n                            @iron-select=${this._configValueSelectChanged}\n                          >\n                            ${this._configItem.value.data_items.map(\n                              (entityState) => html`\n                                <paper-item>${entityState}</paper-item>\n                              `\n                            )}\n                          </paper-listbox>\n                        </paper-dropdown-menu>\n                      </div>\n                    `\n                  : \"\"}\n                ${[\"Byte\", \"Short\", \"Int\"].includes(this._configItem.value.type)\n                  ? html`\n                      <div class=\"card-actions\">\n                        <paper-input\n                          .label=${this._configItem.value.data_items}\n                          type=\"number\"\n                          .value=${this._configItem.value.data}\n                          .max=${this._configItem.value.max}\n                          .min=${this._configItem.value.min}\n                          @value-changed=${this._configValueInputChanged}\n                        >\n                        </paper-input>\n                      </div>\n                    `\n                  : \"\"}\n                ${[\"Bool\", \"Button\"].includes(this._configItem.value.type)\n                  ? html`\n                      <div class=\"device-picker\">\n                        <paper-dropdown-menu\n                          .label=${this.hass!.localize(\n                            \"ui.panel.config.zwave.node_config.config_value\"\n                          )}\n                          class=\"flex\"\n                          dynamic-align\n                          .placeholder=${this._configItem.value.data}\n                        >\n                          <paper-listbox\n                            slot=\"dropdown-content\"\n                            .selected=${this._configItem.value.data}\n                            @iron-select=${this._configValueSelectChanged}\n                          >\n                            <paper-item>\n                              ${this.hass!.localize(\n                                \"ui.panel.config.zwave.node_config.true\"\n                              )}\n                            </paper-item>\n                            <paper-item>\n                              ${this.hass!.localize(\n                                \"ui.panel.config.zwave.node_config.false\"\n                              )}\n                            </paper-item>\n                          </paper-listbox>\n                        </paper-dropdown-menu>\n                      </div>\n                    `\n                  : \"\"}\n                <div class=\"help-text\">\n                  <span>${this._configItem.value.help}</span>\n                </div>\n                ${[\"Bool\", \"Button\", \"Byte\", \"Short\", \"Int\", \"List\"].includes(\n                  this._configItem.value.type\n                )\n                  ? html`\n                      <div class=\"card-actions\">\n                        <ha-call-service-button\n                          .hass=${this.hass}\n                          domain=\"zwave\"\n                          service=\"set_config_parameter\"\n                          .serviceData=${this._computeSetConfigParameterServiceData()}\n                        >\n                          ${this.hass!.localize(\n                            \"ui.panel.config.zwave.node_config.set_config_parameter\"\n                          )}\n                        </ha-call-service-button>\n                      </div>\n                    `\n                  : \"\"}\n              `\n            : \"\"}\n        </ha-card>\n      </div>\n    `;\n  }\n\n  static get styles(): CSSResultGroup {\n    return [\n      haStyle,\n      css`\n        .content {\n          margin-top: 24px;\n        }\n\n        ha-card {\n          margin: 0 auto;\n          max-width: 600px;\n        }\n\n        .device-picker {\n          @apply --layout-horizontal;\n          @apply --layout-center-center;\n          display: -ms-flexbox;\n          display: -webkit-flex;\n          display: flex;\n          -ms-flex-direction: row;\n          -webkit-flex-direction: row;\n          flex-direction: row;\n          -ms-flex-align: center;\n          -webkit-align-items: center;\n          align-items: center;\n          padding-left: 24px;\n          padding-right: 24px;\n          padding-bottom: 24px;\n        }\n\n        .help-text {\n          padding-left: 24px;\n          padding-right: 24px;\n        }\n\n        .flex {\n          -ms-flex: 1 1 0.000000001px;\n          -webkit-flex: 1;\n          flex: 1;\n          -webkit-flex-basis: 0.000000001px;\n          flex-basis: 0.000000001px;\n        }\n      `,\n    ];\n  }\n\n  protected firstUpdated(changedProps: PropertyValues): void {\n    super.firstUpdated(changedProps);\n    this.addEventListener(\"hass-service-called\", (ev) =>\n      this.serviceCalled(ev)\n    );\n  }\n\n  protected updated(changedProps: PropertyValues): void {\n    super.updated(changedProps);\n    if (changedProps.has(\"selectedNode\")) {\n      this._nodesChanged();\n    }\n  }\n\n  private serviceCalled(ev): void {\n    if (ev.detail.success) {\n      setTimeout(() => {\n        this._refreshConfig(this.selectedNode);\n      }, 5000);\n    }\n  }\n\n  private _nodesChanged(): void {\n    if (!this.nodes) {\n      return;\n    }\n    this._configItem = undefined;\n    this._wakeupInput =\n      this.nodes[this.selectedNode].attributes.wake_up_interval || -1;\n  }\n\n  private _onWakeupIntervalChanged(value: ChangeEvent): void {\n    this._wakeupInput = value.detail!.value;\n  }\n\n  private _computeWakeupServiceData(wakeupInput: number) {\n    return {\n      node_id: this.nodes[this.selectedNode].attributes.node_id,\n      value: wakeupInput,\n    };\n  }\n\n  private _computeSetConfigParameterServiceData():\n    | ZWaveConfigServiceData\n    | boolean {\n    if (this.selectedNode === -1 || typeof this._configItem === \"undefined\") {\n      return false;\n    }\n    let valueData: number | string = \"\";\n    if ([\"Short\", \"Byte\", \"Int\"].includes(this._configItem!.value.type)) {\n      valueData =\n        typeof this._selectedConfigValue === \"string\"\n          ? parseInt(this._selectedConfigValue, 10)\n          : this._selectedConfigValue;\n    }\n    if ([\"Bool\", \"Button\", \"List\"].includes(this._configItem!.value.type)) {\n      valueData = this._selectedConfigValue;\n    }\n    return {\n      node_id: this.nodes[this.selectedNode].attributes.node_id,\n      parameter: this._configItem.key,\n      value: valueData,\n    };\n  }\n\n  private _selectedConfigParameterChanged(event: ItemSelectedEvent): void {\n    if (event.target!.selected === -1) {\n      return;\n    }\n    this._selectedConfigParameter = event.target!.selected;\n    this._configItem = this.config[event.target!.selected];\n  }\n\n  private _configValueSelectChanged(event: ItemSelectedEvent): void {\n    if (event.target!.selected === -1) {\n      return;\n    }\n    this._selectedConfigValue = event.target!.selectedItem.textContent;\n  }\n\n  private _configValueInputChanged(value: ChangeEvent): void {\n    this._selectedConfigValue = value.detail!.value;\n  }\n\n  private async _refreshConfig(selectedNode): Promise<void> {\n    const configData: ZWaveConfigItem[] = [];\n    const config = await fetchNodeConfig(\n      this.hass,\n      this.nodes[selectedNode].attributes.node_id\n    );\n\n    Object.keys(config).forEach((key) => {\n      configData.push({\n        key: parseInt(key, 10),\n        value: config[key],\n      });\n    });\n\n    this.config = configData;\n    this._configItem = this.config[this._selectedConfigParameter];\n  }\n}\n\nexport interface ChangeEvent {\n  detail?: {\n    value?: any;\n  };\n  target?: EventTarget;\n}\n\nexport interface PickerTarget extends EventTarget {\n  selected: number;\n  selectedItem?: any;\n}\n\nexport interface ItemSelectedEvent {\n  target?: PickerTarget;\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"zwave-node-config\": ZwaveNodeConfig;\n  }\n}\n","import \"@polymer/paper-dropdown-menu/paper-dropdown-menu\";\nimport \"@polymer/paper-input/paper-input\";\nimport \"@polymer/paper-item/paper-item\";\nimport \"@polymer/paper-listbox/paper-listbox\";\nimport { html } from \"@polymer/polymer/lib/utils/html-tag\";\n/* eslint-plugin-disable lit */\nimport { PolymerElement } from \"@polymer/polymer/polymer-element\";\nimport \"../../../../../components/buttons/ha-call-api-button\";\nimport \"../../../../../components/ha-card\";\nimport LocalizeMixin from \"../../../../../mixins/localize-mixin\";\nimport \"../../../../../styles/polymer-ha-style\";\n\nclass ZwaveNodeProtection extends LocalizeMixin(PolymerElement) {\n  static get template() {\n    return html`\n    <style include=\"iron-flex ha-style\">\n      .card-actions.warning ha-call-api-button {\n        color: var(--error-color);\n      }\n      .content {\n        margin-top: 24px;\n      }\n\n      ha-card {\n        margin: 0 auto;\n        max-width: 600px;\n      }\n\n      .device-picker {\n        @apply --layout-horizontal;\n        @apply --layout-center-center;\n        padding: 0 24px 24px 24px;\n        }\n\n    </style>\n      <div class=\"content\">\n        <ha-card header=\"[[localize('ui.panel.config.zwave.node_management.node_protection')]]\">\n          <div class=\"device-picker\">\n          <paper-dropdown-menu label=\"[[localize('ui.panel.config.zwave.node_management.protection')]]\" dynamic-align class=\"flex\" placeholder=\"{{_loadedProtectionValue}}\">\n            <paper-listbox slot=\"dropdown-content\" selected=\"{{_selectedProtectionParameter}}\">\n              <template is=\"dom-repeat\" items=\"[[_protectionOptions]]\" as=\"state\">\n                <paper-item>[[state]]</paper-item>\n              </template>\n            </paper-listbox>\n          </paper-dropdown-menu>\n          </div>\n          <div class=\"card-actions\">\n            <ha-call-api-button\n              hass=\"[[hass]]\"\n              path=\"[[_nodePath]]\"\n              data=\"[[_protectionData]]\">\n              [[localize('ui.panel.config.zwave.node_management.set_protection')]]\n            </ha-call-service-button>\n          </div>\n        </ha-card>\n      </div>\n`;\n  }\n\n  static get properties() {\n    return {\n      hass: Object,\n\n      nodes: Array,\n\n      selectedNode: {\n        type: Number,\n        value: -1,\n      },\n\n      protectionNode: {\n        type: Boolean,\n        value: false,\n      },\n\n      _protectionValueID: {\n        type: Number,\n        value: -1,\n      },\n\n      _selectedProtectionParameter: {\n        type: Number,\n        value: -1,\n        observer: \"_computeProtectionData\",\n      },\n\n      _protectionOptions: Array,\n\n      _protection: {\n        type: Array,\n        value: () => [],\n      },\n\n      _loadedProtectionValue: {\n        type: String,\n        value: \"\",\n      },\n\n      _protectionData: {\n        type: Object,\n        value: {},\n      },\n\n      _nodePath: String,\n    };\n  }\n\n  static get observers() {\n    return [\"_nodesChanged(nodes, selectedNode)\"];\n  }\n\n  ready() {\n    super.ready();\n    this.addEventListener(\"hass-api-called\", (ev) => this.apiCalled(ev));\n  }\n\n  apiCalled(ev) {\n    if (ev.detail.success) {\n      setTimeout(() => {\n        this._refreshProtection(this.selectedNode);\n      }, 5000);\n    }\n  }\n\n  _nodesChanged() {\n    if (!this.nodes) return;\n    if (this.protection) {\n      if (this.protection.length === 0) {\n        return;\n      }\n      let options = [];\n      let value_id = -1;\n      let selected = -1;\n      this.protection.forEach((item) => {\n        if (item.key === \"options\") options = item.value;\n        else if (item.key === \"value_id\") value_id = item.value;\n        else if (item.key === \"selected\") selected = item.value;\n      });\n      this.setProperties({\n        protectionNode: true,\n        _protectionOptions: options,\n        _loadedProtectionValue: selected,\n        _protectionValueID: value_id,\n      });\n    }\n  }\n\n  async _refreshProtection(selectedNode) {\n    const protectionValues = [];\n    const protections = await this.hass.callApi(\n      \"GET\",\n      `zwave/protection/${this.nodes[selectedNode].attributes.node_id}`\n    );\n    Object.keys(protections).forEach((key) => {\n      protectionValues.push({\n        key,\n        value: protections[key],\n      });\n    });\n    this.setProperties({\n      _protection: protectionValues,\n      _selectedProtectionParameter: -1,\n      _loadedProtectionValue: this.protection[1].value,\n    });\n  }\n\n  _computeProtectionData(selectedProtectionParameter) {\n    if (this.selectedNode === -1 || selectedProtectionParameter === -1) return;\n    this._protectionData = {\n      selection: this._protectionOptions[selectedProtectionParameter],\n      value_id: this._protectionValueID,\n    };\n    this._nodePath = `zwave/protection/${\n      this.nodes[this.selectedNode].attributes.node_id\n    }`;\n  }\n}\n\ncustomElements.define(\"zwave-node-protection\", ZwaveNodeProtection);\n","import \"@polymer/paper-dropdown-menu/paper-dropdown-menu\";\nimport \"@polymer/paper-input/paper-input\";\nimport \"@polymer/paper-item/paper-item\";\nimport \"@polymer/paper-listbox/paper-listbox\";\nimport { html } from \"@polymer/polymer/lib/utils/html-tag\";\n/* eslint-plugin-disable lit */\nimport { PolymerElement } from \"@polymer/polymer/polymer-element\";\nimport \"../../../../../components/buttons/ha-call-service-button\";\nimport \"../../../../../components/ha-card\";\nimport \"../../../../../styles/polymer-ha-style\";\n\nclass ZwaveUsercodes extends PolymerElement {\n  static get template() {\n    return html`\n      <style include=\"iron-flex ha-style\">\n        .content {\n          margin-top: 24px;\n        }\n\n        ha-card {\n          margin: 0 auto;\n          max-width: 600px;\n        }\n\n        .device-picker {\n          @apply --layout-horizontal;\n          @apply --layout-center-center;\n          padding-left: 24px;\n          padding-right: 24px;\n          padding-bottom: 24px;\n        }\n\n        pre {\n          font-family: var(--code-font-family, monospace);\n        }\n      </style>\n      <div class=\"content\">\n        <ha-card header=\"Node user codes\">\n          <div class=\"device-picker\">\n            <paper-dropdown-menu\n              label=\"Code slot\"\n              dynamic-align=\"\"\n              class=\"flex\"\n            >\n              <paper-listbox\n                slot=\"dropdown-content\"\n                selected=\"{{_selectedUserCode}}\"\n              >\n                <template is=\"dom-repeat\" items=\"[[userCodes]]\" as=\"state\">\n                  <paper-item\n                    >[[_computeSelectCaptionUserCodes(state)]]</paper-item\n                  >\n                </template>\n              </paper-listbox>\n            </paper-dropdown-menu>\n          </div>\n\n          <template is=\"dom-if\" if=\"[[_isUserCodeSelected(_selectedUserCode)]]\">\n            <div class=\"card-actions\">\n              <paper-input\n                label=\"User code\"\n                type=\"text\"\n                allowed-pattern=\"[0-9,a-f,x,\\\\\\\\]\"\n                maxlength=\"40\"\n                minlength=\"16\"\n                value=\"{{_selectedUserCodeValue}}\"\n              >\n              </paper-input>\n              <pre>Ascii: [[_computedCodeOutput]]</pre>\n            </div>\n            <div class=\"card-actions\">\n              <ha-call-service-button\n                hass=\"[[hass]]\"\n                domain=\"lock\"\n                service=\"set_usercode\"\n                service-data='[[_computeUserCodeServiceData(_selectedUserCodeValue, \"Add\")]]'\n              >\n                Set Usercode\n              </ha-call-service-button>\n              <ha-call-service-button\n                hass=\"[[hass]]\"\n                domain=\"lock\"\n                service=\"clear_usercode\"\n                service-data='[[_computeUserCodeServiceData(_selectedUserCode, \"Delete\")]]'\n              >\n                Delete Usercode\n              </ha-call-service-button>\n            </div>\n          </template>\n        </ha-card>\n      </div>\n    `;\n  }\n\n  static get properties() {\n    return {\n      hass: Object,\n\n      nodes: Array,\n\n      selectedNode: {\n        type: Number,\n        observer: \"_selectedNodeChanged\",\n      },\n\n      userCodes: Object,\n\n      _selectedUserCode: {\n        type: Number,\n        value: -1,\n        observer: \"_selectedUserCodeChanged\",\n      },\n\n      _selectedUserCodeValue: String,\n\n      _computedCodeOutput: {\n        type: String,\n        value: \"\",\n      },\n    };\n  }\n\n  ready() {\n    super.ready();\n    this.addEventListener(\"hass-service-called\", (ev) =>\n      this.serviceCalled(ev)\n    );\n  }\n\n  serviceCalled(ev) {\n    if (ev.detail.success) {\n      setTimeout(() => {\n        this._refreshUserCodes(this.selectedNode);\n      }, 5000);\n    }\n  }\n\n  _isUserCodeSelected(selectedUserCode) {\n    if (selectedUserCode === -1) return false;\n    return true;\n  }\n\n  _computeSelectCaptionUserCodes(stateObj) {\n    return `${stateObj.key}: ${stateObj.value.label}`;\n  }\n\n  _selectedUserCodeChanged(selectedUserCode) {\n    if (this._selectedUserCode === -1 || selectedUserCode === -1) return;\n    const value = this.userCodes[selectedUserCode].value.code;\n    this.setProperties({\n      _selectedUserCodeValue: this._a2hex(value),\n      _computedCodeOutput: `[${this._hex2a(this._a2hex(value))}]`,\n    });\n  }\n\n  _computeUserCodeServiceData(selectedUserCodeValue, type) {\n    if (this.selectedNode === -1 || !selectedUserCodeValue) return -1;\n    let serviceData = null;\n    let valueData = null;\n    if (type === \"Add\") {\n      valueData = this._hex2a(selectedUserCodeValue);\n      this._computedCodeOutput = `[${valueData}]`;\n      serviceData = {\n        node_id: this.nodes[this.selectedNode].attributes.node_id,\n        code_slot: this._selectedUserCode,\n        usercode: valueData,\n      };\n    }\n    if (type === \"Delete\") {\n      serviceData = {\n        node_id: this.nodes[this.selectedNode].attributes.node_id,\n        code_slot: this._selectedUserCode,\n      };\n    }\n    return serviceData;\n  }\n\n  async _refreshUserCodes(selectedNode) {\n    this.setProperties({ _selectedUserCodeValue: \"\" });\n    const userCodes = [];\n    const userCodeData = await this.hass.callApi(\n      \"GET\",\n      `zwave/usercodes/${this.nodes[selectedNode].attributes.node_id}`\n    );\n    Object.keys(userCodeData).forEach((key) => {\n      userCodes.push({\n        key,\n        value: userCodeData[key],\n      });\n    });\n    this.setProperties({ userCodes: userCodes });\n    this._selectedUserCodeChanged(this._selectedUserCode);\n  }\n\n  _a2hex(str) {\n    const arr = [];\n    let output = \"\";\n    for (let i = 0, l = str.length; i < l; i++) {\n      const hex = Number(str.charCodeAt(i)).toString(16);\n      if (hex === \"0\") {\n        output = \"00\";\n      } else {\n        output = hex;\n      }\n      arr.push(\"\\\\x\" + output);\n    }\n    return arr.join(\"\");\n  }\n\n  _hex2a(hexx) {\n    const hex = hexx.toString();\n    const hexMod = hex.replace(/\\\\x/g, \"\");\n    let str = \"\";\n    for (let i = 0; i < hexMod.length; i += 2) {\n      str += String.fromCharCode(parseInt(hexMod.substr(i, 2), 16));\n    }\n    return str;\n  }\n\n  _selectedNodeChanged() {\n    if (this.selectedNode === -1) return;\n    this.setProperties({ _selecteduserCode: -1 });\n  }\n}\n\ncustomElements.define(\"zwave-usercodes\", ZwaveUsercodes);\n","import \"@polymer/paper-dropdown-menu/paper-dropdown-menu\";\nimport \"@polymer/paper-item/paper-item\";\nimport \"@polymer/paper-listbox/paper-listbox\";\nimport { css, CSSResultGroup, html, LitElement, TemplateResult } from \"lit\";\nimport { customElement, property, state } from \"lit/decorators\";\nimport \"../../../../../components/buttons/ha-call-service-button\";\nimport \"../../../../../components/ha-card\";\nimport { ZWaveValue } from \"../../../../../data/zwave\";\nimport { haStyle } from \"../../../../../resources/styles\";\nimport { HomeAssistant } from \"../../../../../types\";\n\n@customElement(\"zwave-values\")\nexport class ZwaveValues extends LitElement {\n  @property({ attribute: false }) public hass!: HomeAssistant;\n\n  @property() public values: ZWaveValue[] = [];\n\n  @state() private _selectedValue = -1;\n\n  protected render(): TemplateResult {\n    return html`\n      <div class=\"content\">\n        <ha-card\n          .header=${this.hass.localize(\"ui.panel.config.zwave.values.header\")}\n        >\n          <div class=\"device-picker\">\n            <paper-dropdown-menu\n              .label=${this.hass.localize(\"ui.panel.config.zwave.common.value\")}\n              dynamic-align\n              class=\"flex\"\n            >\n              <paper-listbox\n                slot=\"dropdown-content\"\n                .selected=${this._selectedValue}\n              >\n                ${this.values.map(\n                  (item) => html`\n                    <paper-item> ${this._computeCaption(item)} </paper-item>\n                  `\n                )}\n              </paper-listbox>\n            </paper-dropdown-menu>\n          </div>\n        </ha-card>\n      </div>\n    `;\n  }\n\n  static get styles(): CSSResultGroup {\n    return [\n      haStyle,\n      css`\n        .content {\n          margin-top: 24px;\n        }\n\n        ha-card {\n          margin: 0 auto;\n          max-width: 600px;\n        }\n\n        .device-picker {\n          @apply --layout-horizontal;\n          @apply --layout-center-center;\n          display: -ms-flexbox;\n          display: -webkit-flex;\n          display: flex;\n          -ms-flex-direction: row;\n          -webkit-flex-direction: row;\n          flex-direction: row;\n          -ms-flex-align: center;\n          -webkit-align-items: center;\n          align-items: center;\n          padding-left: 24px;\n          padding-right: 24px;\n          padding-bottom: 24px;\n        }\n\n        .flex {\n          -ms-flex: 1 1 0.000000001px;\n          -webkit-flex: 1;\n          flex: 1;\n          -webkit-flex-basis: 0.000000001px;\n          flex-basis: 0.000000001px;\n        }\n\n        .help-text {\n          padding-left: 24px;\n          padding-right: 24px;\n        }\n      `,\n    ];\n  }\n\n  private _computeCaption(item) {\n    let out = `${item.value.label}`;\n    out += ` (${this.hass.localize(\"ui.panel.config.zwave.common.instance\")}:`;\n    out += ` ${item.value.instance},`;\n    out += ` ${this.hass.localize(\"ui.panel.config.zwave.common.index\")}:`;\n    out += ` ${item.value.index})`;\n    return out;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"zwave-values\": ZwaveValues;\n  }\n}\n","import \"@polymer/app-layout/app-header/app-header\";\nimport \"@polymer/app-layout/app-toolbar/app-toolbar\";\nimport \"@polymer/paper-dropdown-menu/paper-dropdown-menu\";\nimport \"@polymer/paper-input/paper-input\";\nimport \"@polymer/paper-item/paper-item\";\nimport \"@polymer/paper-listbox/paper-listbox\";\nimport { html } from \"@polymer/polymer/lib/utils/html-tag\";\n/* eslint-plugin-disable lit */\nimport { PolymerElement } from \"@polymer/polymer/polymer-element\";\nimport { computeStateDomain } from \"../../../../../common/entity/compute_state_domain\";\nimport { computeStateName } from \"../../../../../common/entity/compute_state_name\";\nimport { sortStatesByName } from \"../../../../../common/entity/states_sort_by_name\";\nimport \"../../../../../components/buttons/ha-call-service-button\";\nimport \"../../../../../components/ha-card\";\nimport \"../../../../../components/ha-icon\";\nimport \"../../../../../components/ha-icon-button\";\nimport \"../../../../../components/ha-icon-button-arrow-prev\";\nimport \"../../../../../components/ha-menu-button\";\nimport \"../../../../../components/ha-service-description\";\nimport \"../../../../../layouts/ha-app-layout\";\nimport { EventsMixin } from \"../../../../../mixins/events-mixin\";\nimport LocalizeMixin from \"../../../../../mixins/localize-mixin\";\nimport \"../../../../../styles/polymer-ha-style\";\nimport \"../../../ha-config-section\";\nimport \"../../../ha-form-style\";\nimport \"./zwave-groups\";\nimport \"./zwave-log\";\nimport \"./zwave-network\";\nimport \"./zwave-node-config\";\nimport \"./zwave-node-protection\";\nimport \"./zwave-usercodes\";\nimport \"./zwave-values\";\n\n/*\n * @appliesMixin LocalizeMixin\n * @appliesMixin EventsMixin\n */\nclass HaConfigZwave extends LocalizeMixin(EventsMixin(PolymerElement)) {\n  static get template() {\n    return html`\n      <style include=\"iron-flex ha-style ha-form-style\">\n        app-toolbar {\n          border-bottom: 1px solid var(--divider-color);\n        }\n\n        .content {\n          margin-top: 24px;\n        }\n\n        .sectionHeader {\n          position: relative;\n          padding-right: 40px;\n        }\n\n        .node-info {\n          margin-left: 16px;\n        }\n\n        .help-text {\n          padding-left: 24px;\n          padding-right: 24px;\n        }\n\n        ha-card {\n          margin: 0 auto;\n          max-width: 600px;\n        }\n\n        .device-picker {\n          @apply --layout-horizontal;\n          @apply --layout-center-center;\n          padding-left: 24px;\n          padding-right: 24px;\n          padding-bottom: 24px;\n        }\n\n        ha-service-description {\n          display: block;\n          color: grey;\n        }\n\n        ha-service-description[hidden] {\n          display: none;\n        }\n\n        .toggle-help-icon {\n          position: absolute;\n          top: -6px;\n          right: 0;\n          color: var(--primary-color);\n        }\n      </style>\n      <ha-app-layout>\n        <app-header slot=\"header\" fixed=\"\">\n          <app-toolbar>\n            <ha-icon-button-arrow-prev\n              hass=\"[[hass]]\"\n              on-click=\"_backTapped\"\n            ></ha-icon-button-arrow-prev>\n            <div main-title=\"\">[[localize('component.zwave.title')]]</div>\n          </app-toolbar>\n        </app-header>\n\n        <ha-config-section is-wide=\"[[isWide]]\">\n          <ha-card\n            class=\"content\"\n            header=\"[[localize('ui.panel.config.zwave.migration.zwave_js.header')]]\"\n          >\n            <div class=\"card-content\">\n              [[localize('ui.panel.config.zwave.migration.zwave_js.introduction')]]\n            </div>\n            <div class=\"card-actions\">\n              <a href=\"/config/zwave/migration\"\n                ><mwc-button>Start Migration to Z-Wave JS</mwc-button></a\n              >\n            </div>\n          </ha-card>\n        </ha-config-section>\n\n        <zwave-network\n          id=\"zwave-network\"\n          is-wide=\"[[isWide]]\"\n          hass=\"[[hass]]\"\n        ></zwave-network>\n\n        <!-- Node card -->\n        <ha-config-section is-wide=\"[[isWide]]\">\n          <div class=\"sectionHeader\" slot=\"header\">\n            <span\n              >[[localize('ui.panel.config.zwave.node_management.header')]]</span\n            >\n            <ha-icon-button\n              class=\"toggle-help-icon\"\n              on-click=\"toggleHelp\"\n              label=\"[[localize('ui.common.help')]]\"\n            >\n              <ha-icon icon=\"hass:help-circle\"></ha-icon>\n            </ha-icon-button>\n          </div>\n          <span slot=\"introduction\">\n            [[localize('ui.panel.config.zwave.node_management.introduction')]]\n          </span>\n\n          <ha-card class=\"content\">\n            <div class=\"device-picker\">\n              <paper-dropdown-menu\n                dynamic-align=\"\"\n                label=\"[[localize('ui.panel.config.zwave.node_management.nodes')]]\"\n                class=\"flex\"\n              >\n                <paper-listbox\n                  slot=\"dropdown-content\"\n                  selected=\"{{selectedNode}}\"\n                >\n                  <template is=\"dom-repeat\" items=\"[[nodes]]\" as=\"state\">\n                    <paper-item>[[computeSelectCaption(state)]]</paper-item>\n                  </template>\n                </paper-listbox>\n              </paper-dropdown-menu>\n            </div>\n            <template is=\"dom-if\" if=\"[[!computeIsNodeSelected(selectedNode)]]\">\n              <template is=\"dom-if\" if=\"[[showHelp]]\">\n                <div style=\"color: grey; padding: 12px\">\n                  [[localize('ui.panel.config.zwave.node_management.introduction')]]\n                </div>\n              </template>\n            </template>\n\n            <template is=\"dom-if\" if=\"[[computeIsNodeSelected(selectedNode)]]\">\n              <div class=\"card-actions\">\n                <ha-call-service-button\n                  hass=\"[[hass]]\"\n                  domain=\"zwave\"\n                  service=\"refresh_node\"\n                  service-data=\"[[computeNodeServiceData(selectedNode)]]\"\n                >\n                  [[localize('ui.panel.config.zwave.services.refresh_node')]]\n                </ha-call-service-button>\n                <ha-service-description\n                  hass=\"[[hass]]\"\n                  domain=\"zwave\"\n                  service=\"refresh_node\"\n                  hidden$=\"[[!showHelp]]\"\n                >\n                </ha-service-description>\n\n                <template is=\"dom-if\" if=\"[[nodeFailed]]\">\n                  <ha-call-service-button\n                    hass=\"[[hass]]\"\n                    domain=\"zwave\"\n                    service=\"remove_failed_node\"\n                    service-data=\"[[computeNodeServiceData(selectedNode)]]\"\n                  >\n                    [[localize('ui.panel.config.zwave.services.remove_failed_node')]]\n                  </ha-call-service-button>\n                  <ha-service-description\n                    hass=\"[[hass]]\"\n                    domain=\"zwave\"\n                    service=\"remove_failed_node\"\n                    hidden$=\"[[!showHelp]]\"\n                  >\n                  </ha-service-description>\n\n                  <ha-call-service-button\n                    hass=\"[[hass]]\"\n                    domain=\"zwave\"\n                    service=\"replace_failed_node\"\n                    service-data=\"[[computeNodeServiceData(selectedNode)]]\"\n                  >\n                    [[localize('ui.panel.config.zwave.services.replace_failed_node')]]\n                  </ha-call-service-button>\n                  <ha-service-description\n                    hass=\"[[hass]]\"\n                    domain=\"zwave\"\n                    service=\"replace_failed_node\"\n                    hidden$=\"[[!showHelp]]\"\n                  >\n                  </ha-service-description>\n                </template>\n\n                <ha-call-service-button\n                  hass=\"[[hass]]\"\n                  domain=\"zwave\"\n                  service=\"print_node\"\n                  service-data=\"[[computeNodeServiceData(selectedNode)]]\"\n                >\n                  [[localize('ui.panel.config.zwave.services.print_node')]]\n                </ha-call-service-button>\n                <ha-service-description\n                  hass=\"[[hass]]\"\n                  domain=\"zwave\"\n                  service=\"print_node\"\n                  hidden$=\"[[!showHelp]]\"\n                >\n                </ha-service-description>\n\n                <ha-call-service-button\n                  hass=\"[[hass]]\"\n                  domain=\"zwave\"\n                  service=\"heal_node\"\n                  service-data=\"[[computeHealNodeServiceData(selectedNode)]]\"\n                >\n                  [[localize('ui.panel.config.zwave.services.heal_node')]]\n                </ha-call-service-button>\n                <ha-service-description\n                  hass=\"[[hass]]\"\n                  domain=\"zwave\"\n                  service=\"heal_node\"\n                  hidden$=\"[[!showHelp]]\"\n                >\n                </ha-service-description>\n\n                <ha-call-service-button\n                  hass=\"[[hass]]\"\n                  domain=\"zwave\"\n                  service=\"test_node\"\n                  service-data=\"[[computeNodeServiceData(selectedNode)]]\"\n                >\n                  [[localize('ui.panel.config.zwave.services.test_node')]]\n                </ha-call-service-button>\n                <ha-service-description\n                  hass=\"[[hass]]\"\n                  domain=\"zwave\"\n                  service=\"test_node\"\n                  hidden$=\"[[!showHelp]]\"\n                >\n                </ha-service-description>\n                <mwc-button on-click=\"_nodeMoreInfo\"\n                  >[[localize('ui.panel.config.zwave.services.node_info')]]</mwc-button\n                >\n              </div>\n\n              <div class=\"device-picker\">\n                <paper-dropdown-menu\n                  label=\"[[localize('ui.panel.config.zwave.node_management.entities')]]\"\n                  dynamic-align=\"\"\n                  class=\"flex\"\n                >\n                  <paper-listbox\n                    slot=\"dropdown-content\"\n                    selected=\"{{selectedEntity}}\"\n                  >\n                    <template is=\"dom-repeat\" items=\"[[entities]]\" as=\"state\">\n                      <paper-item>[[state.entity_id]]</paper-item>\n                    </template>\n                  </paper-listbox>\n                </paper-dropdown-menu>\n              </div>\n              <template\n                is=\"dom-if\"\n                if=\"[[!computeIsEntitySelected(selectedEntity)]]\"\n              >\n                <div class=\"card-actions\">\n                  <ha-call-service-button\n                    hass=\"[[hass]]\"\n                    domain=\"zwave\"\n                    service=\"refresh_entity\"\n                    service-data=\"[[computeRefreshEntityServiceData(selectedEntity)]]\"\n                  >\n                    [[localize('ui.panel.config.zwave.services.refresh_entity')]]\n                  </ha-call-service-button>\n                  <ha-service-description\n                    hass=\"[[hass]]\"\n                    domain=\"zwave\"\n                    service=\"refresh_entity\"\n                    hidden$=\"[[!showHelp]]\"\n                  >\n                  </ha-service-description>\n                  <mwc-button on-click=\"_entityMoreInfo\"\n                    >[[localize('ui.panel.config.zwave.node_management.entity_info')]]</mwc-button\n                  >\n                </div>\n                <div class=\"form-group\">\n                  <ha-formfield\n                    label=\"[[localize('ui.panel.config.zwave.node_management.exclude_entity')]]\"\n                  >\n                    <ha-checkbox\n                      checked=\"[[entityIgnored]]\"\n                      class=\"form-control\"\n                      on-change=\"entityIgnoredChanged\"\n                    >\n                    </ha-checkbox>\n                  </ha-formfield>\n                  <paper-input\n                    disabled=\"{{entityIgnored}}\"\n                    label=\"[[localize('ui.panel.config.zwave.node_management.pooling_intensity')]]\"\n                    type=\"number\"\n                    min=\"0\"\n                    value=\"{{entityPollingIntensity}}\"\n                  >\n                  </paper-input>\n                </div>\n                <div class=\"card-actions\">\n                  <ha-call-service-button\n                    hass=\"[[hass]]\"\n                    domain=\"zwave\"\n                    service=\"set_poll_intensity\"\n                    service-data=\"[[computePollIntensityServiceData(entityPollingIntensity)]]\"\n                  >\n                    [[localize('ui.common.save')]]\n                  </ha-call-service-button>\n                </div>\n              </template>\n            </template>\n          </ha-card>\n\n          <template is=\"dom-if\" if=\"[[computeIsNodeSelected(selectedNode)]]\">\n            <!-- Value card -->\n            <zwave-values\n              hass=\"[[hass]]\"\n              nodes=\"[[nodes]]\"\n              selected-node=\"[[selectedNode]]\"\n              values=\"[[values]]\"\n            ></zwave-values>\n\n            <!-- Group card -->\n            <zwave-groups\n              hass=\"[[hass]]\"\n              nodes=\"[[nodes]]\"\n              selected-node=\"[[selectedNode]]\"\n              groups=\"[[groups]]\"\n            ></zwave-groups>\n\n            <!-- Config card -->\n            <zwave-node-config\n              hass=\"[[hass]]\"\n              nodes=\"[[nodes]]\"\n              selected-node=\"[[selectedNode]]\"\n              config=\"[[config]]\"\n            ></zwave-node-config>\n          </template>\n\n          <!-- Protection card -->\n          <template is=\"dom-if\" if=\"{{_protectionNode}}\">\n            <zwave-node-protection\n              hass=\"[[hass]]\"\n              nodes=\"[[nodes]]\"\n              selected-node=\"[[selectedNode]]\"\n              protection=\"[[_protection]]\"\n            ></zwave-node-protection>\n          </template>\n\n          <!-- User Codes -->\n          <template is=\"dom-if\" if=\"{{hasNodeUserCodes}}\">\n            <zwave-usercodes\n              id=\"zwave-usercodes\"\n              hass=\"[[hass]]\"\n              nodes=\"[[nodes]]\"\n              user-codes=\"[[userCodes]]\"\n              selected-node=\"[[selectedNode]]\"\n            ></zwave-usercodes>\n          </template>\n        </ha-config-section>\n\n        <!-- Ozw log -->\n        <ozw-log is-wide=\"[[isWide]]\" hass=\"[[hass]]\"></ozw-log>\n      </ha-app-layout>\n    `;\n  }\n\n  static get properties() {\n    return {\n      hass: Object,\n\n      isWide: Boolean,\n\n      nodes: {\n        type: Array,\n        computed: \"computeNodes(hass)\",\n      },\n\n      selectedNode: {\n        type: Number,\n        value: -1,\n        observer: \"selectedNodeChanged\",\n      },\n\n      nodeFailed: {\n        type: Boolean,\n        value: false,\n      },\n\n      config: {\n        type: Array,\n        value: () => [],\n      },\n\n      entities: {\n        type: Array,\n        computed: \"computeEntities(selectedNode)\",\n      },\n\n      selectedEntity: {\n        type: Number,\n        value: -1,\n        observer: \"selectedEntityChanged\",\n      },\n\n      values: {\n        type: Array,\n      },\n\n      groups: {\n        type: Array,\n      },\n\n      userCodes: {\n        type: Array,\n        value: () => [],\n      },\n\n      hasNodeUserCodes: {\n        type: Boolean,\n        value: false,\n      },\n\n      showHelp: {\n        type: Boolean,\n        value: false,\n      },\n\n      entityIgnored: Boolean,\n\n      entityPollingIntensity: {\n        type: Number,\n        value: 0,\n      },\n\n      _protection: {\n        type: Array,\n        value: () => [],\n      },\n\n      _protectionNode: {\n        type: Boolean,\n        value: false,\n      },\n    };\n  }\n\n  ready() {\n    super.ready();\n    this.addEventListener(\"hass-service-called\", (ev) =>\n      this.serviceCalled(ev)\n    );\n  }\n\n  serviceCalled(ev) {\n    if (ev.detail.success && ev.detail.service === \"set_poll_intensity\") {\n      this._saveEntity();\n    }\n  }\n\n  computeNodes(hass) {\n    return Object.keys(hass.states)\n      .map((key) => hass.states[key])\n      .filter((ent) => ent.entity_id.match(\"zwave[.]\"))\n      .sort(sortStatesByName);\n  }\n\n  computeEntities(selectedNode) {\n    if (!this.nodes || selectedNode === -1) {\n      return -1;\n    }\n    const nodeid = this.nodes[this.selectedNode].attributes.node_id;\n    const hass = this.hass;\n    return Object.keys(this.hass.states)\n      .map((key) => hass.states[key])\n      .filter((ent) => {\n        if (ent.attributes.node_id === undefined) {\n          return false;\n        }\n        return (\n          \"node_id\" in ent.attributes &&\n          ent.attributes.node_id === nodeid &&\n          !ent.entity_id.match(\"zwave[.]\")\n        );\n      })\n      .sort(sortStatesByName);\n  }\n\n  selectedNodeChanged(selectedNode) {\n    if (selectedNode === -1) {\n      return;\n    }\n    this.selectedEntity = -1;\n\n    this.hass\n      .callApi(\n        \"GET\",\n        `zwave/config/${this.nodes[selectedNode].attributes.node_id}`\n      )\n      .then((configs) => {\n        this.config = this._objToArray(configs);\n      });\n\n    this.hass\n      .callApi(\n        \"GET\",\n        `zwave/values/${this.nodes[selectedNode].attributes.node_id}`\n      )\n      .then((values) => {\n        this.values = this._objToArray(values);\n      });\n\n    this.hass\n      .callApi(\n        \"GET\",\n        `zwave/groups/${this.nodes[selectedNode].attributes.node_id}`\n      )\n      .then((groups) => {\n        this.groups = this._objToArray(groups);\n      });\n\n    this.hasNodeUserCodes = false;\n    this.notifyPath(\"hasNodeUserCodes\");\n    this.hass\n      .callApi(\n        \"GET\",\n        `zwave/usercodes/${this.nodes[selectedNode].attributes.node_id}`\n      )\n      .then((usercodes) => {\n        this.userCodes = this._objToArray(usercodes);\n        this.hasNodeUserCodes = this.userCodes.length > 0;\n        this.notifyPath(\"hasNodeUserCodes\");\n      });\n    this.hass\n      .callApi(\n        \"GET\",\n        `zwave/protection/${this.nodes[selectedNode].attributes.node_id}`\n      )\n      .then((protections) => {\n        this._protection = this._objToArray(protections);\n        if (this._protection) {\n          if (this._protection.length === 0) {\n            return;\n          }\n          this._protectionNode = true;\n        }\n      });\n\n    this.nodeFailed = this.nodes[selectedNode].attributes.is_failed;\n  }\n\n  selectedEntityChanged(selectedEntity) {\n    if (selectedEntity === -1) {\n      return;\n    }\n    this.hass\n      .callApi(\n        \"GET\",\n        `zwave/values/${this.nodes[this.selectedNode].attributes.node_id}`\n      )\n      .then((values) => {\n        this.values = this._objToArray(values);\n      });\n\n    const valueId = this.entities[selectedEntity].attributes.value_id;\n    const valueData = this.values.find((obj) => obj.key === valueId);\n    const valueIndex = this.values.indexOf(valueData);\n    this.hass\n      .callApi(\n        \"GET\",\n        `config/zwave/device_config/${this.entities[selectedEntity].entity_id}`\n      )\n      .then((data) => {\n        this.setProperties({\n          entityIgnored: data.ignored || false,\n          entityPollingIntensity: this.values[valueIndex].value.poll_intensity,\n        });\n      })\n      .catch(() => {\n        this.setProperties({\n          entityIgnored: false,\n          entityPollingIntensity: this.values[valueIndex].value.poll_intensity,\n        });\n      });\n  }\n\n  computeSelectCaption(stateObj) {\n    return (\n      computeStateName(stateObj) +\n      \" (Node:\" +\n      stateObj.attributes.node_id +\n      \" \" +\n      stateObj.attributes.query_stage +\n      \")\"\n    );\n  }\n\n  computeSelectCaptionEnt(stateObj) {\n    return computeStateDomain(stateObj) + \".\" + computeStateName(stateObj);\n  }\n\n  computeIsNodeSelected() {\n    return this.nodes && this.selectedNode !== -1;\n  }\n\n  computeIsEntitySelected(selectedEntity) {\n    return selectedEntity === -1;\n  }\n\n  computeNodeServiceData(selectedNode) {\n    return { node_id: this.nodes[selectedNode].attributes.node_id };\n  }\n\n  computeHealNodeServiceData(selectedNode) {\n    return {\n      node_id: this.nodes[selectedNode].attributes.node_id,\n      return_routes: true,\n    };\n  }\n\n  computeRefreshEntityServiceData(selectedEntity) {\n    if (selectedEntity === -1) {\n      return -1;\n    }\n    return { entity_id: this.entities[selectedEntity].entity_id };\n  }\n\n  computePollIntensityServiceData(entityPollingIntensity) {\n    if (this.selectedNode === -1 || this.selectedEntity === -1) {\n      return -1;\n    }\n    return {\n      node_id: this.nodes[this.selectedNode].attributes.node_id,\n      value_id: this.entities[this.selectedEntity].attributes.value_id,\n      poll_intensity: parseInt(entityPollingIntensity),\n    };\n  }\n\n  _nodeMoreInfo() {\n    this.fire(\"hass-more-info\", {\n      entityId: this.nodes[this.selectedNode].entity_id,\n    });\n  }\n\n  _entityMoreInfo() {\n    this.fire(\"hass-more-info\", {\n      entityId: this.entities[this.selectedEntity].entity_id,\n    });\n  }\n\n  _saveEntity() {\n    const data = {\n      ignored: this.entityIgnored,\n      polling_intensity: parseInt(this.entityPollingIntensity),\n    };\n    return this.hass.callApi(\n      \"POST\",\n      `config/zwave/device_config/${\n        this.entities[this.selectedEntity].entity_id\n      }`,\n      data\n    );\n  }\n\n  toggleHelp() {\n    this.showHelp = !this.showHelp;\n  }\n\n  _objToArray(obj) {\n    const array = [];\n    Object.keys(obj).forEach((key) => {\n      array.push({\n        key,\n        value: obj[key],\n      });\n    });\n    return array;\n  }\n\n  _backTapped() {\n    history.back();\n  }\n\n  entityIgnoredChanged(ev) {\n    this.entityIgnored = ev.target.checked;\n  }\n}\n\ncustomElements.define(\"ha-config-zwave\", HaConfigZwave);\n"],"names":[],"sourceRoot":""}