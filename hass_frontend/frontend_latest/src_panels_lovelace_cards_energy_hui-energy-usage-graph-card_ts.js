"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(self["webpackChunkhome_assistant_frontend"] = self["webpackChunkhome_assistant_frontend"] || []).push([["src_panels_lovelace_cards_energy_hui-energy-usage-graph-card_ts"],{

/***/ "./src/mixins/subscribe-mixin.ts":
/*!***************************************!*\
  !*** ./src/mixins/subscribe-mixin.ts ***!
  \***************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   SubscribeMixin: () => (/* binding */ SubscribeMixin)\n/* harmony export */ });\n/* harmony import */ var _babel_runtime_helpers_decorate__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @babel/runtime/helpers/decorate */ \"./node_modules/@babel/runtime/helpers/esm/decorate.js\");\n/* harmony import */ var _babel_runtime_helpers_get__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @babel/runtime/helpers/get */ \"./node_modules/@babel/runtime/helpers/esm/get.js\");\n/* harmony import */ var _babel_runtime_helpers_getPrototypeOf__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @babel/runtime/helpers/getPrototypeOf */ \"./node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js\");\n/* harmony import */ var lit_decorators__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! lit/decorators */ \"./node_modules/lit/decorators.js\");\n\n\n\n\nconst SubscribeMixin = superClass => {\n  let SubscribeClass = (0,_babel_runtime_helpers_decorate__WEBPACK_IMPORTED_MODULE_0__[\"default\"])(null, function (_initialize, _superClass) {\n    class SubscribeClass extends _superClass {\n      constructor(...args) {\n        super(...args);\n        _initialize(this);\n      }\n    }\n    return {\n      F: SubscribeClass,\n      d: [{\n        kind: \"field\",\n        decorators: [(0,lit_decorators__WEBPACK_IMPORTED_MODULE_3__.property)({\n          attribute: false\n        })],\n        key: \"hass\",\n        value: void 0\n      }, {\n        kind: \"field\",\n        key: \"hassSubscribeRequiredHostProps\",\n        value: void 0\n      }, {\n        kind: \"field\",\n        key: \"__unsubs\",\n        value: void 0\n      }, {\n        kind: \"method\",\n        key: \"connectedCallback\",\n        value:\n        // we wait with subscribing till these properties are set on the host element\n\n        function connectedCallback() {\n          (0,_babel_runtime_helpers_get__WEBPACK_IMPORTED_MODULE_1__[\"default\"])((0,_babel_runtime_helpers_getPrototypeOf__WEBPACK_IMPORTED_MODULE_2__[\"default\"])(SubscribeClass.prototype), \"connectedCallback\", this).call(this);\n          this.__checkSubscribed();\n        }\n      }, {\n        kind: \"method\",\n        key: \"disconnectedCallback\",\n        value: function disconnectedCallback() {\n          (0,_babel_runtime_helpers_get__WEBPACK_IMPORTED_MODULE_1__[\"default\"])((0,_babel_runtime_helpers_getPrototypeOf__WEBPACK_IMPORTED_MODULE_2__[\"default\"])(SubscribeClass.prototype), \"disconnectedCallback\", this).call(this);\n          if (this.__unsubs) {\n            while (this.__unsubs.length) {\n              const unsub = this.__unsubs.pop();\n              if (unsub instanceof Promise) {\n                unsub.then(unsubFunc => unsubFunc());\n              } else {\n                unsub();\n              }\n            }\n            this.__unsubs = undefined;\n          }\n        }\n      }, {\n        kind: \"method\",\n        key: \"updated\",\n        value: function updated(changedProps) {\n          (0,_babel_runtime_helpers_get__WEBPACK_IMPORTED_MODULE_1__[\"default\"])((0,_babel_runtime_helpers_getPrototypeOf__WEBPACK_IMPORTED_MODULE_2__[\"default\"])(SubscribeClass.prototype), \"updated\", this).call(this, changedProps);\n          if (changedProps.has(\"hass\")) {\n            this.__checkSubscribed();\n            return;\n          }\n          if (!this.hassSubscribeRequiredHostProps) {\n            return;\n          }\n          for (const key of changedProps.keys()) {\n            if (this.hassSubscribeRequiredHostProps.includes(key)) {\n              this.__checkSubscribed();\n              return;\n            }\n          }\n        }\n      }, {\n        kind: \"method\",\n        key: \"hassSubscribe\",\n        value: function hassSubscribe() {\n          return [];\n        }\n      }, {\n        kind: \"method\",\n        key: \"__checkSubscribed\",\n        value: function __checkSubscribed() {\n          var _this$hassSubscribeRe;\n          if (this.__unsubs !== undefined || !this.isConnected || this.hass === undefined || (_this$hassSubscribeRe = this.hassSubscribeRequiredHostProps) !== null && _this$hassSubscribeRe !== void 0 && _this$hassSubscribeRe.some(prop => this[prop] === undefined)) {\n            return;\n          }\n          this.__unsubs = this.hassSubscribe();\n        }\n      }]\n    };\n  }, superClass);\n  return SubscribeClass;\n};//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvbWl4aW5zL3N1YnNjcmliZS1taXhpbi50cy5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUVBO0FBT0E7QUFFQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFnRUE7QUFBQTtBQUFBO0FBaEVBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7O0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUtBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQ0E7QUFRQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQ0EiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9ob21lLWFzc2lzdGFudC1mcm9udGVuZC8uL3NyYy9taXhpbnMvc3Vic2NyaWJlLW1peGluLnRzP2Y1YjEiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgVW5zdWJzY3JpYmVGdW5jIH0gZnJvbSBcImhvbWUtYXNzaXN0YW50LWpzLXdlYnNvY2tldFwiO1xuaW1wb3J0IHsgUHJvcGVydHlWYWx1ZXMsIFJlYWN0aXZlRWxlbWVudCB9IGZyb20gXCJsaXRcIjtcbmltcG9ydCB7IHByb3BlcnR5IH0gZnJvbSBcImxpdC9kZWNvcmF0b3JzXCI7XG5pbXBvcnQgeyBDb25zdHJ1Y3RvciwgSG9tZUFzc2lzdGFudCB9IGZyb20gXCIuLi90eXBlc1wiO1xuXG5leHBvcnQgaW50ZXJmYWNlIEhhc3NTdWJzY3JpYmVFbGVtZW50IHtcbiAgaGFzc1N1YnNjcmliZSgpOiBVbnN1YnNjcmliZUZ1bmNbXTtcbn1cblxuZXhwb3J0IGNvbnN0IFN1YnNjcmliZU1peGluID0gPFQgZXh0ZW5kcyBDb25zdHJ1Y3RvcjxSZWFjdGl2ZUVsZW1lbnQ+PihcbiAgc3VwZXJDbGFzczogVFxuKSA9PiB7XG4gIGNsYXNzIFN1YnNjcmliZUNsYXNzIGV4dGVuZHMgc3VwZXJDbGFzcyB7XG4gICAgQHByb3BlcnR5KHsgYXR0cmlidXRlOiBmYWxzZSB9KSBwdWJsaWMgaGFzcz86IEhvbWVBc3Npc3RhbnQ7XG5cbiAgICAvLyB3ZSB3YWl0IHdpdGggc3Vic2NyaWJpbmcgdGlsbCB0aGVzZSBwcm9wZXJ0aWVzIGFyZSBzZXQgb24gdGhlIGhvc3QgZWxlbWVudFxuICAgIHByb3RlY3RlZCBoYXNzU3Vic2NyaWJlUmVxdWlyZWRIb3N0UHJvcHM/OiBzdHJpbmdbXTtcblxuICAgIHByaXZhdGUgX191bnN1YnM/OiBBcnJheTxVbnN1YnNjcmliZUZ1bmMgfCBQcm9taXNlPFVuc3Vic2NyaWJlRnVuYz4+O1xuXG4gICAgcHVibGljIGNvbm5lY3RlZENhbGxiYWNrKCkge1xuICAgICAgc3VwZXIuY29ubmVjdGVkQ2FsbGJhY2soKTtcbiAgICAgIHRoaXMuX19jaGVja1N1YnNjcmliZWQoKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgZGlzY29ubmVjdGVkQ2FsbGJhY2soKSB7XG4gICAgICBzdXBlci5kaXNjb25uZWN0ZWRDYWxsYmFjaygpO1xuICAgICAgaWYgKHRoaXMuX191bnN1YnMpIHtcbiAgICAgICAgd2hpbGUgKHRoaXMuX191bnN1YnMubGVuZ3RoKSB7XG4gICAgICAgICAgY29uc3QgdW5zdWIgPSB0aGlzLl9fdW5zdWJzLnBvcCgpITtcbiAgICAgICAgICBpZiAodW5zdWIgaW5zdGFuY2VvZiBQcm9taXNlKSB7XG4gICAgICAgICAgICB1bnN1Yi50aGVuKCh1bnN1YkZ1bmMpID0+IHVuc3ViRnVuYygpKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdW5zdWIoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fX3Vuc3VicyA9IHVuZGVmaW5lZDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgdXBkYXRlZChjaGFuZ2VkUHJvcHM6IFByb3BlcnR5VmFsdWVzKSB7XG4gICAgICBzdXBlci51cGRhdGVkKGNoYW5nZWRQcm9wcyk7XG4gICAgICBpZiAoY2hhbmdlZFByb3BzLmhhcyhcImhhc3NcIikpIHtcbiAgICAgICAgdGhpcy5fX2NoZWNrU3Vic2NyaWJlZCgpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBpZiAoIXRoaXMuaGFzc1N1YnNjcmliZVJlcXVpcmVkSG9zdFByb3BzKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGZvciAoY29uc3Qga2V5IG9mIGNoYW5nZWRQcm9wcy5rZXlzKCkpIHtcbiAgICAgICAgaWYgKHRoaXMuaGFzc1N1YnNjcmliZVJlcXVpcmVkSG9zdFByb3BzLmluY2x1ZGVzKGtleSBhcyBzdHJpbmcpKSB7XG4gICAgICAgICAgdGhpcy5fX2NoZWNrU3Vic2NyaWJlZCgpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHByb3RlY3RlZCBoYXNzU3Vic2NyaWJlKCk6IEFycmF5PFxuICAgICAgVW5zdWJzY3JpYmVGdW5jIHwgUHJvbWlzZTxVbnN1YnNjcmliZUZ1bmM+XG4gICAgPiB7XG4gICAgICByZXR1cm4gW107XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBfX2NoZWNrU3Vic2NyaWJlZCgpOiB2b2lkIHtcbiAgICAgIGlmIChcbiAgICAgICAgdGhpcy5fX3Vuc3VicyAhPT0gdW5kZWZpbmVkIHx8XG4gICAgICAgICEodGhpcyBhcyB1bmtub3duIGFzIEVsZW1lbnQpLmlzQ29ubmVjdGVkIHx8XG4gICAgICAgIHRoaXMuaGFzcyA9PT0gdW5kZWZpbmVkIHx8XG4gICAgICAgIHRoaXMuaGFzc1N1YnNjcmliZVJlcXVpcmVkSG9zdFByb3BzPy5zb21lKFxuICAgICAgICAgIChwcm9wKSA9PiB0aGlzW3Byb3BdID09PSB1bmRlZmluZWRcbiAgICAgICAgKVxuICAgICAgKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHRoaXMuX191bnN1YnMgPSB0aGlzLmhhc3NTdWJzY3JpYmUoKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIFN1YnNjcmliZUNsYXNzO1xufTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/mixins/subscribe-mixin.ts\n");

/***/ }),

/***/ "./src/panels/lovelace/cards/energy/hui-energy-usage-graph-card.ts":
/*!*************************************************************************!*\
  !*** ./src/panels/lovelace/cards/energy/hui-energy-usage-graph-card.ts ***!
  \*************************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   HuiEnergyUsageGraphCard: () => (/* binding */ HuiEnergyUsageGraphCard)\n/* harmony export */ });\n/* harmony import */ var _babel_runtime_helpers_decorate__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @babel/runtime/helpers/decorate */ \"./node_modules/@babel/runtime/helpers/esm/decorate.js\");\n/* harmony import */ var date_fns_esm__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! date-fns/esm */ \"./node_modules/date-fns/esm/startOfToday/index.js\");\n/* harmony import */ var date_fns_esm__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! date-fns/esm */ \"./node_modules/date-fns/esm/endOfToday/index.js\");\n/* harmony import */ var date_fns_esm__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! date-fns/esm */ \"./node_modules/date-fns/esm/isToday/index.js\");\n/* harmony import */ var date_fns_esm__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! date-fns/esm */ \"./node_modules/date-fns/esm/differenceInDays/index.js\");\n/* harmony import */ var date_fns_esm__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! date-fns/esm */ \"./node_modules/date-fns/esm/differenceInHours/index.js\");\n/* harmony import */ var date_fns_esm__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! date-fns/esm */ \"./node_modules/date-fns/esm/addHours/index.js\");\n/* harmony import */ var lit__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! lit */ \"./node_modules/lit/index.js\");\n/* harmony import */ var lit_decorators__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! lit/decorators */ \"./node_modules/lit/decorators.js\");\n/* harmony import */ var lit_directives_class_map__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! lit/directives/class-map */ \"./node_modules/lit/directives/class-map.js\");\n/* harmony import */ var memoize_one__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! memoize-one */ \"./node_modules/memoize-one/dist/memoize-one.esm.js\");\n/* harmony import */ var _common_color_convert_color__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../../common/color/convert-color */ \"./src/common/color/convert-color.ts\");\n/* harmony import */ var _common_color_lab__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../../common/color/lab */ \"./src/common/color/lab.ts\");\n/* harmony import */ var _common_datetime_format_date__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../../common/datetime/format_date */ \"./src/common/datetime/format_date.ts\");\n/* harmony import */ var _common_datetime_format_time__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../../common/datetime/format_time */ \"./src/common/datetime/format_time.ts\");\n/* harmony import */ var _common_number_format_number__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../../common/number/format_number */ \"./src/common/number/format_number.ts\");\n/* harmony import */ var _components_chart_ha_chart_base__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../../components/chart/ha-chart-base */ \"./src/components/chart/ha-chart-base.ts\");\n/* harmony import */ var _components_ha_card__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../../components/ha-card */ \"./src/components/ha-card.ts\");\n/* harmony import */ var _data_energy__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../../data/energy */ \"./src/data/energy.ts\");\n/* harmony import */ var _data_recorder__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../../data/recorder */ \"./src/data/recorder.ts\");\n/* harmony import */ var _mixins_subscribe_mixin__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../../../mixins/subscribe-mixin */ \"./src/mixins/subscribe-mixin.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_common_datetime_format_date__WEBPACK_IMPORTED_MODULE_6__, _common_datetime_format_time__WEBPACK_IMPORTED_MODULE_7__]);\n([_common_datetime_format_date__WEBPACK_IMPORTED_MODULE_6__, _common_datetime_format_time__WEBPACK_IMPORTED_MODULE_7__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nlet HuiEnergyUsageGraphCard = (0,_babel_runtime_helpers_decorate__WEBPACK_IMPORTED_MODULE_0__[\"default\"])([(0,lit_decorators__WEBPACK_IMPORTED_MODULE_2__.customElement)(\"hui-energy-usage-graph-card\")], function (_initialize, _SubscribeMixin) {\n  class HuiEnergyUsageGraphCard extends _SubscribeMixin {\n    constructor(...args) {\n      super(...args);\n      _initialize(this);\n    }\n  }\n  return {\n    F: HuiEnergyUsageGraphCard,\n    d: [{\n      kind: \"field\",\n      decorators: [(0,lit_decorators__WEBPACK_IMPORTED_MODULE_2__.property)({\n        attribute: false\n      })],\n      key: \"hass\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [(0,lit_decorators__WEBPACK_IMPORTED_MODULE_2__.state)()],\n      key: \"_config\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [(0,lit_decorators__WEBPACK_IMPORTED_MODULE_2__.state)()],\n      key: \"_chartData\",\n      value() {\n        return {\n          datasets: []\n        };\n      }\n    }, {\n      kind: \"field\",\n      decorators: [(0,lit_decorators__WEBPACK_IMPORTED_MODULE_2__.state)()],\n      key: \"_start\",\n      value() {\n        return (0,date_fns_esm__WEBPACK_IMPORTED_MODULE_14__[\"default\"])();\n      }\n    }, {\n      kind: \"field\",\n      decorators: [(0,lit_decorators__WEBPACK_IMPORTED_MODULE_2__.state)()],\n      key: \"_end\",\n      value() {\n        return (0,date_fns_esm__WEBPACK_IMPORTED_MODULE_15__[\"default\"])();\n      }\n    }, {\n      kind: \"field\",\n      decorators: [(0,lit_decorators__WEBPACK_IMPORTED_MODULE_2__.state)()],\n      key: \"_compareStart\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      decorators: [(0,lit_decorators__WEBPACK_IMPORTED_MODULE_2__.state)()],\n      key: \"_compareEnd\",\n      value: void 0\n    }, {\n      kind: \"field\",\n      key: \"hassSubscribeRequiredHostProps\",\n      value() {\n        return [\"_config\"];\n      }\n    }, {\n      kind: \"method\",\n      key: \"hassSubscribe\",\n      value: function hassSubscribe() {\n        var _this$_config;\n        return [(0,_data_energy__WEBPACK_IMPORTED_MODULE_11__.getEnergyDataCollection)(this.hass, {\n          key: (_this$_config = this._config) === null || _this$_config === void 0 ? void 0 : _this$_config.collection_key\n        }).subscribe(data => this._getStatistics(data))];\n      }\n    }, {\n      kind: \"method\",\n      key: \"getCardSize\",\n      value: function getCardSize() {\n        return 3;\n      }\n    }, {\n      kind: \"method\",\n      key: \"setConfig\",\n      value: function setConfig(config) {\n        this._config = config;\n      }\n    }, {\n      kind: \"method\",\n      key: \"render\",\n      value: function render() {\n        if (!this.hass || !this._config) {\n          return lit__WEBPACK_IMPORTED_MODULE_1__.nothing;\n        }\n        return lit__WEBPACK_IMPORTED_MODULE_1__.html`\n      <ha-card>\n        ${this._config.title ? lit__WEBPACK_IMPORTED_MODULE_1__.html`<h1 class=\"card-header\">${this._config.title}</h1>` : \"\"}\n        <div\n          class=\"content ${(0,lit_directives_class_map__WEBPACK_IMPORTED_MODULE_3__.classMap)({\n          \"has-header\": !!this._config.title\n        })}\"\n        >\n          <ha-chart-base\n            .hass=${this.hass}\n            .data=${this._chartData}\n            .options=${this._createOptions(this._start, this._end, this.hass.locale, this._compareStart, this._compareEnd)}\n            chart-type=\"bar\"\n          ></ha-chart-base>\n          ${!this._chartData.datasets.some(dataset => dataset.data.length) ? lit__WEBPACK_IMPORTED_MODULE_1__.html`<div class=\"no-data\">\n                ${(0,date_fns_esm__WEBPACK_IMPORTED_MODULE_16__[\"default\"])(this._start) ? this.hass.localize(\"ui.panel.lovelace.cards.energy.no_data\") : this.hass.localize(\"ui.panel.lovelace.cards.energy.no_data_period\")}\n              </div>` : \"\"}\n        </div>\n      </ha-card>\n    `;\n      }\n    }, {\n      kind: \"field\",\n      key: \"_createOptions\",\n      value() {\n        return (0,memoize_one__WEBPACK_IMPORTED_MODULE_17__[\"default\"])((start, end, locale, compareStart, compareEnd) => {\n          const dayDifference = (0,date_fns_esm__WEBPACK_IMPORTED_MODULE_18__[\"default\"])(end, start);\n          const compare = compareStart !== undefined && compareEnd !== undefined;\n          if (compare) {\n            const difference = (0,date_fns_esm__WEBPACK_IMPORTED_MODULE_19__[\"default\"])(end, start);\n            const differenceCompare = (0,date_fns_esm__WEBPACK_IMPORTED_MODULE_19__[\"default\"])(compareEnd, compareStart);\n            // If the compare period doesn't match the main period, adjust them to match\n            if (differenceCompare > difference) {\n              end = (0,date_fns_esm__WEBPACK_IMPORTED_MODULE_20__[\"default\"])(end, differenceCompare - difference);\n            } else if (difference > differenceCompare) {\n              compareEnd = (0,date_fns_esm__WEBPACK_IMPORTED_MODULE_20__[\"default\"])(compareEnd, difference - differenceCompare);\n            }\n          }\n          const options = {\n            parsing: false,\n            animation: false,\n            interaction: {\n              mode: \"x\"\n            },\n            scales: {\n              x: {\n                type: \"time\",\n                suggestedMin: start.getTime(),\n                suggestedMax: end.getTime(),\n                adapters: {\n                  date: {\n                    locale: locale\n                  }\n                },\n                ticks: {\n                  maxRotation: 0,\n                  sampleSize: 5,\n                  autoSkipPadding: 20,\n                  font: context => context.tick && context.tick.major ? {\n                    weight: \"bold\"\n                  } : {}\n                },\n                time: {\n                  tooltipFormat: dayDifference > 35 ? \"monthyear\" : dayDifference > 7 ? \"date\" : dayDifference > 2 ? \"weekday\" : dayDifference > 0 ? \"datetime\" : \"hour\",\n                  minUnit: dayDifference > 35 ? \"month\" : dayDifference > 2 ? \"day\" : \"hour\"\n                }\n              },\n              y: {\n                stacked: true,\n                type: \"linear\",\n                title: {\n                  display: true,\n                  text: \"kWh\"\n                },\n                ticks: {\n                  beginAtZero: true,\n                  callback: value => (0,_common_number_format_number__WEBPACK_IMPORTED_MODULE_8__.formatNumber)(Math.abs(value), locale)\n                }\n              }\n            },\n            plugins: {\n              tooltip: {\n                position: \"nearest\",\n                filter: val => val.formattedValue !== \"0\",\n                callbacks: {\n                  title: datasets => {\n                    if (dayDifference > 0) {\n                      return datasets[0].label;\n                    }\n                    const date = new Date(datasets[0].parsed.x);\n                    return `${compare ? `${(0,_common_datetime_format_date__WEBPACK_IMPORTED_MODULE_6__.formatDateShort)(date, locale)}: ` : \"\"}${(0,_common_datetime_format_time__WEBPACK_IMPORTED_MODULE_7__.formatTime)(date, locale)} – ${(0,_common_datetime_format_time__WEBPACK_IMPORTED_MODULE_7__.formatTime)((0,date_fns_esm__WEBPACK_IMPORTED_MODULE_20__[\"default\"])(date, 1), locale)}`;\n                  },\n                  label: context => `${context.dataset.label}: ${(0,_common_number_format_number__WEBPACK_IMPORTED_MODULE_8__.formatNumber)(Math.abs(context.parsed.y), locale)} kWh`,\n                  footer: contexts => {\n                    let totalConsumed = 0;\n                    let totalReturned = 0;\n                    for (const context of contexts) {\n                      const value = context.dataset.data[context.dataIndex].y;\n                      if (value > 0) {\n                        totalConsumed += value;\n                      } else {\n                        totalReturned += Math.abs(value);\n                      }\n                    }\n                    return [totalConsumed ? this.hass.localize(\"ui.panel.lovelace.cards.energy.energy_usage_graph.total_consumed\", {\n                      num: (0,_common_number_format_number__WEBPACK_IMPORTED_MODULE_8__.formatNumber)(totalConsumed, locale)\n                    }) : \"\", totalReturned ? this.hass.localize(\"ui.panel.lovelace.cards.energy.energy_usage_graph.total_returned\", {\n                      num: (0,_common_number_format_number__WEBPACK_IMPORTED_MODULE_8__.formatNumber)(totalReturned, locale)\n                    }) : \"\"].filter(Boolean);\n                  }\n                }\n              },\n              filler: {\n                propagate: false\n              },\n              legend: {\n                display: false,\n                labels: {\n                  usePointStyle: true\n                }\n              }\n            },\n            elements: {\n              bar: {\n                borderWidth: 1.5,\n                borderRadius: 4\n              },\n              point: {\n                hitRadius: 50\n              }\n            },\n            // @ts-expect-error\n            locale: (0,_common_number_format_number__WEBPACK_IMPORTED_MODULE_8__.numberFormatToLocale)(locale)\n          };\n          if (compare) {\n            options.scales.xAxisCompare = {\n              ...options.scales.x,\n              suggestedMin: compareStart.getTime(),\n              suggestedMax: compareEnd.getTime(),\n              display: false\n            };\n          }\n          return options;\n        });\n      }\n    }, {\n      kind: \"method\",\n      key: \"_getStatistics\",\n      value: async function _getStatistics(energyData) {\n        const datasets = [];\n        const statIds = {};\n        for (const source of energyData.prefs.energy_sources) {\n          if (source.type === \"solar\") {\n            if (statIds.solar) {\n              statIds.solar.push(source.stat_energy_from);\n            } else {\n              statIds.solar = [source.stat_energy_from];\n            }\n            continue;\n          }\n          if (source.type === \"battery\") {\n            if (statIds.to_battery) {\n              statIds.to_battery.push(source.stat_energy_to);\n              statIds.from_battery.push(source.stat_energy_from);\n            } else {\n              statIds.to_battery = [source.stat_energy_to];\n              statIds.from_battery = [source.stat_energy_from];\n            }\n            continue;\n          }\n          if (source.type !== \"grid\") {\n            continue;\n          }\n\n          // grid source\n          for (const flowFrom of source.flow_from) {\n            if (statIds.from_grid) {\n              statIds.from_grid.push(flowFrom.stat_energy_from);\n            } else {\n              statIds.from_grid = [flowFrom.stat_energy_from];\n            }\n          }\n          for (const flowTo of source.flow_to) {\n            if (statIds.to_grid) {\n              statIds.to_grid.push(flowTo.stat_energy_to);\n            } else {\n              statIds.to_grid = [flowTo.stat_energy_to];\n            }\n          }\n        }\n        const computedStyles = getComputedStyle(this);\n        const colors = {\n          to_grid: computedStyles.getPropertyValue(\"--energy-grid-return-color\").trim(),\n          to_battery: computedStyles.getPropertyValue(\"--energy-battery-in-color\").trim(),\n          from_grid: computedStyles.getPropertyValue(\"--energy-grid-consumption-color\").trim(),\n          used_grid: computedStyles.getPropertyValue(\"--energy-grid-consumption-color\").trim(),\n          used_solar: computedStyles.getPropertyValue(\"--energy-solar-color\").trim(),\n          used_battery: computedStyles.getPropertyValue(\"--energy-battery-out-color\").trim()\n        };\n        const labels = {\n          used_grid: this.hass.localize(\"ui.panel.lovelace.cards.energy.energy_usage_graph.combined_from_grid\"),\n          used_solar: this.hass.localize(\"ui.panel.lovelace.cards.energy.energy_usage_graph.consumed_solar\"),\n          used_battery: this.hass.localize(\"ui.panel.lovelace.cards.energy.energy_usage_graph.consumed_battery\")\n        };\n        this._start = energyData.start;\n        this._end = energyData.end || (0,date_fns_esm__WEBPACK_IMPORTED_MODULE_15__[\"default\"])();\n        this._compareStart = energyData.startCompare;\n        this._compareEnd = energyData.endCompare;\n        datasets.push(...this._processDataSet(energyData.stats, energyData.statsMetadata, statIds, colors, labels, false));\n        if (energyData.statsCompare) {\n          // Add empty dataset to align the bars\n          datasets.push({\n            order: 0,\n            data: []\n          });\n          datasets.push({\n            order: 999,\n            data: [],\n            xAxisID: \"xAxisCompare\"\n          });\n          datasets.push(...this._processDataSet(energyData.statsCompare, energyData.statsMetadata, statIds, colors, labels, true));\n        }\n        this._chartData = {\n          datasets\n        };\n      }\n    }, {\n      kind: \"method\",\n      key: \"_processDataSet\",\n      value: function _processDataSet(statistics, statisticsMetaData, statIdsByCat, colors, labels, compare = false) {\n        const data = [];\n        const combinedData = {};\n        const summedData = {};\n        Object.entries(statIdsByCat).forEach(([key, statIds]) => {\n          const sum = [\"solar\", \"to_grid\", \"from_grid\", \"to_battery\", \"from_battery\"].includes(key);\n          const add = ![\"solar\", \"from_battery\"].includes(key);\n          const totalStats = {};\n          const sets = {};\n          statIds.forEach(id => {\n            const stats = statistics[id];\n            if (!stats) {\n              return;\n            }\n            const set = {};\n            stats.forEach(stat => {\n              if (stat.change === null || stat.change === undefined) {\n                return;\n              }\n              const val = stat.change;\n              // Get total of solar and to grid to calculate the solar energy used\n              if (sum) {\n                totalStats[stat.start] = stat.start in totalStats ? totalStats[stat.start] + val : val;\n              }\n              if (add && !(stat.start in set)) {\n                set[stat.start] = val;\n              }\n            });\n            sets[id] = set;\n          });\n          if (sum) {\n            summedData[key] = totalStats;\n          }\n          if (add) {\n            combinedData[key] = sets;\n          }\n        });\n        const grid_to_battery = {};\n        const battery_to_grid = {};\n        if ((summedData.to_grid || summedData.to_battery) && summedData.solar) {\n          const used_solar = {};\n          for (const start of Object.keys(summedData.solar)) {\n            var _summedData$to_grid, _summedData$to_batter;\n            used_solar[start] = (summedData.solar[start] || 0) - (((_summedData$to_grid = summedData.to_grid) === null || _summedData$to_grid === void 0 ? void 0 : _summedData$to_grid[start]) || 0) - (((_summedData$to_batter = summedData.to_battery) === null || _summedData$to_batter === void 0 ? void 0 : _summedData$to_batter[start]) || 0);\n            if (used_solar[start] < 0) {\n              if (summedData.to_battery) {\n                var _summedData$from_grid;\n                grid_to_battery[start] = used_solar[start] * -1;\n                if (grid_to_battery[start] > (((_summedData$from_grid = summedData.from_grid) === null || _summedData$from_grid === void 0 ? void 0 : _summedData$from_grid[start]) || 0)) {\n                  var _summedData$from_grid2, _summedData$from_grid3;\n                  battery_to_grid[start] = Math.min(0, grid_to_battery[start] - (((_summedData$from_grid2 = summedData.from_grid) === null || _summedData$from_grid2 === void 0 ? void 0 : _summedData$from_grid2[start]) || 0));\n                  grid_to_battery[start] = (_summedData$from_grid3 = summedData.from_grid) === null || _summedData$from_grid3 === void 0 ? void 0 : _summedData$from_grid3[start];\n                }\n              }\n              used_solar[start] = 0;\n            }\n          }\n          combinedData.used_solar = {\n            used_solar\n          };\n        }\n        if (summedData.from_battery) {\n          if (summedData.to_grid) {\n            const used_battery = {};\n            for (const start of Object.keys(summedData.from_battery)) {\n              used_battery[start] = (summedData.from_battery[start] || 0) - (battery_to_grid[start] || 0);\n            }\n            combinedData.used_battery = {\n              used_battery\n            };\n          } else {\n            combinedData.used_battery = {\n              used_battery: summedData.from_battery\n            };\n          }\n        }\n        if (combinedData.from_grid && summedData.to_battery) {\n          const used_grid = {};\n          for (const start of Object.keys(grid_to_battery)) {\n            let noOfSources = 0;\n            let source;\n            for (const [key, stats] of Object.entries(combinedData.from_grid)) {\n              if (stats[start]) {\n                source = key;\n                noOfSources++;\n              }\n              if (noOfSources > 1) {\n                break;\n              }\n            }\n            if (noOfSources === 1) {\n              combinedData.from_grid[source][start] -= grid_to_battery[start] || 0;\n            } else {\n              let total_from_grid = 0;\n              Object.values(combinedData.from_grid).forEach(stats => {\n                total_from_grid += stats[start] || 0;\n                delete stats[start];\n              });\n              used_grid[start] = total_from_grid - (grid_to_battery[start] || 0);\n            }\n          }\n          combinedData.used_grid = {\n            used_grid\n          };\n        }\n        let allKeys = [];\n        Object.values(combinedData).forEach(sources => {\n          Object.values(sources).forEach(source => {\n            allKeys = allKeys.concat(Object.keys(source));\n          });\n        });\n        const uniqueKeys = Array.from(new Set(allKeys));\n        Object.entries(combinedData).forEach(([type, sources]) => {\n          Object.entries(sources).forEach(([statId, source], idx) => {\n            const modifiedColor = idx > 0 ? this.hass.themes.darkMode ? (0,_common_color_lab__WEBPACK_IMPORTED_MODULE_5__.labBrighten)((0,_common_color_convert_color__WEBPACK_IMPORTED_MODULE_4__.rgb2lab)((0,_common_color_convert_color__WEBPACK_IMPORTED_MODULE_4__.hex2rgb)(colors[type])), idx) : (0,_common_color_lab__WEBPACK_IMPORTED_MODULE_5__.labDarken)((0,_common_color_convert_color__WEBPACK_IMPORTED_MODULE_4__.rgb2lab)((0,_common_color_convert_color__WEBPACK_IMPORTED_MODULE_4__.hex2rgb)(colors[type])), idx) : undefined;\n            const borderColor = modifiedColor ? (0,_common_color_convert_color__WEBPACK_IMPORTED_MODULE_4__.rgb2hex)((0,_common_color_convert_color__WEBPACK_IMPORTED_MODULE_4__.lab2rgb)(modifiedColor)) : colors[type];\n            const points = [];\n            // Process chart data.\n            for (const key of uniqueKeys) {\n              const value = source[key] || 0;\n              points.push({\n                x: Number(key),\n                y: value && [\"to_grid\", \"to_battery\"].includes(type) ? -1 * value : value\n              });\n            }\n            data.push({\n              label: type in labels ? labels[type] : (0,_data_recorder__WEBPACK_IMPORTED_MODULE_12__.getStatisticLabel)(this.hass, statId, statisticsMetaData[statId]),\n              order: type === \"used_solar\" ? 1 : type === \"to_battery\" ? Object.keys(combinedData).length : idx + 2,\n              borderColor: compare ? borderColor + \"7F\" : borderColor,\n              backgroundColor: compare ? borderColor + \"32\" : borderColor + \"7F\",\n              stack: \"stack\",\n              data: points,\n              xAxisID: compare ? \"xAxisCompare\" : undefined\n            });\n          });\n        });\n        return data;\n      }\n    }, {\n      kind: \"get\",\n      static: true,\n      key: \"styles\",\n      value: function styles() {\n        return lit__WEBPACK_IMPORTED_MODULE_1__.css`\n      ha-card {\n        height: 100%;\n      }\n      .card-header {\n        padding-bottom: 0;\n      }\n      .content {\n        padding: 16px;\n      }\n      .has-header {\n        padding-top: 0;\n      }\n      .no-data {\n        position: absolute;\n        height: 100%;\n        top: 0;\n        left: 0;\n        right: 0;\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        padding: 20%;\n        margin-left: 32px;\n        box-sizing: border-box;\n      }\n    `;\n      }\n    }]\n  };\n}, (0,_mixins_subscribe_mixin__WEBPACK_IMPORTED_MODULE_13__.SubscribeMixin)(lit__WEBPACK_IMPORTED_MODULE_1__.LitElement));\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvcGFuZWxzL2xvdmVsYWNlL2NhcmRzL2VuZXJneS9odWktZW5lcmd5LXVzYWdlLWdyYXBoLWNhcmQudHMuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFNQTtBQVNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBTUE7QUFLQTtBQUFBO0FBSUE7QUFBQTtBQUFBO0FBQUE7QUFvbUJBO0FBQUE7QUFBQTtBQXZtQkE7QUFBQTtBQUFBO0FBSUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFHQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFHQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFHQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFPQTtBQUNBO0FBQ0E7QUFFQTtBQUtBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBVUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQVVBO0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQU1BO0FBQ0E7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFJQTtBQUFBO0FBTUE7QUFBQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBR0E7QUFFQTtBQVFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBR0E7QUFHQTtBQUdBO0FBR0E7QUFHQTtBQUdBO0FBQ0E7QUFDQTtBQUdBO0FBR0E7QUFHQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFXQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFVQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUEyQkE7QUFFQTtBQVNBO0FBUUE7QUFDQTtBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFJQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUVBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBRUE7QUFDQTtBQUNBO0FBTUE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUlBO0FBQ0E7QUFFQTtBQUNBO0FBUUE7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQSIsInNvdXJjZXMiOlsid2VicGFjazovL2hvbWUtYXNzaXN0YW50LWZyb250ZW5kLy4vc3JjL3BhbmVscy9sb3ZlbGFjZS9jYXJkcy9lbmVyZ3kvaHVpLWVuZXJneS11c2FnZS1ncmFwaC1jYXJkLnRzP2EwMzkiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQ2hhcnREYXRhLFxuICBDaGFydERhdGFzZXQsXG4gIENoYXJ0T3B0aW9ucyxcbiAgU2NhdHRlckRhdGFQb2ludCxcbn0gZnJvbSBcImNoYXJ0LmpzXCI7XG5pbXBvcnQge1xuICBhZGRIb3VycyxcbiAgZGlmZmVyZW5jZUluRGF5cyxcbiAgZGlmZmVyZW5jZUluSG91cnMsXG4gIGVuZE9mVG9kYXksXG4gIGlzVG9kYXksXG4gIHN0YXJ0T2ZUb2RheSxcbn0gZnJvbSBcImRhdGUtZm5zL2VzbVwiO1xuaW1wb3J0IHsgVW5zdWJzY3JpYmVGdW5jIH0gZnJvbSBcImhvbWUtYXNzaXN0YW50LWpzLXdlYnNvY2tldFwiO1xuaW1wb3J0IHsgY3NzLCBDU1NSZXN1bHRHcm91cCwgaHRtbCwgTGl0RWxlbWVudCwgbm90aGluZyB9IGZyb20gXCJsaXRcIjtcbmltcG9ydCB7IGN1c3RvbUVsZW1lbnQsIHByb3BlcnR5LCBzdGF0ZSB9IGZyb20gXCJsaXQvZGVjb3JhdG9yc1wiO1xuaW1wb3J0IHsgY2xhc3NNYXAgfSBmcm9tIFwibGl0L2RpcmVjdGl2ZXMvY2xhc3MtbWFwXCI7XG5pbXBvcnQgbWVtb2l6ZU9uZSBmcm9tIFwibWVtb2l6ZS1vbmVcIjtcbmltcG9ydCB7XG4gIGhleDJyZ2IsXG4gIGxhYjJyZ2IsXG4gIHJnYjJoZXgsXG4gIHJnYjJsYWIsXG59IGZyb20gXCIuLi8uLi8uLi8uLi9jb21tb24vY29sb3IvY29udmVydC1jb2xvclwiO1xuaW1wb3J0IHsgbGFiQnJpZ2h0ZW4sIGxhYkRhcmtlbiB9IGZyb20gXCIuLi8uLi8uLi8uLi9jb21tb24vY29sb3IvbGFiXCI7XG5pbXBvcnQgeyBmb3JtYXREYXRlU2hvcnQgfSBmcm9tIFwiLi4vLi4vLi4vLi4vY29tbW9uL2RhdGV0aW1lL2Zvcm1hdF9kYXRlXCI7XG5pbXBvcnQgeyBmb3JtYXRUaW1lIH0gZnJvbSBcIi4uLy4uLy4uLy4uL2NvbW1vbi9kYXRldGltZS9mb3JtYXRfdGltZVwiO1xuaW1wb3J0IHtcbiAgZm9ybWF0TnVtYmVyLFxuICBudW1iZXJGb3JtYXRUb0xvY2FsZSxcbn0gZnJvbSBcIi4uLy4uLy4uLy4uL2NvbW1vbi9udW1iZXIvZm9ybWF0X251bWJlclwiO1xuaW1wb3J0IFwiLi4vLi4vLi4vLi4vY29tcG9uZW50cy9jaGFydC9oYS1jaGFydC1iYXNlXCI7XG5pbXBvcnQgXCIuLi8uLi8uLi8uLi9jb21wb25lbnRzL2hhLWNhcmRcIjtcbmltcG9ydCB7IEVuZXJneURhdGEsIGdldEVuZXJneURhdGFDb2xsZWN0aW9uIH0gZnJvbSBcIi4uLy4uLy4uLy4uL2RhdGEvZW5lcmd5XCI7XG5pbXBvcnQge1xuICBnZXRTdGF0aXN0aWNMYWJlbCxcbiAgU3RhdGlzdGljcyxcbiAgU3RhdGlzdGljc01ldGFEYXRhLFxufSBmcm9tIFwiLi4vLi4vLi4vLi4vZGF0YS9yZWNvcmRlclwiO1xuaW1wb3J0IHsgRnJvbnRlbmRMb2NhbGVEYXRhIH0gZnJvbSBcIi4uLy4uLy4uLy4uL2RhdGEvdHJhbnNsYXRpb25cIjtcbmltcG9ydCB7IFN1YnNjcmliZU1peGluIH0gZnJvbSBcIi4uLy4uLy4uLy4uL21peGlucy9zdWJzY3JpYmUtbWl4aW5cIjtcbmltcG9ydCB7IEhvbWVBc3Npc3RhbnQgfSBmcm9tIFwiLi4vLi4vLi4vLi4vdHlwZXNcIjtcbmltcG9ydCB7IExvdmVsYWNlQ2FyZCB9IGZyb20gXCIuLi8uLi90eXBlc1wiO1xuaW1wb3J0IHsgRW5lcmd5VXNhZ2VHcmFwaENhcmRDb25maWcgfSBmcm9tIFwiLi4vdHlwZXNcIjtcblxuQGN1c3RvbUVsZW1lbnQoXCJodWktZW5lcmd5LXVzYWdlLWdyYXBoLWNhcmRcIilcbmV4cG9ydCBjbGFzcyBIdWlFbmVyZ3lVc2FnZUdyYXBoQ2FyZFxuICBleHRlbmRzIFN1YnNjcmliZU1peGluKExpdEVsZW1lbnQpXG4gIGltcGxlbWVudHMgTG92ZWxhY2VDYXJkXG57XG4gIEBwcm9wZXJ0eSh7IGF0dHJpYnV0ZTogZmFsc2UgfSkgcHVibGljIGhhc3MhOiBIb21lQXNzaXN0YW50O1xuXG4gIEBzdGF0ZSgpIHByaXZhdGUgX2NvbmZpZz86IEVuZXJneVVzYWdlR3JhcGhDYXJkQ29uZmlnO1xuXG4gIEBzdGF0ZSgpIHByaXZhdGUgX2NoYXJ0RGF0YTogQ2hhcnREYXRhID0ge1xuICAgIGRhdGFzZXRzOiBbXSxcbiAgfTtcblxuICBAc3RhdGUoKSBwcml2YXRlIF9zdGFydCA9IHN0YXJ0T2ZUb2RheSgpO1xuXG4gIEBzdGF0ZSgpIHByaXZhdGUgX2VuZCA9IGVuZE9mVG9kYXkoKTtcblxuICBAc3RhdGUoKSBwcml2YXRlIF9jb21wYXJlU3RhcnQ/OiBEYXRlO1xuXG4gIEBzdGF0ZSgpIHByaXZhdGUgX2NvbXBhcmVFbmQ/OiBEYXRlO1xuXG4gIHByb3RlY3RlZCBoYXNzU3Vic2NyaWJlUmVxdWlyZWRIb3N0UHJvcHMgPSBbXCJfY29uZmlnXCJdO1xuXG4gIHB1YmxpYyBoYXNzU3Vic2NyaWJlKCk6IFVuc3Vic2NyaWJlRnVuY1tdIHtcbiAgICByZXR1cm4gW1xuICAgICAgZ2V0RW5lcmd5RGF0YUNvbGxlY3Rpb24odGhpcy5oYXNzLCB7XG4gICAgICAgIGtleTogdGhpcy5fY29uZmlnPy5jb2xsZWN0aW9uX2tleSxcbiAgICAgIH0pLnN1YnNjcmliZSgoZGF0YSkgPT4gdGhpcy5fZ2V0U3RhdGlzdGljcyhkYXRhKSksXG4gICAgXTtcbiAgfVxuXG4gIHB1YmxpYyBnZXRDYXJkU2l6ZSgpOiBQcm9taXNlPG51bWJlcj4gfCBudW1iZXIge1xuICAgIHJldHVybiAzO1xuICB9XG5cbiAgcHVibGljIHNldENvbmZpZyhjb25maWc6IEVuZXJneVVzYWdlR3JhcGhDYXJkQ29uZmlnKTogdm9pZCB7XG4gICAgdGhpcy5fY29uZmlnID0gY29uZmlnO1xuICB9XG5cbiAgcHJvdGVjdGVkIHJlbmRlcigpIHtcbiAgICBpZiAoIXRoaXMuaGFzcyB8fCAhdGhpcy5fY29uZmlnKSB7XG4gICAgICByZXR1cm4gbm90aGluZztcbiAgICB9XG5cbiAgICByZXR1cm4gaHRtbGBcbiAgICAgIDxoYS1jYXJkPlxuICAgICAgICAke3RoaXMuX2NvbmZpZy50aXRsZVxuICAgICAgICAgID8gaHRtbGA8aDEgY2xhc3M9XCJjYXJkLWhlYWRlclwiPiR7dGhpcy5fY29uZmlnLnRpdGxlfTwvaDE+YFxuICAgICAgICAgIDogXCJcIn1cbiAgICAgICAgPGRpdlxuICAgICAgICAgIGNsYXNzPVwiY29udGVudCAke2NsYXNzTWFwKHtcbiAgICAgICAgICAgIFwiaGFzLWhlYWRlclwiOiAhIXRoaXMuX2NvbmZpZy50aXRsZSxcbiAgICAgICAgICB9KX1cIlxuICAgICAgICA+XG4gICAgICAgICAgPGhhLWNoYXJ0LWJhc2VcbiAgICAgICAgICAgIC5oYXNzPSR7dGhpcy5oYXNzfVxuICAgICAgICAgICAgLmRhdGE9JHt0aGlzLl9jaGFydERhdGF9XG4gICAgICAgICAgICAub3B0aW9ucz0ke3RoaXMuX2NyZWF0ZU9wdGlvbnMoXG4gICAgICAgICAgICAgIHRoaXMuX3N0YXJ0LFxuICAgICAgICAgICAgICB0aGlzLl9lbmQsXG4gICAgICAgICAgICAgIHRoaXMuaGFzcy5sb2NhbGUsXG4gICAgICAgICAgICAgIHRoaXMuX2NvbXBhcmVTdGFydCxcbiAgICAgICAgICAgICAgdGhpcy5fY29tcGFyZUVuZFxuICAgICAgICAgICAgKX1cbiAgICAgICAgICAgIGNoYXJ0LXR5cGU9XCJiYXJcIlxuICAgICAgICAgID48L2hhLWNoYXJ0LWJhc2U+XG4gICAgICAgICAgJHshdGhpcy5fY2hhcnREYXRhLmRhdGFzZXRzLnNvbWUoKGRhdGFzZXQpID0+IGRhdGFzZXQuZGF0YS5sZW5ndGgpXG4gICAgICAgICAgICA/IGh0bWxgPGRpdiBjbGFzcz1cIm5vLWRhdGFcIj5cbiAgICAgICAgICAgICAgICAke2lzVG9kYXkodGhpcy5fc3RhcnQpXG4gICAgICAgICAgICAgICAgICA/IHRoaXMuaGFzcy5sb2NhbGl6ZShcInVpLnBhbmVsLmxvdmVsYWNlLmNhcmRzLmVuZXJneS5ub19kYXRhXCIpXG4gICAgICAgICAgICAgICAgICA6IHRoaXMuaGFzcy5sb2NhbGl6ZShcbiAgICAgICAgICAgICAgICAgICAgICBcInVpLnBhbmVsLmxvdmVsYWNlLmNhcmRzLmVuZXJneS5ub19kYXRhX3BlcmlvZFwiXG4gICAgICAgICAgICAgICAgICAgICl9XG4gICAgICAgICAgICAgIDwvZGl2PmBcbiAgICAgICAgICAgIDogXCJcIn1cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L2hhLWNhcmQ+XG4gICAgYDtcbiAgfVxuXG4gIHByaXZhdGUgX2NyZWF0ZU9wdGlvbnMgPSBtZW1vaXplT25lKFxuICAgIChcbiAgICAgIHN0YXJ0OiBEYXRlLFxuICAgICAgZW5kOiBEYXRlLFxuICAgICAgbG9jYWxlOiBGcm9udGVuZExvY2FsZURhdGEsXG4gICAgICBjb21wYXJlU3RhcnQ/OiBEYXRlLFxuICAgICAgY29tcGFyZUVuZD86IERhdGVcbiAgICApOiBDaGFydE9wdGlvbnMgPT4ge1xuICAgICAgY29uc3QgZGF5RGlmZmVyZW5jZSA9IGRpZmZlcmVuY2VJbkRheXMoZW5kLCBzdGFydCk7XG4gICAgICBjb25zdCBjb21wYXJlID0gY29tcGFyZVN0YXJ0ICE9PSB1bmRlZmluZWQgJiYgY29tcGFyZUVuZCAhPT0gdW5kZWZpbmVkO1xuICAgICAgaWYgKGNvbXBhcmUpIHtcbiAgICAgICAgY29uc3QgZGlmZmVyZW5jZSA9IGRpZmZlcmVuY2VJbkhvdXJzKGVuZCwgc3RhcnQpO1xuICAgICAgICBjb25zdCBkaWZmZXJlbmNlQ29tcGFyZSA9IGRpZmZlcmVuY2VJbkhvdXJzKGNvbXBhcmVFbmQhLCBjb21wYXJlU3RhcnQhKTtcbiAgICAgICAgLy8gSWYgdGhlIGNvbXBhcmUgcGVyaW9kIGRvZXNuJ3QgbWF0Y2ggdGhlIG1haW4gcGVyaW9kLCBhZGp1c3QgdGhlbSB0byBtYXRjaFxuICAgICAgICBpZiAoZGlmZmVyZW5jZUNvbXBhcmUgPiBkaWZmZXJlbmNlKSB7XG4gICAgICAgICAgZW5kID0gYWRkSG91cnMoZW5kLCBkaWZmZXJlbmNlQ29tcGFyZSAtIGRpZmZlcmVuY2UpO1xuICAgICAgICB9IGVsc2UgaWYgKGRpZmZlcmVuY2UgPiBkaWZmZXJlbmNlQ29tcGFyZSkge1xuICAgICAgICAgIGNvbXBhcmVFbmQgPSBhZGRIb3Vycyhjb21wYXJlRW5kISwgZGlmZmVyZW5jZSAtIGRpZmZlcmVuY2VDb21wYXJlKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBjb25zdCBvcHRpb25zOiBDaGFydE9wdGlvbnMgPSB7XG4gICAgICAgIHBhcnNpbmc6IGZhbHNlLFxuICAgICAgICBhbmltYXRpb246IGZhbHNlLFxuICAgICAgICBpbnRlcmFjdGlvbjoge1xuICAgICAgICAgIG1vZGU6IFwieFwiLFxuICAgICAgICB9LFxuICAgICAgICBzY2FsZXM6IHtcbiAgICAgICAgICB4OiB7XG4gICAgICAgICAgICB0eXBlOiBcInRpbWVcIixcbiAgICAgICAgICAgIHN1Z2dlc3RlZE1pbjogc3RhcnQuZ2V0VGltZSgpLFxuICAgICAgICAgICAgc3VnZ2VzdGVkTWF4OiBlbmQuZ2V0VGltZSgpLFxuICAgICAgICAgICAgYWRhcHRlcnM6IHtcbiAgICAgICAgICAgICAgZGF0ZToge1xuICAgICAgICAgICAgICAgIGxvY2FsZTogbG9jYWxlLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHRpY2tzOiB7XG4gICAgICAgICAgICAgIG1heFJvdGF0aW9uOiAwLFxuICAgICAgICAgICAgICBzYW1wbGVTaXplOiA1LFxuICAgICAgICAgICAgICBhdXRvU2tpcFBhZGRpbmc6IDIwLFxuICAgICAgICAgICAgICBmb250OiAoY29udGV4dCkgPT5cbiAgICAgICAgICAgICAgICBjb250ZXh0LnRpY2sgJiYgY29udGV4dC50aWNrLm1ham9yXG4gICAgICAgICAgICAgICAgICA/ICh7IHdlaWdodDogXCJib2xkXCIgfSBhcyBhbnkpXG4gICAgICAgICAgICAgICAgICA6IHt9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHRpbWU6IHtcbiAgICAgICAgICAgICAgdG9vbHRpcEZvcm1hdDpcbiAgICAgICAgICAgICAgICBkYXlEaWZmZXJlbmNlID4gMzVcbiAgICAgICAgICAgICAgICAgID8gXCJtb250aHllYXJcIlxuICAgICAgICAgICAgICAgICAgOiBkYXlEaWZmZXJlbmNlID4gN1xuICAgICAgICAgICAgICAgICAgPyBcImRhdGVcIlxuICAgICAgICAgICAgICAgICAgOiBkYXlEaWZmZXJlbmNlID4gMlxuICAgICAgICAgICAgICAgICAgPyBcIndlZWtkYXlcIlxuICAgICAgICAgICAgICAgICAgOiBkYXlEaWZmZXJlbmNlID4gMFxuICAgICAgICAgICAgICAgICAgPyBcImRhdGV0aW1lXCJcbiAgICAgICAgICAgICAgICAgIDogXCJob3VyXCIsXG4gICAgICAgICAgICAgIG1pblVuaXQ6XG4gICAgICAgICAgICAgICAgZGF5RGlmZmVyZW5jZSA+IDM1XG4gICAgICAgICAgICAgICAgICA/IFwibW9udGhcIlxuICAgICAgICAgICAgICAgICAgOiBkYXlEaWZmZXJlbmNlID4gMlxuICAgICAgICAgICAgICAgICAgPyBcImRheVwiXG4gICAgICAgICAgICAgICAgICA6IFwiaG91clwiLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHk6IHtcbiAgICAgICAgICAgIHN0YWNrZWQ6IHRydWUsXG4gICAgICAgICAgICB0eXBlOiBcImxpbmVhclwiLFxuICAgICAgICAgICAgdGl0bGU6IHtcbiAgICAgICAgICAgICAgZGlzcGxheTogdHJ1ZSxcbiAgICAgICAgICAgICAgdGV4dDogXCJrV2hcIixcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB0aWNrczoge1xuICAgICAgICAgICAgICBiZWdpbkF0WmVybzogdHJ1ZSxcbiAgICAgICAgICAgICAgY2FsbGJhY2s6ICh2YWx1ZSkgPT4gZm9ybWF0TnVtYmVyKE1hdGguYWJzKHZhbHVlKSwgbG9jYWxlKSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAgcGx1Z2luczoge1xuICAgICAgICAgIHRvb2x0aXA6IHtcbiAgICAgICAgICAgIHBvc2l0aW9uOiBcIm5lYXJlc3RcIixcbiAgICAgICAgICAgIGZpbHRlcjogKHZhbCkgPT4gdmFsLmZvcm1hdHRlZFZhbHVlICE9PSBcIjBcIixcbiAgICAgICAgICAgIGNhbGxiYWNrczoge1xuICAgICAgICAgICAgICB0aXRsZTogKGRhdGFzZXRzKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGRheURpZmZlcmVuY2UgPiAwKSB7XG4gICAgICAgICAgICAgICAgICByZXR1cm4gZGF0YXNldHNbMF0ubGFiZWw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZShkYXRhc2V0c1swXS5wYXJzZWQueCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGAke1xuICAgICAgICAgICAgICAgICAgY29tcGFyZSA/IGAke2Zvcm1hdERhdGVTaG9ydChkYXRlLCBsb2NhbGUpfTogYCA6IFwiXCJcbiAgICAgICAgICAgICAgICB9JHtmb3JtYXRUaW1lKGRhdGUsIGxvY2FsZSl9IOKAkyAke2Zvcm1hdFRpbWUoXG4gICAgICAgICAgICAgICAgICBhZGRIb3VycyhkYXRlLCAxKSxcbiAgICAgICAgICAgICAgICAgIGxvY2FsZVxuICAgICAgICAgICAgICAgICl9YDtcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgbGFiZWw6IChjb250ZXh0KSA9PlxuICAgICAgICAgICAgICAgIGAke2NvbnRleHQuZGF0YXNldC5sYWJlbH06ICR7Zm9ybWF0TnVtYmVyKFxuICAgICAgICAgICAgICAgICAgTWF0aC5hYnMoY29udGV4dC5wYXJzZWQueSksXG4gICAgICAgICAgICAgICAgICBsb2NhbGVcbiAgICAgICAgICAgICAgICApfSBrV2hgLFxuICAgICAgICAgICAgICBmb290ZXI6IChjb250ZXh0cykgPT4ge1xuICAgICAgICAgICAgICAgIGxldCB0b3RhbENvbnN1bWVkID0gMDtcbiAgICAgICAgICAgICAgICBsZXQgdG90YWxSZXR1cm5lZCA9IDA7XG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBjb250ZXh0IG9mIGNvbnRleHRzKSB7XG4gICAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IChjb250ZXh0LmRhdGFzZXQuZGF0YVtjb250ZXh0LmRhdGFJbmRleF0gYXMgYW55KVxuICAgICAgICAgICAgICAgICAgICAueTtcbiAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgdG90YWxDb25zdW1lZCArPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRvdGFsUmV0dXJuZWQgKz0gTWF0aC5hYnModmFsdWUpO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gW1xuICAgICAgICAgICAgICAgICAgdG90YWxDb25zdW1lZFxuICAgICAgICAgICAgICAgICAgICA/IHRoaXMuaGFzcy5sb2NhbGl6ZShcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidWkucGFuZWwubG92ZWxhY2UuY2FyZHMuZW5lcmd5LmVuZXJneV91c2FnZV9ncmFwaC50b3RhbF9jb25zdW1lZFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgeyBudW06IGZvcm1hdE51bWJlcih0b3RhbENvbnN1bWVkLCBsb2NhbGUpIH1cbiAgICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICAgIDogXCJcIixcbiAgICAgICAgICAgICAgICAgIHRvdGFsUmV0dXJuZWRcbiAgICAgICAgICAgICAgICAgICAgPyB0aGlzLmhhc3MubG9jYWxpemUoXG4gICAgICAgICAgICAgICAgICAgICAgICBcInVpLnBhbmVsLmxvdmVsYWNlLmNhcmRzLmVuZXJneS5lbmVyZ3lfdXNhZ2VfZ3JhcGgudG90YWxfcmV0dXJuZWRcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIHsgbnVtOiBmb3JtYXROdW1iZXIodG90YWxSZXR1cm5lZCwgbG9jYWxlKSB9XG4gICAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgICA6IFwiXCIsXG4gICAgICAgICAgICAgICAgXS5maWx0ZXIoQm9vbGVhbik7XG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgICAgZmlsbGVyOiB7XG4gICAgICAgICAgICBwcm9wYWdhdGU6IGZhbHNlLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgbGVnZW5kOiB7XG4gICAgICAgICAgICBkaXNwbGF5OiBmYWxzZSxcbiAgICAgICAgICAgIGxhYmVsczoge1xuICAgICAgICAgICAgICB1c2VQb2ludFN0eWxlOiB0cnVlLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICBlbGVtZW50czoge1xuICAgICAgICAgIGJhcjogeyBib3JkZXJXaWR0aDogMS41LCBib3JkZXJSYWRpdXM6IDQgfSxcbiAgICAgICAgICBwb2ludDoge1xuICAgICAgICAgICAgaGl0UmFkaXVzOiA1MCxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICAvLyBAdHMtZXhwZWN0LWVycm9yXG4gICAgICAgIGxvY2FsZTogbnVtYmVyRm9ybWF0VG9Mb2NhbGUobG9jYWxlKSxcbiAgICAgIH07XG4gICAgICBpZiAoY29tcGFyZSkge1xuICAgICAgICBvcHRpb25zLnNjYWxlcyEueEF4aXNDb21wYXJlID0ge1xuICAgICAgICAgIC4uLihvcHRpb25zLnNjYWxlcyEueCBhcyBSZWNvcmQ8c3RyaW5nLCBhbnk+KSxcbiAgICAgICAgICBzdWdnZXN0ZWRNaW46IGNvbXBhcmVTdGFydCEuZ2V0VGltZSgpLFxuICAgICAgICAgIHN1Z2dlc3RlZE1heDogY29tcGFyZUVuZCEuZ2V0VGltZSgpLFxuICAgICAgICAgIGRpc3BsYXk6IGZhbHNlLFxuICAgICAgICB9O1xuICAgICAgfVxuICAgICAgcmV0dXJuIG9wdGlvbnM7XG4gICAgfVxuICApO1xuXG4gIHByaXZhdGUgYXN5bmMgX2dldFN0YXRpc3RpY3MoZW5lcmd5RGF0YTogRW5lcmd5RGF0YSk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IGRhdGFzZXRzOiBDaGFydERhdGFzZXQ8XCJiYXJcIiwgU2NhdHRlckRhdGFQb2ludFtdPltdID0gW107XG5cbiAgICBjb25zdCBzdGF0SWRzOiB7XG4gICAgICB0b19ncmlkPzogc3RyaW5nW107XG4gICAgICBmcm9tX2dyaWQ/OiBzdHJpbmdbXTtcbiAgICAgIHNvbGFyPzogc3RyaW5nW107XG4gICAgICB0b19iYXR0ZXJ5Pzogc3RyaW5nW107XG4gICAgICBmcm9tX2JhdHRlcnk/OiBzdHJpbmdbXTtcbiAgICB9ID0ge307XG5cbiAgICBmb3IgKGNvbnN0IHNvdXJjZSBvZiBlbmVyZ3lEYXRhLnByZWZzLmVuZXJneV9zb3VyY2VzKSB7XG4gICAgICBpZiAoc291cmNlLnR5cGUgPT09IFwic29sYXJcIikge1xuICAgICAgICBpZiAoc3RhdElkcy5zb2xhcikge1xuICAgICAgICAgIHN0YXRJZHMuc29sYXIucHVzaChzb3VyY2Uuc3RhdF9lbmVyZ3lfZnJvbSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgc3RhdElkcy5zb2xhciA9IFtzb3VyY2Uuc3RhdF9lbmVyZ3lfZnJvbV07XG4gICAgICAgIH1cbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG5cbiAgICAgIGlmIChzb3VyY2UudHlwZSA9PT0gXCJiYXR0ZXJ5XCIpIHtcbiAgICAgICAgaWYgKHN0YXRJZHMudG9fYmF0dGVyeSkge1xuICAgICAgICAgIHN0YXRJZHMudG9fYmF0dGVyeS5wdXNoKHNvdXJjZS5zdGF0X2VuZXJneV90byk7XG4gICAgICAgICAgc3RhdElkcy5mcm9tX2JhdHRlcnkhLnB1c2goc291cmNlLnN0YXRfZW5lcmd5X2Zyb20pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHN0YXRJZHMudG9fYmF0dGVyeSA9IFtzb3VyY2Uuc3RhdF9lbmVyZ3lfdG9dO1xuICAgICAgICAgIHN0YXRJZHMuZnJvbV9iYXR0ZXJ5ID0gW3NvdXJjZS5zdGF0X2VuZXJneV9mcm9tXTtcbiAgICAgICAgfVxuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cblxuICAgICAgaWYgKHNvdXJjZS50eXBlICE9PSBcImdyaWRcIikge1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cblxuICAgICAgLy8gZ3JpZCBzb3VyY2VcbiAgICAgIGZvciAoY29uc3QgZmxvd0Zyb20gb2Ygc291cmNlLmZsb3dfZnJvbSkge1xuICAgICAgICBpZiAoc3RhdElkcy5mcm9tX2dyaWQpIHtcbiAgICAgICAgICBzdGF0SWRzLmZyb21fZ3JpZC5wdXNoKGZsb3dGcm9tLnN0YXRfZW5lcmd5X2Zyb20pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHN0YXRJZHMuZnJvbV9ncmlkID0gW2Zsb3dGcm9tLnN0YXRfZW5lcmd5X2Zyb21dO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBmb3IgKGNvbnN0IGZsb3dUbyBvZiBzb3VyY2UuZmxvd190bykge1xuICAgICAgICBpZiAoc3RhdElkcy50b19ncmlkKSB7XG4gICAgICAgICAgc3RhdElkcy50b19ncmlkLnB1c2goZmxvd1RvLnN0YXRfZW5lcmd5X3RvKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBzdGF0SWRzLnRvX2dyaWQgPSBbZmxvd1RvLnN0YXRfZW5lcmd5X3RvXTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0IGNvbXB1dGVkU3R5bGVzID0gZ2V0Q29tcHV0ZWRTdHlsZSh0aGlzKTtcbiAgICBjb25zdCBjb2xvcnMgPSB7XG4gICAgICB0b19ncmlkOiBjb21wdXRlZFN0eWxlc1xuICAgICAgICAuZ2V0UHJvcGVydHlWYWx1ZShcIi0tZW5lcmd5LWdyaWQtcmV0dXJuLWNvbG9yXCIpXG4gICAgICAgIC50cmltKCksXG4gICAgICB0b19iYXR0ZXJ5OiBjb21wdXRlZFN0eWxlc1xuICAgICAgICAuZ2V0UHJvcGVydHlWYWx1ZShcIi0tZW5lcmd5LWJhdHRlcnktaW4tY29sb3JcIilcbiAgICAgICAgLnRyaW0oKSxcbiAgICAgIGZyb21fZ3JpZDogY29tcHV0ZWRTdHlsZXNcbiAgICAgICAgLmdldFByb3BlcnR5VmFsdWUoXCItLWVuZXJneS1ncmlkLWNvbnN1bXB0aW9uLWNvbG9yXCIpXG4gICAgICAgIC50cmltKCksXG4gICAgICB1c2VkX2dyaWQ6IGNvbXB1dGVkU3R5bGVzXG4gICAgICAgIC5nZXRQcm9wZXJ0eVZhbHVlKFwiLS1lbmVyZ3ktZ3JpZC1jb25zdW1wdGlvbi1jb2xvclwiKVxuICAgICAgICAudHJpbSgpLFxuICAgICAgdXNlZF9zb2xhcjogY29tcHV0ZWRTdHlsZXNcbiAgICAgICAgLmdldFByb3BlcnR5VmFsdWUoXCItLWVuZXJneS1zb2xhci1jb2xvclwiKVxuICAgICAgICAudHJpbSgpLFxuICAgICAgdXNlZF9iYXR0ZXJ5OiBjb21wdXRlZFN0eWxlc1xuICAgICAgICAuZ2V0UHJvcGVydHlWYWx1ZShcIi0tZW5lcmd5LWJhdHRlcnktb3V0LWNvbG9yXCIpXG4gICAgICAgIC50cmltKCksXG4gICAgfTtcbiAgICBjb25zdCBsYWJlbHMgPSB7XG4gICAgICB1c2VkX2dyaWQ6IHRoaXMuaGFzcy5sb2NhbGl6ZShcbiAgICAgICAgXCJ1aS5wYW5lbC5sb3ZlbGFjZS5jYXJkcy5lbmVyZ3kuZW5lcmd5X3VzYWdlX2dyYXBoLmNvbWJpbmVkX2Zyb21fZ3JpZFwiXG4gICAgICApLFxuICAgICAgdXNlZF9zb2xhcjogdGhpcy5oYXNzLmxvY2FsaXplKFxuICAgICAgICBcInVpLnBhbmVsLmxvdmVsYWNlLmNhcmRzLmVuZXJneS5lbmVyZ3lfdXNhZ2VfZ3JhcGguY29uc3VtZWRfc29sYXJcIlxuICAgICAgKSxcbiAgICAgIHVzZWRfYmF0dGVyeTogdGhpcy5oYXNzLmxvY2FsaXplKFxuICAgICAgICBcInVpLnBhbmVsLmxvdmVsYWNlLmNhcmRzLmVuZXJneS5lbmVyZ3lfdXNhZ2VfZ3JhcGguY29uc3VtZWRfYmF0dGVyeVwiXG4gICAgICApLFxuICAgIH07XG5cbiAgICB0aGlzLl9zdGFydCA9IGVuZXJneURhdGEuc3RhcnQ7XG4gICAgdGhpcy5fZW5kID0gZW5lcmd5RGF0YS5lbmQgfHwgZW5kT2ZUb2RheSgpO1xuXG4gICAgdGhpcy5fY29tcGFyZVN0YXJ0ID0gZW5lcmd5RGF0YS5zdGFydENvbXBhcmU7XG4gICAgdGhpcy5fY29tcGFyZUVuZCA9IGVuZXJneURhdGEuZW5kQ29tcGFyZTtcblxuICAgIGRhdGFzZXRzLnB1c2goXG4gICAgICAuLi50aGlzLl9wcm9jZXNzRGF0YVNldChcbiAgICAgICAgZW5lcmd5RGF0YS5zdGF0cyxcbiAgICAgICAgZW5lcmd5RGF0YS5zdGF0c01ldGFkYXRhLFxuICAgICAgICBzdGF0SWRzLFxuICAgICAgICBjb2xvcnMsXG4gICAgICAgIGxhYmVscyxcbiAgICAgICAgZmFsc2VcbiAgICAgIClcbiAgICApO1xuXG4gICAgaWYgKGVuZXJneURhdGEuc3RhdHNDb21wYXJlKSB7XG4gICAgICAvLyBBZGQgZW1wdHkgZGF0YXNldCB0byBhbGlnbiB0aGUgYmFyc1xuICAgICAgZGF0YXNldHMucHVzaCh7XG4gICAgICAgIG9yZGVyOiAwLFxuICAgICAgICBkYXRhOiBbXSxcbiAgICAgIH0pO1xuICAgICAgZGF0YXNldHMucHVzaCh7XG4gICAgICAgIG9yZGVyOiA5OTksXG4gICAgICAgIGRhdGE6IFtdLFxuICAgICAgICB4QXhpc0lEOiBcInhBeGlzQ29tcGFyZVwiLFxuICAgICAgfSk7XG5cbiAgICAgIGRhdGFzZXRzLnB1c2goXG4gICAgICAgIC4uLnRoaXMuX3Byb2Nlc3NEYXRhU2V0KFxuICAgICAgICAgIGVuZXJneURhdGEuc3RhdHNDb21wYXJlLFxuICAgICAgICAgIGVuZXJneURhdGEuc3RhdHNNZXRhZGF0YSxcbiAgICAgICAgICBzdGF0SWRzLFxuICAgICAgICAgIGNvbG9ycyxcbiAgICAgICAgICBsYWJlbHMsXG4gICAgICAgICAgdHJ1ZVxuICAgICAgICApXG4gICAgICApO1xuICAgIH1cblxuICAgIHRoaXMuX2NoYXJ0RGF0YSA9IHtcbiAgICAgIGRhdGFzZXRzLFxuICAgIH07XG4gIH1cblxuICBwcml2YXRlIF9wcm9jZXNzRGF0YVNldChcbiAgICBzdGF0aXN0aWNzOiBTdGF0aXN0aWNzLFxuICAgIHN0YXRpc3RpY3NNZXRhRGF0YTogUmVjb3JkPHN0cmluZywgU3RhdGlzdGljc01ldGFEYXRhPixcbiAgICBzdGF0SWRzQnlDYXQ6IHtcbiAgICAgIHRvX2dyaWQ/OiBzdHJpbmdbXSB8IHVuZGVmaW5lZDtcbiAgICAgIGZyb21fZ3JpZD86IHN0cmluZ1tdIHwgdW5kZWZpbmVkO1xuICAgICAgc29sYXI/OiBzdHJpbmdbXSB8IHVuZGVmaW5lZDtcbiAgICAgIHRvX2JhdHRlcnk/OiBzdHJpbmdbXSB8IHVuZGVmaW5lZDtcbiAgICAgIGZyb21fYmF0dGVyeT86IHN0cmluZ1tdIHwgdW5kZWZpbmVkO1xuICAgIH0sXG4gICAgY29sb3JzOiB7XG4gICAgICB0b19ncmlkOiBzdHJpbmc7XG4gICAgICB0b19iYXR0ZXJ5OiBzdHJpbmc7XG4gICAgICBmcm9tX2dyaWQ6IHN0cmluZztcbiAgICAgIHVzZWRfZ3JpZDogc3RyaW5nO1xuICAgICAgdXNlZF9zb2xhcjogc3RyaW5nO1xuICAgICAgdXNlZF9iYXR0ZXJ5OiBzdHJpbmc7XG4gICAgfSxcbiAgICBsYWJlbHM6IHtcbiAgICAgIHVzZWRfZ3JpZDogc3RyaW5nO1xuICAgICAgdXNlZF9zb2xhcjogc3RyaW5nO1xuICAgICAgdXNlZF9iYXR0ZXJ5OiBzdHJpbmc7XG4gICAgfSxcbiAgICBjb21wYXJlID0gZmFsc2VcbiAgKSB7XG4gICAgY29uc3QgZGF0YTogQ2hhcnREYXRhc2V0PFwiYmFyXCIsIFNjYXR0ZXJEYXRhUG9pbnRbXT5bXSA9IFtdO1xuXG4gICAgY29uc3QgY29tYmluZWREYXRhOiB7XG4gICAgICB0b19ncmlkPzogeyBbc3RhdElkOiBzdHJpbmddOiB7IFtzdGFydDogbnVtYmVyXTogbnVtYmVyIH0gfTtcbiAgICAgIHRvX2JhdHRlcnk/OiB7IFtzdGF0SWQ6IHN0cmluZ106IHsgW3N0YXJ0OiBudW1iZXJdOiBudW1iZXIgfSB9O1xuICAgICAgZnJvbV9ncmlkPzogeyBbc3RhdElkOiBzdHJpbmddOiB7IFtzdGFydDogbnVtYmVyXTogbnVtYmVyIH0gfTtcbiAgICAgIHVzZWRfZ3JpZD86IHsgW3N0YXRJZDogc3RyaW5nXTogeyBbc3RhcnQ6IG51bWJlcl06IG51bWJlciB9IH07XG4gICAgICB1c2VkX3NvbGFyPzogeyBbc3RhdElkOiBzdHJpbmddOiB7IFtzdGFydDogbnVtYmVyXTogbnVtYmVyIH0gfTtcbiAgICAgIHVzZWRfYmF0dGVyeT86IHsgW3N0YXRJZDogc3RyaW5nXTogeyBbc3RhcnQ6IG51bWJlcl06IG51bWJlciB9IH07XG4gICAgfSA9IHt9O1xuXG4gICAgY29uc3Qgc3VtbWVkRGF0YToge1xuICAgICAgdG9fZ3JpZD86IHsgW3N0YXJ0OiBudW1iZXJdOiBudW1iZXIgfTtcbiAgICAgIGZyb21fZ3JpZD86IHsgW3N0YXJ0OiBudW1iZXJdOiBudW1iZXIgfTtcbiAgICAgIHRvX2JhdHRlcnk/OiB7IFtzdGFydDogbnVtYmVyXTogbnVtYmVyIH07XG4gICAgICBmcm9tX2JhdHRlcnk/OiB7IFtzdGFydDogbnVtYmVyXTogbnVtYmVyIH07XG4gICAgICBzb2xhcj86IHsgW3N0YXJ0OiBudW1iZXJdOiBudW1iZXIgfTtcbiAgICB9ID0ge307XG5cbiAgICBPYmplY3QuZW50cmllcyhzdGF0SWRzQnlDYXQpLmZvckVhY2goKFtrZXksIHN0YXRJZHNdKSA9PiB7XG4gICAgICBjb25zdCBzdW0gPSBbXG4gICAgICAgIFwic29sYXJcIixcbiAgICAgICAgXCJ0b19ncmlkXCIsXG4gICAgICAgIFwiZnJvbV9ncmlkXCIsXG4gICAgICAgIFwidG9fYmF0dGVyeVwiLFxuICAgICAgICBcImZyb21fYmF0dGVyeVwiLFxuICAgICAgXS5pbmNsdWRlcyhrZXkpO1xuICAgICAgY29uc3QgYWRkID0gIVtcInNvbGFyXCIsIFwiZnJvbV9iYXR0ZXJ5XCJdLmluY2x1ZGVzKGtleSk7XG4gICAgICBjb25zdCB0b3RhbFN0YXRzOiB7IFtzdGFydDogbnVtYmVyXTogbnVtYmVyIH0gPSB7fTtcbiAgICAgIGNvbnN0IHNldHM6IHsgW3N0YXRJZDogc3RyaW5nXTogeyBbc3RhcnQ6IG51bWJlcl06IG51bWJlciB9IH0gPSB7fTtcbiAgICAgIHN0YXRJZHMhLmZvckVhY2goKGlkKSA9PiB7XG4gICAgICAgIGNvbnN0IHN0YXRzID0gc3RhdGlzdGljc1tpZF07XG4gICAgICAgIGlmICghc3RhdHMpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBzZXQgPSB7fTtcbiAgICAgICAgc3RhdHMuZm9yRWFjaCgoc3RhdCkgPT4ge1xuICAgICAgICAgIGlmIChzdGF0LmNoYW5nZSA9PT0gbnVsbCB8fCBzdGF0LmNoYW5nZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICAgIGNvbnN0IHZhbCA9IHN0YXQuY2hhbmdlO1xuICAgICAgICAgIC8vIEdldCB0b3RhbCBvZiBzb2xhciBhbmQgdG8gZ3JpZCB0byBjYWxjdWxhdGUgdGhlIHNvbGFyIGVuZXJneSB1c2VkXG4gICAgICAgICAgaWYgKHN1bSkge1xuICAgICAgICAgICAgdG90YWxTdGF0c1tzdGF0LnN0YXJ0XSA9XG4gICAgICAgICAgICAgIHN0YXQuc3RhcnQgaW4gdG90YWxTdGF0cyA/IHRvdGFsU3RhdHNbc3RhdC5zdGFydF0gKyB2YWwgOiB2YWw7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChhZGQgJiYgIShzdGF0LnN0YXJ0IGluIHNldCkpIHtcbiAgICAgICAgICAgIHNldFtzdGF0LnN0YXJ0XSA9IHZhbDtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBzZXRzW2lkXSA9IHNldDtcbiAgICAgIH0pO1xuICAgICAgaWYgKHN1bSkge1xuICAgICAgICBzdW1tZWREYXRhW2tleV0gPSB0b3RhbFN0YXRzO1xuICAgICAgfVxuICAgICAgaWYgKGFkZCkge1xuICAgICAgICBjb21iaW5lZERhdGFba2V5XSA9IHNldHM7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBjb25zdCBncmlkX3RvX2JhdHRlcnkgPSB7fTtcbiAgICBjb25zdCBiYXR0ZXJ5X3RvX2dyaWQgPSB7fTtcbiAgICBpZiAoKHN1bW1lZERhdGEudG9fZ3JpZCB8fCBzdW1tZWREYXRhLnRvX2JhdHRlcnkpICYmIHN1bW1lZERhdGEuc29sYXIpIHtcbiAgICAgIGNvbnN0IHVzZWRfc29sYXIgPSB7fTtcbiAgICAgIGZvciAoY29uc3Qgc3RhcnQgb2YgT2JqZWN0LmtleXMoc3VtbWVkRGF0YS5zb2xhcikpIHtcbiAgICAgICAgdXNlZF9zb2xhcltzdGFydF0gPVxuICAgICAgICAgIChzdW1tZWREYXRhLnNvbGFyW3N0YXJ0XSB8fCAwKSAtXG4gICAgICAgICAgKHN1bW1lZERhdGEudG9fZ3JpZD8uW3N0YXJ0XSB8fCAwKSAtXG4gICAgICAgICAgKHN1bW1lZERhdGEudG9fYmF0dGVyeT8uW3N0YXJ0XSB8fCAwKTtcbiAgICAgICAgaWYgKHVzZWRfc29sYXJbc3RhcnRdIDwgMCkge1xuICAgICAgICAgIGlmIChzdW1tZWREYXRhLnRvX2JhdHRlcnkpIHtcbiAgICAgICAgICAgIGdyaWRfdG9fYmF0dGVyeVtzdGFydF0gPSB1c2VkX3NvbGFyW3N0YXJ0XSAqIC0xO1xuICAgICAgICAgICAgaWYgKGdyaWRfdG9fYmF0dGVyeVtzdGFydF0gPiAoc3VtbWVkRGF0YS5mcm9tX2dyaWQ/LltzdGFydF0gfHwgMCkpIHtcbiAgICAgICAgICAgICAgYmF0dGVyeV90b19ncmlkW3N0YXJ0XSA9IE1hdGgubWluKFxuICAgICAgICAgICAgICAgIDAsXG4gICAgICAgICAgICAgICAgZ3JpZF90b19iYXR0ZXJ5W3N0YXJ0XSAtIChzdW1tZWREYXRhLmZyb21fZ3JpZD8uW3N0YXJ0XSB8fCAwKVxuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICBncmlkX3RvX2JhdHRlcnlbc3RhcnRdID0gc3VtbWVkRGF0YS5mcm9tX2dyaWQ/LltzdGFydF07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIHVzZWRfc29sYXJbc3RhcnRdID0gMDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgY29tYmluZWREYXRhLnVzZWRfc29sYXIgPSB7IHVzZWRfc29sYXIgfTtcbiAgICB9XG5cbiAgICBpZiAoc3VtbWVkRGF0YS5mcm9tX2JhdHRlcnkpIHtcbiAgICAgIGlmIChzdW1tZWREYXRhLnRvX2dyaWQpIHtcbiAgICAgICAgY29uc3QgdXNlZF9iYXR0ZXJ5ID0ge307XG4gICAgICAgIGZvciAoY29uc3Qgc3RhcnQgb2YgT2JqZWN0LmtleXMoc3VtbWVkRGF0YS5mcm9tX2JhdHRlcnkpKSB7XG4gICAgICAgICAgdXNlZF9iYXR0ZXJ5W3N0YXJ0XSA9XG4gICAgICAgICAgICAoc3VtbWVkRGF0YS5mcm9tX2JhdHRlcnkhW3N0YXJ0XSB8fCAwKSAtXG4gICAgICAgICAgICAoYmF0dGVyeV90b19ncmlkW3N0YXJ0XSB8fCAwKTtcbiAgICAgICAgfVxuICAgICAgICBjb21iaW5lZERhdGEudXNlZF9iYXR0ZXJ5ID0geyB1c2VkX2JhdHRlcnkgfTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbWJpbmVkRGF0YS51c2VkX2JhdHRlcnkgPSB7IHVzZWRfYmF0dGVyeTogc3VtbWVkRGF0YS5mcm9tX2JhdHRlcnkgfTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoY29tYmluZWREYXRhLmZyb21fZ3JpZCAmJiBzdW1tZWREYXRhLnRvX2JhdHRlcnkpIHtcbiAgICAgIGNvbnN0IHVzZWRfZ3JpZCA9IHt9O1xuICAgICAgZm9yIChjb25zdCBzdGFydCBvZiBPYmplY3Qua2V5cyhncmlkX3RvX2JhdHRlcnkpKSB7XG4gICAgICAgIGxldCBub09mU291cmNlcyA9IDA7XG4gICAgICAgIGxldCBzb3VyY2U6IHN0cmluZztcbiAgICAgICAgZm9yIChjb25zdCBba2V5LCBzdGF0c10gb2YgT2JqZWN0LmVudHJpZXMoY29tYmluZWREYXRhLmZyb21fZ3JpZCkpIHtcbiAgICAgICAgICBpZiAoc3RhdHNbc3RhcnRdKSB7XG4gICAgICAgICAgICBzb3VyY2UgPSBrZXk7XG4gICAgICAgICAgICBub09mU291cmNlcysrO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAobm9PZlNvdXJjZXMgPiAxKSB7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG5vT2ZTb3VyY2VzID09PSAxKSB7XG4gICAgICAgICAgY29tYmluZWREYXRhLmZyb21fZ3JpZFtzb3VyY2UhXVtzdGFydF0gLT0gZ3JpZF90b19iYXR0ZXJ5W3N0YXJ0XSB8fCAwO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGxldCB0b3RhbF9mcm9tX2dyaWQgPSAwO1xuICAgICAgICAgIE9iamVjdC52YWx1ZXMoY29tYmluZWREYXRhLmZyb21fZ3JpZCkuZm9yRWFjaCgoc3RhdHMpID0+IHtcbiAgICAgICAgICAgIHRvdGFsX2Zyb21fZ3JpZCArPSBzdGF0c1tzdGFydF0gfHwgMDtcbiAgICAgICAgICAgIGRlbGV0ZSBzdGF0c1tzdGFydF07XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgdXNlZF9ncmlkW3N0YXJ0XSA9IHRvdGFsX2Zyb21fZ3JpZCAtIChncmlkX3RvX2JhdHRlcnlbc3RhcnRdIHx8IDApO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBjb21iaW5lZERhdGEudXNlZF9ncmlkID0geyB1c2VkX2dyaWQgfTtcbiAgICB9XG5cbiAgICBsZXQgYWxsS2V5czogc3RyaW5nW10gPSBbXTtcblxuICAgIE9iamVjdC52YWx1ZXMoY29tYmluZWREYXRhKS5mb3JFYWNoKChzb3VyY2VzKSA9PiB7XG4gICAgICBPYmplY3QudmFsdWVzKHNvdXJjZXMpLmZvckVhY2goKHNvdXJjZSkgPT4ge1xuICAgICAgICBhbGxLZXlzID0gYWxsS2V5cy5jb25jYXQoT2JqZWN0LmtleXMoc291cmNlKSk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGNvbnN0IHVuaXF1ZUtleXMgPSBBcnJheS5mcm9tKG5ldyBTZXQoYWxsS2V5cykpO1xuXG4gICAgT2JqZWN0LmVudHJpZXMoY29tYmluZWREYXRhKS5mb3JFYWNoKChbdHlwZSwgc291cmNlc10pID0+IHtcbiAgICAgIE9iamVjdC5lbnRyaWVzKHNvdXJjZXMpLmZvckVhY2goKFtzdGF0SWQsIHNvdXJjZV0sIGlkeCkgPT4ge1xuICAgICAgICBjb25zdCBtb2RpZmllZENvbG9yID1cbiAgICAgICAgICBpZHggPiAwXG4gICAgICAgICAgICA/IHRoaXMuaGFzcy50aGVtZXMuZGFya01vZGVcbiAgICAgICAgICAgICAgPyBsYWJCcmlnaHRlbihyZ2IybGFiKGhleDJyZ2IoY29sb3JzW3R5cGVdKSksIGlkeClcbiAgICAgICAgICAgICAgOiBsYWJEYXJrZW4ocmdiMmxhYihoZXgycmdiKGNvbG9yc1t0eXBlXSkpLCBpZHgpXG4gICAgICAgICAgICA6IHVuZGVmaW5lZDtcbiAgICAgICAgY29uc3QgYm9yZGVyQ29sb3IgPSBtb2RpZmllZENvbG9yXG4gICAgICAgICAgPyByZ2IyaGV4KGxhYjJyZ2IobW9kaWZpZWRDb2xvcikpXG4gICAgICAgICAgOiBjb2xvcnNbdHlwZV07XG5cbiAgICAgICAgY29uc3QgcG9pbnRzOiBTY2F0dGVyRGF0YVBvaW50W10gPSBbXTtcbiAgICAgICAgLy8gUHJvY2VzcyBjaGFydCBkYXRhLlxuICAgICAgICBmb3IgKGNvbnN0IGtleSBvZiB1bmlxdWVLZXlzKSB7XG4gICAgICAgICAgY29uc3QgdmFsdWUgPSBzb3VyY2Vba2V5XSB8fCAwO1xuICAgICAgICAgIHBvaW50cy5wdXNoKHtcbiAgICAgICAgICAgIHg6IE51bWJlcihrZXkpLFxuICAgICAgICAgICAgeTpcbiAgICAgICAgICAgICAgdmFsdWUgJiYgW1widG9fZ3JpZFwiLCBcInRvX2JhdHRlcnlcIl0uaW5jbHVkZXModHlwZSlcbiAgICAgICAgICAgICAgICA/IC0xICogdmFsdWVcbiAgICAgICAgICAgICAgICA6IHZhbHVlLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgZGF0YS5wdXNoKHtcbiAgICAgICAgICBsYWJlbDpcbiAgICAgICAgICAgIHR5cGUgaW4gbGFiZWxzXG4gICAgICAgICAgICAgID8gbGFiZWxzW3R5cGVdXG4gICAgICAgICAgICAgIDogZ2V0U3RhdGlzdGljTGFiZWwoXG4gICAgICAgICAgICAgICAgICB0aGlzLmhhc3MsXG4gICAgICAgICAgICAgICAgICBzdGF0SWQsXG4gICAgICAgICAgICAgICAgICBzdGF0aXN0aWNzTWV0YURhdGFbc3RhdElkXVxuICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgb3JkZXI6XG4gICAgICAgICAgICB0eXBlID09PSBcInVzZWRfc29sYXJcIlxuICAgICAgICAgICAgICA/IDFcbiAgICAgICAgICAgICAgOiB0eXBlID09PSBcInRvX2JhdHRlcnlcIlxuICAgICAgICAgICAgICA/IE9iamVjdC5rZXlzKGNvbWJpbmVkRGF0YSkubGVuZ3RoXG4gICAgICAgICAgICAgIDogaWR4ICsgMixcbiAgICAgICAgICBib3JkZXJDb2xvcjogY29tcGFyZSA/IGJvcmRlckNvbG9yICsgXCI3RlwiIDogYm9yZGVyQ29sb3IsXG4gICAgICAgICAgYmFja2dyb3VuZENvbG9yOiBjb21wYXJlID8gYm9yZGVyQ29sb3IgKyBcIjMyXCIgOiBib3JkZXJDb2xvciArIFwiN0ZcIixcbiAgICAgICAgICBzdGFjazogXCJzdGFja1wiLFxuICAgICAgICAgIGRhdGE6IHBvaW50cyxcbiAgICAgICAgICB4QXhpc0lEOiBjb21wYXJlID8gXCJ4QXhpc0NvbXBhcmVcIiA6IHVuZGVmaW5lZCxcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgICByZXR1cm4gZGF0YTtcbiAgfVxuXG4gIHN0YXRpYyBnZXQgc3R5bGVzKCk6IENTU1Jlc3VsdEdyb3VwIHtcbiAgICByZXR1cm4gY3NzYFxuICAgICAgaGEtY2FyZCB7XG4gICAgICAgIGhlaWdodDogMTAwJTtcbiAgICAgIH1cbiAgICAgIC5jYXJkLWhlYWRlciB7XG4gICAgICAgIHBhZGRpbmctYm90dG9tOiAwO1xuICAgICAgfVxuICAgICAgLmNvbnRlbnQge1xuICAgICAgICBwYWRkaW5nOiAxNnB4O1xuICAgICAgfVxuICAgICAgLmhhcy1oZWFkZXIge1xuICAgICAgICBwYWRkaW5nLXRvcDogMDtcbiAgICAgIH1cbiAgICAgIC5uby1kYXRhIHtcbiAgICAgICAgcG9zaXRpb246IGFic29sdXRlO1xuICAgICAgICBoZWlnaHQ6IDEwMCU7XG4gICAgICAgIHRvcDogMDtcbiAgICAgICAgbGVmdDogMDtcbiAgICAgICAgcmlnaHQ6IDA7XG4gICAgICAgIGRpc3BsYXk6IGZsZXg7XG4gICAgICAgIGp1c3RpZnktY29udGVudDogY2VudGVyO1xuICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyO1xuICAgICAgICBwYWRkaW5nOiAyMCU7XG4gICAgICAgIG1hcmdpbi1sZWZ0OiAzMnB4O1xuICAgICAgICBib3gtc2l6aW5nOiBib3JkZXItYm94O1xuICAgICAgfVxuICAgIGA7XG4gIH1cbn1cblxuZGVjbGFyZSBnbG9iYWwge1xuICBpbnRlcmZhY2UgSFRNTEVsZW1lbnRUYWdOYW1lTWFwIHtcbiAgICBcImh1aS1lbmVyZ3ktdXNhZ2UtZ3JhcGgtY2FyZFwiOiBIdWlFbmVyZ3lVc2FnZUdyYXBoQ2FyZDtcbiAgfVxufVxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/panels/lovelace/cards/energy/hui-energy-usage-graph-card.ts\n");

/***/ })

}]);