"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(self["webpackChunkhome_assistant_frontend"] = self["webpackChunkhome_assistant_frontend"] || []).push([["src_data_history_ts"],{

/***/ "./src/data/history.ts":
/*!*****************************!*\
  !*** ./src/data/history.ts ***!
  \*****************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   computeHistory: function() { return /* binding */ computeHistory; },\n/* harmony export */   entityIdHistoryNeedsAttributes: function() { return /* binding */ entityIdHistoryNeedsAttributes; },\n/* harmony export */   fetchDateWS: function() { return /* binding */ fetchDateWS; },\n/* harmony export */   subscribeHistory: function() { return /* binding */ subscribeHistory; },\n/* harmony export */   subscribeHistoryStatesTimeWindow: function() { return /* binding */ subscribeHistoryStatesTimeWindow; }\n/* harmony export */ });\n/* harmony import */ var _babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @babel/runtime/helpers/toConsumableArray */ \"./node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\");\n/* harmony import */ var _babel_runtime_helpers_createForOfIteratorHelper__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @babel/runtime/helpers/createForOfIteratorHelper */ \"./node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\");\n/* harmony import */ var _babel_runtime_helpers_classCallCheck__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @babel/runtime/helpers/classCallCheck */ \"./node_modules/@babel/runtime/helpers/esm/classCallCheck.js\");\n/* harmony import */ var _babel_runtime_helpers_createClass__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @babel/runtime/helpers/createClass */ \"./node_modules/@babel/runtime/helpers/esm/createClass.js\");\n/* harmony import */ var _common_entity_compute_domain__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../common/entity/compute_domain */ \"./src/common/entity/compute_domain.ts\");\n/* harmony import */ var _common_entity_compute_state_display__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../common/entity/compute_state_display */ \"./src/common/entity/compute_state_display.ts\");\n/* harmony import */ var _common_entity_compute_state_name__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../common/entity/compute_state_name */ \"./src/common/entity/compute_state_name.ts\");\n\n\n\n\n\n\n\nvar DOMAINS_USE_LAST_UPDATED = [\"climate\", \"humidifier\", \"water_heater\"];\nvar NEED_ATTRIBUTE_DOMAINS = [\"climate\", \"humidifier\", \"input_datetime\", \"thermostat\", \"water_heater\", \"person\", \"device_tracker\"];\nvar LINE_ATTRIBUTES_TO_KEEP = [\"temperature\", \"current_temperature\", \"target_temp_low\", \"target_temp_high\", \"hvac_action\", \"humidity\", \"mode\"];\nvar entityIdHistoryNeedsAttributes = function entityIdHistoryNeedsAttributes(hass, entityId) {\n  return !hass.states[entityId] || NEED_ATTRIBUTE_DOMAINS.includes((0,_common_entity_compute_domain__WEBPACK_IMPORTED_MODULE_4__.computeDomain)(entityId));\n};\nvar fetchDateWS = function fetchDateWS(hass, startTime, endTime, entityIds) {\n  var params = {\n    type: \"history/history_during_period\",\n    start_time: startTime.toISOString(),\n    end_time: endTime.toISOString(),\n    minimal_response: true,\n    no_attributes: !entityIds.some(function (entityId) {\n      return entityIdHistoryNeedsAttributes(hass, entityId);\n    })\n  };\n  if (entityIds.length !== 0) {\n    return hass.callWS(Object.assign(Object.assign({}, params), {}, {\n      entity_ids: entityIds\n    }));\n  }\n  return hass.callWS(params);\n};\nvar subscribeHistory = function subscribeHistory(hass, callbackFunction, startTime, endTime, entityIds) {\n  var params = {\n    type: \"history/stream\",\n    entity_ids: entityIds,\n    start_time: startTime.toISOString(),\n    end_time: endTime.toISOString(),\n    minimal_response: true,\n    no_attributes: !entityIds.some(function (entityId) {\n      return entityIdHistoryNeedsAttributes(hass, entityId);\n    })\n  };\n  var stream = new HistoryStream(hass);\n  return hass.connection.subscribeMessage(function (message) {\n    return callbackFunction(stream.processMessage(message));\n  }, params);\n};\nvar HistoryStream = /*#__PURE__*/function () {\n  function HistoryStream(hass, hoursToShow) {\n    (0,_babel_runtime_helpers_classCallCheck__WEBPACK_IMPORTED_MODULE_2__[\"default\"])(this, HistoryStream);\n    this.hass = void 0;\n    this.hoursToShow = void 0;\n    this.combinedHistory = void 0;\n    this.hass = hass;\n    this.hoursToShow = hoursToShow;\n    this.combinedHistory = {};\n  }\n  (0,_babel_runtime_helpers_createClass__WEBPACK_IMPORTED_MODULE_3__[\"default\"])(HistoryStream, [{\n    key: \"processMessage\",\n    value: function processMessage(streamMessage) {\n      if (!this.combinedHistory || !Object.keys(this.combinedHistory).length) {\n        this.combinedHistory = streamMessage.states;\n        return this.combinedHistory;\n      }\n      if (!Object.keys(streamMessage.states).length) {\n        // Empty messages are still sent to\n        // indicate no more historical events\n        return this.combinedHistory;\n      }\n      var purgeBeforePythonTime = this.hoursToShow ? (new Date().getTime() - 60 * 60 * this.hoursToShow * 1000) / 1000 : undefined;\n      var newHistory = {};\n      for (var _i = 0, _Object$keys = Object.keys(this.combinedHistory); _i < _Object$keys.length; _i++) {\n        var _entityId = _Object$keys[_i];\n        newHistory[_entityId] = [];\n      }\n      for (var _i2 = 0, _Object$keys2 = Object.keys(streamMessage.states); _i2 < _Object$keys2.length; _i2++) {\n        var _entityId2 = _Object$keys2[_i2];\n        newHistory[_entityId2] = [];\n      }\n      for (var _i3 = 0, _Object$keys3 = Object.keys(newHistory); _i3 < _Object$keys3.length; _i3++) {\n        var _entityId3 = _Object$keys3[_i3];\n        if (_entityId3 in this.combinedHistory && _entityId3 in streamMessage.states) {\n          var entityCombinedHistory = this.combinedHistory[_entityId3];\n          var lastEntityCombinedHistory = entityCombinedHistory[entityCombinedHistory.length - 1];\n          newHistory[_entityId3] = entityCombinedHistory.concat(streamMessage.states[_entityId3]);\n          if (streamMessage.states[_entityId3][0].lu < lastEntityCombinedHistory.lu) {\n            // If the history is out of order we have to sort it.\n            newHistory[_entityId3] = newHistory[_entityId3].sort(function (a, b) {\n              return a.lu - b.lu;\n            });\n          }\n        } else if (_entityId3 in this.combinedHistory) {\n          newHistory[_entityId3] = this.combinedHistory[_entityId3];\n        } else {\n          newHistory[_entityId3] = streamMessage.states[_entityId3];\n        }\n        // Remove old history\n        if (purgeBeforePythonTime && _entityId3 in this.combinedHistory) {\n          var expiredStates = newHistory[_entityId3].filter(function (state) {\n            return state.lu < purgeBeforePythonTime;\n          });\n          if (!expiredStates.length) {\n            continue;\n          }\n          newHistory[_entityId3] = newHistory[_entityId3].filter(function (state) {\n            return state.lu >= purgeBeforePythonTime;\n          });\n          if (newHistory[_entityId3].length && newHistory[_entityId3][0].lu === purgeBeforePythonTime) {\n            continue;\n          }\n          // Update the first entry to the start time state\n          // as we need to preserve the start time state and\n          // only expire the rest of the history as it ages.\n          var lastExpiredState = expiredStates[expiredStates.length - 1];\n          lastExpiredState.lu = purgeBeforePythonTime;\n          newHistory[_entityId3].unshift(lastExpiredState);\n        }\n      }\n      this.combinedHistory = newHistory;\n      return this.combinedHistory;\n    }\n  }]);\n  return HistoryStream;\n}();\nvar subscribeHistoryStatesTimeWindow = function subscribeHistoryStatesTimeWindow(hass, callbackFunction, hoursToShow, entityIds) {\n  var minimalResponse = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : true;\n  var significantChangesOnly = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : true;\n  var noAttributes = arguments.length > 6 ? arguments[6] : undefined;\n  var params = {\n    type: \"history/stream\",\n    entity_ids: entityIds,\n    start_time: new Date(new Date().getTime() - 60 * 60 * hoursToShow * 1000).toISOString(),\n    minimal_response: minimalResponse,\n    significant_changes_only: significantChangesOnly,\n    no_attributes: noAttributes !== null && noAttributes !== void 0 ? noAttributes : !entityIds.some(function (entityId) {\n      return entityIdHistoryNeedsAttributes(hass, entityId);\n    })\n  };\n  var stream = new HistoryStream(hass, hoursToShow);\n  return hass.connection.subscribeMessage(function (message) {\n    return callbackFunction(stream.processMessage(message));\n  }, params);\n};\nvar equalState = function equalState(obj1, obj2) {\n  return obj1.state === obj2.state && (\n  // Only compare attributes if both states have an attributes object.\n  // When `minimal_response` is sent, only the first and last state\n  // will have attributes except for domains in DOMAINS_USE_LAST_UPDATED.\n  !obj1.attributes || !obj2.attributes || LINE_ATTRIBUTES_TO_KEEP.every(function (attr) {\n    return obj1.attributes[attr] === obj2.attributes[attr];\n  }));\n};\nvar processTimelineEntity = function processTimelineEntity(localize, language, entities, entityId, states, current_state) {\n  var data = [];\n  var first = states[0];\n  var _iterator = (0,_babel_runtime_helpers_createForOfIteratorHelper__WEBPACK_IMPORTED_MODULE_1__[\"default\"])(states),\n    _step;\n  try {\n    for (_iterator.s(); !(_step = _iterator.n()).done;) {\n      var state = _step.value;\n      if (data.length > 0 && state.s === data[data.length - 1].state) {\n        continue;\n      }\n      var currentAttributes = {};\n      if (current_state !== null && current_state !== void 0 && current_state.attributes.device_class) {\n        currentAttributes.device_class = current_state === null || current_state === void 0 ? void 0 : current_state.attributes.device_class;\n      }\n      data.push({\n        state_localize: (0,_common_entity_compute_state_display__WEBPACK_IMPORTED_MODULE_5__.computeStateDisplayFromEntityAttributes)(localize, language, entities[entityId], entityId, Object.assign(Object.assign({}, state.a || first.a), currentAttributes), state.s),\n        state: state.s,\n        // lc (last_changed) may be omitted if its the same\n        // as lu (last_updated).\n        last_changed: (state.lc ? state.lc : state.lu) * 1000\n      });\n    }\n  } catch (err) {\n    _iterator.e(err);\n  } finally {\n    _iterator.f();\n  }\n  return {\n    name: (0,_common_entity_compute_state_name__WEBPACK_IMPORTED_MODULE_6__.computeStateNameFromEntityAttributes)(entityId, (current_state === null || current_state === void 0 ? void 0 : current_state.attributes) || first.a),\n    entity_id: entityId,\n    data: data\n  };\n};\nvar processLineChartEntities = function processLineChartEntities(unit, entities, hassEntities) {\n  var data = [];\n  Object.keys(entities).forEach(function (entityId) {\n    var states = entities[entityId];\n    var first = states[0];\n    var domain = (0,_common_entity_compute_domain__WEBPACK_IMPORTED_MODULE_4__.computeDomain)(entityId);\n    var processedStates = [];\n    var _iterator2 = (0,_babel_runtime_helpers_createForOfIteratorHelper__WEBPACK_IMPORTED_MODULE_1__[\"default\"])(states),\n      _step2;\n    try {\n      for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {\n        var state = _step2.value;\n        var processedState = void 0;\n        if (DOMAINS_USE_LAST_UPDATED.includes(domain)) {\n          processedState = {\n            state: state.s,\n            last_changed: state.lu * 1000,\n            attributes: {}\n          };\n          for (var _i4 = 0, _LINE_ATTRIBUTES_TO_K = LINE_ATTRIBUTES_TO_KEEP; _i4 < _LINE_ATTRIBUTES_TO_K.length; _i4++) {\n            var attr = _LINE_ATTRIBUTES_TO_K[_i4];\n            if (attr in state.a) {\n              processedState.attributes[attr] = state.a[attr];\n            }\n          }\n        } else {\n          processedState = {\n            state: state.s,\n            // lc (last_changed) may be omitted if its the same\n            // as lu (last_updated).\n            last_changed: (state.lc ? state.lc : state.lu) * 1000,\n            attributes: {}\n          };\n        }\n        if (processedStates.length > 1 && equalState(processedState, processedStates[processedStates.length - 1]) && equalState(processedState, processedStates[processedStates.length - 2])) {\n          continue;\n        }\n        processedStates.push(processedState);\n      }\n    } catch (err) {\n      _iterator2.e(err);\n    } finally {\n      _iterator2.f();\n    }\n    var attributes = entityId in hassEntities ? hassEntities[entityId].attributes : \"friendly_name\" in first.a ? first.a : undefined;\n    data.push({\n      domain: domain,\n      name: (0,_common_entity_compute_state_name__WEBPACK_IMPORTED_MODULE_6__.computeStateNameFromEntityAttributes)(entityId, attributes || {}),\n      entity_id: entityId,\n      states: processedStates\n    });\n  });\n  return {\n    unit: unit,\n    identifier: Object.keys(entities).join(\"\"),\n    data: data\n  };\n};\nvar stateUsesUnits = function stateUsesUnits(state) {\n  return attributesHaveUnits(state.attributes);\n};\nvar attributesHaveUnits = function attributesHaveUnits(attributes) {\n  return \"unit_of_measurement\" in attributes || \"state_class\" in attributes;\n};\nvar computeHistory = function computeHistory(hass, stateHistory, localize) {\n  var lineChartDevices = {};\n  var timelineDevices = [];\n  if (!stateHistory) {\n    return {\n      line: [],\n      timeline: []\n    };\n  }\n  Object.keys(stateHistory).forEach(function (entityId) {\n    var stateInfo = stateHistory[entityId];\n    if (stateInfo.length === 0) {\n      return;\n    }\n    var currentState = entityId in hass.states ? hass.states[entityId] : undefined;\n    var stateWithUnitorStateClass = !currentState && stateInfo.find(function (state) {\n      return state.a && attributesHaveUnits(state.a);\n    });\n    var unit;\n    if (currentState && stateUsesUnits(currentState)) {\n      unit = currentState.attributes.unit_of_measurement || \" \";\n    } else if (stateWithUnitorStateClass) {\n      unit = stateWithUnitorStateClass.a.unit_of_measurement || \" \";\n    } else {\n      unit = {\n        zone: localize(\"ui.dialogs.more_info_control.zone.graph_unit\"),\n        climate: hass.config.unit_system.temperature,\n        counter: \"#\",\n        humidifier: \"%\",\n        input_number: \"#\",\n        number: \"#\",\n        water_heater: hass.config.unit_system.temperature\n      }[(0,_common_entity_compute_domain__WEBPACK_IMPORTED_MODULE_4__.computeDomain)(entityId)];\n    }\n    if (!unit) {\n      timelineDevices.push(processTimelineEntity(localize, hass.locale, hass.entities, entityId, stateInfo, currentState));\n    } else if (unit in lineChartDevices && entityId in lineChartDevices[unit]) {\n      var _lineChartDevices$uni;\n      (_lineChartDevices$uni = lineChartDevices[unit][entityId]).push.apply(_lineChartDevices$uni, (0,_babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0__[\"default\"])(stateInfo));\n    } else {\n      if (!(unit in lineChartDevices)) {\n        lineChartDevices[unit] = {};\n      }\n      lineChartDevices[unit][entityId] = stateInfo;\n    }\n  });\n  var unitStates = Object.keys(lineChartDevices).map(function (unit) {\n    return processLineChartEntities(unit, lineChartDevices[unit], hass.states);\n  });\n  return {\n    line: unitStates,\n    timeline: timelineDevices\n  };\n};//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvZGF0YS9oaXN0b3J5LnRzLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFLQTtBQUNBO0FBQ0E7QUFLQTtBQUNBO0FBU0E7QUFtRUE7QUFFQTtBQUdBO0FBRUE7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUdBO0FBQUE7QUFTQTtBQUFBO0FBQUE7QUFOQTtBQUVBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUlBO0FBQ0E7QUFFQTtBQUdBO0FBR0E7QUFDQTtBQUNBO0FBQUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBRUE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUdBO0FBUUE7QUFIQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUdBO0FBRUE7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFBQTtBQUNBO0FBRUE7QUFRQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQVdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUtBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBUUE7QUFDQTtBQUVBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQUE7QUFDQTtBQUVBO0FBQUE7QUFDQTtBQUVBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUVBO0FBRUE7QUFBQTtBQUVBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQVVBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFBQTtBQUNBO0FBR0E7QUFBQTtBQUFBO0FBQUE7QUFDQSIsInNvdXJjZXMiOlsid2VicGFjazovL2hvbWUtYXNzaXN0YW50LWZyb250ZW5kLy4vc3JjL2RhdGEvaGlzdG9yeS50cz8zNTA0Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIEhhc3NFbnRpdGllcyxcbiAgSGFzc0VudGl0eSxcbiAgSGFzc0VudGl0eUF0dHJpYnV0ZUJhc2UsXG59IGZyb20gXCJob21lLWFzc2lzdGFudC1qcy13ZWJzb2NrZXRcIjtcbmltcG9ydCB7IGNvbXB1dGVEb21haW4gfSBmcm9tIFwiLi4vY29tbW9uL2VudGl0eS9jb21wdXRlX2RvbWFpblwiO1xuaW1wb3J0IHsgY29tcHV0ZVN0YXRlRGlzcGxheUZyb21FbnRpdHlBdHRyaWJ1dGVzIH0gZnJvbSBcIi4uL2NvbW1vbi9lbnRpdHkvY29tcHV0ZV9zdGF0ZV9kaXNwbGF5XCI7XG5pbXBvcnQgeyBjb21wdXRlU3RhdGVOYW1lRnJvbUVudGl0eUF0dHJpYnV0ZXMgfSBmcm9tIFwiLi4vY29tbW9uL2VudGl0eS9jb21wdXRlX3N0YXRlX25hbWVcIjtcbmltcG9ydCB7IExvY2FsaXplRnVuYyB9IGZyb20gXCIuLi9jb21tb24vdHJhbnNsYXRpb25zL2xvY2FsaXplXCI7XG5pbXBvcnQgeyBIb21lQXNzaXN0YW50IH0gZnJvbSBcIi4uL3R5cGVzXCI7XG5pbXBvcnQgeyBGcm9udGVuZExvY2FsZURhdGEgfSBmcm9tIFwiLi90cmFuc2xhdGlvblwiO1xuXG5jb25zdCBET01BSU5TX1VTRV9MQVNUX1VQREFURUQgPSBbXCJjbGltYXRlXCIsIFwiaHVtaWRpZmllclwiLCBcIndhdGVyX2hlYXRlclwiXTtcbmNvbnN0IE5FRURfQVRUUklCVVRFX0RPTUFJTlMgPSBbXG4gIFwiY2xpbWF0ZVwiLFxuICBcImh1bWlkaWZpZXJcIixcbiAgXCJpbnB1dF9kYXRldGltZVwiLFxuICBcInRoZXJtb3N0YXRcIixcbiAgXCJ3YXRlcl9oZWF0ZXJcIixcbiAgXCJwZXJzb25cIixcbiAgXCJkZXZpY2VfdHJhY2tlclwiLFxuXTtcbmNvbnN0IExJTkVfQVRUUklCVVRFU19UT19LRUVQID0gW1xuICBcInRlbXBlcmF0dXJlXCIsXG4gIFwiY3VycmVudF90ZW1wZXJhdHVyZVwiLFxuICBcInRhcmdldF90ZW1wX2xvd1wiLFxuICBcInRhcmdldF90ZW1wX2hpZ2hcIixcbiAgXCJodmFjX2FjdGlvblwiLFxuICBcImh1bWlkaXR5XCIsXG4gIFwibW9kZVwiLFxuXTtcblxuZXhwb3J0IGludGVyZmFjZSBMaW5lQ2hhcnRTdGF0ZSB7XG4gIHN0YXRlOiBzdHJpbmc7XG4gIGxhc3RfY2hhbmdlZDogbnVtYmVyO1xuICBhdHRyaWJ1dGVzPzogUmVjb3JkPHN0cmluZywgYW55Pjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBMaW5lQ2hhcnRFbnRpdHkge1xuICBkb21haW46IHN0cmluZztcbiAgbmFtZTogc3RyaW5nO1xuICBlbnRpdHlfaWQ6IHN0cmluZztcbiAgc3RhdGVzOiBMaW5lQ2hhcnRTdGF0ZVtdO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIExpbmVDaGFydFVuaXQge1xuICB1bml0OiBzdHJpbmc7XG4gIGlkZW50aWZpZXI6IHN0cmluZztcbiAgZGF0YTogTGluZUNoYXJ0RW50aXR5W107XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVGltZWxpbmVTdGF0ZSB7XG4gIHN0YXRlX2xvY2FsaXplOiBzdHJpbmc7XG4gIHN0YXRlOiBzdHJpbmc7XG4gIGxhc3RfY2hhbmdlZDogbnVtYmVyO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFRpbWVsaW5lRW50aXR5IHtcbiAgbmFtZTogc3RyaW5nO1xuICBlbnRpdHlfaWQ6IHN0cmluZztcbiAgZGF0YTogVGltZWxpbmVTdGF0ZVtdO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEhpc3RvcnlSZXN1bHQge1xuICBsaW5lOiBMaW5lQ2hhcnRVbml0W107XG4gIHRpbWVsaW5lOiBUaW1lbGluZUVudGl0eVtdO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEhpc3RvcnlTdGF0ZXMge1xuICBbZW50aXR5SWQ6IHN0cmluZ106IEVudGl0eUhpc3RvcnlTdGF0ZVtdO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEVudGl0eUhpc3RvcnlTdGF0ZSB7XG4gIC8qKiBzdGF0ZSAqL1xuICBzOiBzdHJpbmc7XG4gIC8qKiBhdHRyaWJ1dGVzICovXG4gIGE6IHsgW2tleTogc3RyaW5nXTogYW55IH07XG4gIC8qKiBsYXN0X2NoYW5nZWQ7IGlmIHNldCwgYWxzbyBhcHBsaWVzIHRvIGx1ICovXG4gIGxjOiBudW1iZXI7XG4gIC8qKiBsYXN0X3VwZGF0ZWQgKi9cbiAgbHU6IG51bWJlcjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBIaXN0b3J5U3RyZWFtTWVzc2FnZSB7XG4gIHN0YXRlczogSGlzdG9yeVN0YXRlcztcbiAgc3RhcnRfdGltZT86IG51bWJlcjsgLy8gU3RhcnQgdGltZSBvZiB0aGlzIGhpc3RvcmljYWwgY2h1bmtcbiAgZW5kX3RpbWU/OiBudW1iZXI7IC8vIEVuZCB0aW1lIG9mIHRoaXMgaGlzdG9yaWNhbCBjaHVua1xufVxuXG5leHBvcnQgY29uc3QgZW50aXR5SWRIaXN0b3J5TmVlZHNBdHRyaWJ1dGVzID0gKFxuICBoYXNzOiBIb21lQXNzaXN0YW50LFxuICBlbnRpdHlJZDogc3RyaW5nXG4pID0+XG4gICFoYXNzLnN0YXRlc1tlbnRpdHlJZF0gfHxcbiAgTkVFRF9BVFRSSUJVVEVfRE9NQUlOUy5pbmNsdWRlcyhjb21wdXRlRG9tYWluKGVudGl0eUlkKSk7XG5cbmV4cG9ydCBjb25zdCBmZXRjaERhdGVXUyA9IChcbiAgaGFzczogSG9tZUFzc2lzdGFudCxcbiAgc3RhcnRUaW1lOiBEYXRlLFxuICBlbmRUaW1lOiBEYXRlLFxuICBlbnRpdHlJZHM6IHN0cmluZ1tdXG4pID0+IHtcbiAgY29uc3QgcGFyYW1zID0ge1xuICAgIHR5cGU6IFwiaGlzdG9yeS9oaXN0b3J5X2R1cmluZ19wZXJpb2RcIixcbiAgICBzdGFydF90aW1lOiBzdGFydFRpbWUudG9JU09TdHJpbmcoKSxcbiAgICBlbmRfdGltZTogZW5kVGltZS50b0lTT1N0cmluZygpLFxuICAgIG1pbmltYWxfcmVzcG9uc2U6IHRydWUsXG4gICAgbm9fYXR0cmlidXRlczogIWVudGl0eUlkcy5zb21lKChlbnRpdHlJZCkgPT5cbiAgICAgIGVudGl0eUlkSGlzdG9yeU5lZWRzQXR0cmlidXRlcyhoYXNzLCBlbnRpdHlJZClcbiAgICApLFxuICB9O1xuICBpZiAoZW50aXR5SWRzLmxlbmd0aCAhPT0gMCkge1xuICAgIHJldHVybiBoYXNzLmNhbGxXUzxIaXN0b3J5U3RhdGVzPih7IC4uLnBhcmFtcywgZW50aXR5X2lkczogZW50aXR5SWRzIH0pO1xuICB9XG4gIHJldHVybiBoYXNzLmNhbGxXUzxIaXN0b3J5U3RhdGVzPihwYXJhbXMpO1xufTtcblxuZXhwb3J0IGNvbnN0IHN1YnNjcmliZUhpc3RvcnkgPSAoXG4gIGhhc3M6IEhvbWVBc3Npc3RhbnQsXG4gIGNhbGxiYWNrRnVuY3Rpb246IChkYXRhOiBIaXN0b3J5U3RhdGVzKSA9PiB2b2lkLFxuICBzdGFydFRpbWU6IERhdGUsXG4gIGVuZFRpbWU6IERhdGUsXG4gIGVudGl0eUlkczogc3RyaW5nW11cbik6IFByb21pc2U8KCkgPT4gUHJvbWlzZTx2b2lkPj4gPT4ge1xuICBjb25zdCBwYXJhbXMgPSB7XG4gICAgdHlwZTogXCJoaXN0b3J5L3N0cmVhbVwiLFxuICAgIGVudGl0eV9pZHM6IGVudGl0eUlkcyxcbiAgICBzdGFydF90aW1lOiBzdGFydFRpbWUudG9JU09TdHJpbmcoKSxcbiAgICBlbmRfdGltZTogZW5kVGltZS50b0lTT1N0cmluZygpLFxuICAgIG1pbmltYWxfcmVzcG9uc2U6IHRydWUsXG4gICAgbm9fYXR0cmlidXRlczogIWVudGl0eUlkcy5zb21lKChlbnRpdHlJZCkgPT5cbiAgICAgIGVudGl0eUlkSGlzdG9yeU5lZWRzQXR0cmlidXRlcyhoYXNzLCBlbnRpdHlJZClcbiAgICApLFxuICB9O1xuICBjb25zdCBzdHJlYW0gPSBuZXcgSGlzdG9yeVN0cmVhbShoYXNzKTtcbiAgcmV0dXJuIGhhc3MuY29ubmVjdGlvbi5zdWJzY3JpYmVNZXNzYWdlPEhpc3RvcnlTdHJlYW1NZXNzYWdlPihcbiAgICAobWVzc2FnZSkgPT4gY2FsbGJhY2tGdW5jdGlvbihzdHJlYW0ucHJvY2Vzc01lc3NhZ2UobWVzc2FnZSkpLFxuICAgIHBhcmFtc1xuICApO1xufTtcblxuY2xhc3MgSGlzdG9yeVN0cmVhbSB7XG4gIGhhc3M6IEhvbWVBc3Npc3RhbnQ7XG5cbiAgaG91cnNUb1Nob3c/OiBudW1iZXI7XG5cbiAgY29tYmluZWRIaXN0b3J5OiBIaXN0b3J5U3RhdGVzO1xuXG4gIGNvbnN0cnVjdG9yKGhhc3M6IEhvbWVBc3Npc3RhbnQsIGhvdXJzVG9TaG93PzogbnVtYmVyKSB7XG4gICAgdGhpcy5oYXNzID0gaGFzcztcbiAgICB0aGlzLmhvdXJzVG9TaG93ID0gaG91cnNUb1Nob3c7XG4gICAgdGhpcy5jb21iaW5lZEhpc3RvcnkgPSB7fTtcbiAgfVxuXG4gIHByb2Nlc3NNZXNzYWdlKHN0cmVhbU1lc3NhZ2U6IEhpc3RvcnlTdHJlYW1NZXNzYWdlKTogSGlzdG9yeVN0YXRlcyB7XG4gICAgaWYgKCF0aGlzLmNvbWJpbmVkSGlzdG9yeSB8fCAhT2JqZWN0LmtleXModGhpcy5jb21iaW5lZEhpc3RvcnkpLmxlbmd0aCkge1xuICAgICAgdGhpcy5jb21iaW5lZEhpc3RvcnkgPSBzdHJlYW1NZXNzYWdlLnN0YXRlcztcbiAgICAgIHJldHVybiB0aGlzLmNvbWJpbmVkSGlzdG9yeTtcbiAgICB9XG4gICAgaWYgKCFPYmplY3Qua2V5cyhzdHJlYW1NZXNzYWdlLnN0YXRlcykubGVuZ3RoKSB7XG4gICAgICAvLyBFbXB0eSBtZXNzYWdlcyBhcmUgc3RpbGwgc2VudCB0b1xuICAgICAgLy8gaW5kaWNhdGUgbm8gbW9yZSBoaXN0b3JpY2FsIGV2ZW50c1xuICAgICAgcmV0dXJuIHRoaXMuY29tYmluZWRIaXN0b3J5O1xuICAgIH1cbiAgICBjb25zdCBwdXJnZUJlZm9yZVB5dGhvblRpbWUgPSB0aGlzLmhvdXJzVG9TaG93XG4gICAgICA/IChuZXcgRGF0ZSgpLmdldFRpbWUoKSAtIDYwICogNjAgKiB0aGlzLmhvdXJzVG9TaG93ICogMTAwMCkgLyAxMDAwXG4gICAgICA6IHVuZGVmaW5lZDtcbiAgICBjb25zdCBuZXdIaXN0b3J5OiBIaXN0b3J5U3RhdGVzID0ge307XG4gICAgZm9yIChjb25zdCBlbnRpdHlJZCBvZiBPYmplY3Qua2V5cyh0aGlzLmNvbWJpbmVkSGlzdG9yeSkpIHtcbiAgICAgIG5ld0hpc3RvcnlbZW50aXR5SWRdID0gW107XG4gICAgfVxuICAgIGZvciAoY29uc3QgZW50aXR5SWQgb2YgT2JqZWN0LmtleXMoc3RyZWFtTWVzc2FnZS5zdGF0ZXMpKSB7XG4gICAgICBuZXdIaXN0b3J5W2VudGl0eUlkXSA9IFtdO1xuICAgIH1cbiAgICBmb3IgKGNvbnN0IGVudGl0eUlkIG9mIE9iamVjdC5rZXlzKG5ld0hpc3RvcnkpKSB7XG4gICAgICBpZiAoXG4gICAgICAgIGVudGl0eUlkIGluIHRoaXMuY29tYmluZWRIaXN0b3J5ICYmXG4gICAgICAgIGVudGl0eUlkIGluIHN0cmVhbU1lc3NhZ2Uuc3RhdGVzXG4gICAgICApIHtcbiAgICAgICAgY29uc3QgZW50aXR5Q29tYmluZWRIaXN0b3J5ID0gdGhpcy5jb21iaW5lZEhpc3RvcnlbZW50aXR5SWRdO1xuICAgICAgICBjb25zdCBsYXN0RW50aXR5Q29tYmluZWRIaXN0b3J5ID1cbiAgICAgICAgICBlbnRpdHlDb21iaW5lZEhpc3RvcnlbZW50aXR5Q29tYmluZWRIaXN0b3J5Lmxlbmd0aCAtIDFdO1xuICAgICAgICBuZXdIaXN0b3J5W2VudGl0eUlkXSA9IGVudGl0eUNvbWJpbmVkSGlzdG9yeS5jb25jYXQoXG4gICAgICAgICAgc3RyZWFtTWVzc2FnZS5zdGF0ZXNbZW50aXR5SWRdXG4gICAgICAgICk7XG4gICAgICAgIGlmIChcbiAgICAgICAgICBzdHJlYW1NZXNzYWdlLnN0YXRlc1tlbnRpdHlJZF1bMF0ubHUgPCBsYXN0RW50aXR5Q29tYmluZWRIaXN0b3J5Lmx1XG4gICAgICAgICkge1xuICAgICAgICAgIC8vIElmIHRoZSBoaXN0b3J5IGlzIG91dCBvZiBvcmRlciB3ZSBoYXZlIHRvIHNvcnQgaXQuXG4gICAgICAgICAgbmV3SGlzdG9yeVtlbnRpdHlJZF0gPSBuZXdIaXN0b3J5W2VudGl0eUlkXS5zb3J0KFxuICAgICAgICAgICAgKGEsIGIpID0+IGEubHUgLSBiLmx1XG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmIChlbnRpdHlJZCBpbiB0aGlzLmNvbWJpbmVkSGlzdG9yeSkge1xuICAgICAgICBuZXdIaXN0b3J5W2VudGl0eUlkXSA9IHRoaXMuY29tYmluZWRIaXN0b3J5W2VudGl0eUlkXTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG5ld0hpc3RvcnlbZW50aXR5SWRdID0gc3RyZWFtTWVzc2FnZS5zdGF0ZXNbZW50aXR5SWRdO1xuICAgICAgfVxuICAgICAgLy8gUmVtb3ZlIG9sZCBoaXN0b3J5XG4gICAgICBpZiAocHVyZ2VCZWZvcmVQeXRob25UaW1lICYmIGVudGl0eUlkIGluIHRoaXMuY29tYmluZWRIaXN0b3J5KSB7XG4gICAgICAgIGNvbnN0IGV4cGlyZWRTdGF0ZXMgPSBuZXdIaXN0b3J5W2VudGl0eUlkXS5maWx0ZXIoXG4gICAgICAgICAgKHN0YXRlKSA9PiBzdGF0ZS5sdSA8IHB1cmdlQmVmb3JlUHl0aG9uVGltZVxuICAgICAgICApO1xuICAgICAgICBpZiAoIWV4cGlyZWRTdGF0ZXMubGVuZ3RoKSB7XG4gICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cbiAgICAgICAgbmV3SGlzdG9yeVtlbnRpdHlJZF0gPSBuZXdIaXN0b3J5W2VudGl0eUlkXS5maWx0ZXIoXG4gICAgICAgICAgKHN0YXRlKSA9PiBzdGF0ZS5sdSA+PSBwdXJnZUJlZm9yZVB5dGhvblRpbWVcbiAgICAgICAgKTtcbiAgICAgICAgaWYgKFxuICAgICAgICAgIG5ld0hpc3RvcnlbZW50aXR5SWRdLmxlbmd0aCAmJlxuICAgICAgICAgIG5ld0hpc3RvcnlbZW50aXR5SWRdWzBdLmx1ID09PSBwdXJnZUJlZm9yZVB5dGhvblRpbWVcbiAgICAgICAgKSB7XG4gICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cbiAgICAgICAgLy8gVXBkYXRlIHRoZSBmaXJzdCBlbnRyeSB0byB0aGUgc3RhcnQgdGltZSBzdGF0ZVxuICAgICAgICAvLyBhcyB3ZSBuZWVkIHRvIHByZXNlcnZlIHRoZSBzdGFydCB0aW1lIHN0YXRlIGFuZFxuICAgICAgICAvLyBvbmx5IGV4cGlyZSB0aGUgcmVzdCBvZiB0aGUgaGlzdG9yeSBhcyBpdCBhZ2VzLlxuICAgICAgICBjb25zdCBsYXN0RXhwaXJlZFN0YXRlID0gZXhwaXJlZFN0YXRlc1tleHBpcmVkU3RhdGVzLmxlbmd0aCAtIDFdO1xuICAgICAgICBsYXN0RXhwaXJlZFN0YXRlLmx1ID0gcHVyZ2VCZWZvcmVQeXRob25UaW1lO1xuICAgICAgICBuZXdIaXN0b3J5W2VudGl0eUlkXS51bnNoaWZ0KGxhc3RFeHBpcmVkU3RhdGUpO1xuICAgICAgfVxuICAgIH1cbiAgICB0aGlzLmNvbWJpbmVkSGlzdG9yeSA9IG5ld0hpc3Rvcnk7XG4gICAgcmV0dXJuIHRoaXMuY29tYmluZWRIaXN0b3J5O1xuICB9XG59XG5cbmV4cG9ydCBjb25zdCBzdWJzY3JpYmVIaXN0b3J5U3RhdGVzVGltZVdpbmRvdyA9IChcbiAgaGFzczogSG9tZUFzc2lzdGFudCxcbiAgY2FsbGJhY2tGdW5jdGlvbjogKGRhdGE6IEhpc3RvcnlTdGF0ZXMpID0+IHZvaWQsXG4gIGhvdXJzVG9TaG93OiBudW1iZXIsXG4gIGVudGl0eUlkczogc3RyaW5nW10sXG4gIG1pbmltYWxSZXNwb25zZSA9IHRydWUsXG4gIHNpZ25pZmljYW50Q2hhbmdlc09ubHkgPSB0cnVlLFxuICBub0F0dHJpYnV0ZXM/OiBib29sZWFuXG4pOiBQcm9taXNlPCgpID0+IFByb21pc2U8dm9pZD4+ID0+IHtcbiAgY29uc3QgcGFyYW1zID0ge1xuICAgIHR5cGU6IFwiaGlzdG9yeS9zdHJlYW1cIixcbiAgICBlbnRpdHlfaWRzOiBlbnRpdHlJZHMsXG4gICAgc3RhcnRfdGltZTogbmV3IERhdGUoXG4gICAgICBuZXcgRGF0ZSgpLmdldFRpbWUoKSAtIDYwICogNjAgKiBob3Vyc1RvU2hvdyAqIDEwMDBcbiAgICApLnRvSVNPU3RyaW5nKCksXG4gICAgbWluaW1hbF9yZXNwb25zZTogbWluaW1hbFJlc3BvbnNlLFxuICAgIHNpZ25pZmljYW50X2NoYW5nZXNfb25seTogc2lnbmlmaWNhbnRDaGFuZ2VzT25seSxcbiAgICBub19hdHRyaWJ1dGVzOlxuICAgICAgbm9BdHRyaWJ1dGVzID8/XG4gICAgICAhZW50aXR5SWRzLnNvbWUoKGVudGl0eUlkKSA9PlxuICAgICAgICBlbnRpdHlJZEhpc3RvcnlOZWVkc0F0dHJpYnV0ZXMoaGFzcywgZW50aXR5SWQpXG4gICAgICApLFxuICB9O1xuICBjb25zdCBzdHJlYW0gPSBuZXcgSGlzdG9yeVN0cmVhbShoYXNzLCBob3Vyc1RvU2hvdyk7XG4gIHJldHVybiBoYXNzLmNvbm5lY3Rpb24uc3Vic2NyaWJlTWVzc2FnZTxIaXN0b3J5U3RyZWFtTWVzc2FnZT4oXG4gICAgKG1lc3NhZ2UpID0+IGNhbGxiYWNrRnVuY3Rpb24oc3RyZWFtLnByb2Nlc3NNZXNzYWdlKG1lc3NhZ2UpKSxcbiAgICBwYXJhbXNcbiAgKTtcbn07XG5cbmNvbnN0IGVxdWFsU3RhdGUgPSAob2JqMTogTGluZUNoYXJ0U3RhdGUsIG9iajI6IExpbmVDaGFydFN0YXRlKSA9PlxuICBvYmoxLnN0YXRlID09PSBvYmoyLnN0YXRlICYmXG4gIC8vIE9ubHkgY29tcGFyZSBhdHRyaWJ1dGVzIGlmIGJvdGggc3RhdGVzIGhhdmUgYW4gYXR0cmlidXRlcyBvYmplY3QuXG4gIC8vIFdoZW4gYG1pbmltYWxfcmVzcG9uc2VgIGlzIHNlbnQsIG9ubHkgdGhlIGZpcnN0IGFuZCBsYXN0IHN0YXRlXG4gIC8vIHdpbGwgaGF2ZSBhdHRyaWJ1dGVzIGV4Y2VwdCBmb3IgZG9tYWlucyBpbiBET01BSU5TX1VTRV9MQVNUX1VQREFURUQuXG4gICghb2JqMS5hdHRyaWJ1dGVzIHx8XG4gICAgIW9iajIuYXR0cmlidXRlcyB8fFxuICAgIExJTkVfQVRUUklCVVRFU19UT19LRUVQLmV2ZXJ5KFxuICAgICAgKGF0dHIpID0+IG9iajEuYXR0cmlidXRlcyFbYXR0cl0gPT09IG9iajIuYXR0cmlidXRlcyFbYXR0cl1cbiAgICApKTtcblxuY29uc3QgcHJvY2Vzc1RpbWVsaW5lRW50aXR5ID0gKFxuICBsb2NhbGl6ZTogTG9jYWxpemVGdW5jLFxuICBsYW5ndWFnZTogRnJvbnRlbmRMb2NhbGVEYXRhLFxuICBlbnRpdGllczogSG9tZUFzc2lzdGFudFtcImVudGl0aWVzXCJdLFxuICBlbnRpdHlJZDogc3RyaW5nLFxuICBzdGF0ZXM6IEVudGl0eUhpc3RvcnlTdGF0ZVtdLFxuICBjdXJyZW50X3N0YXRlOiBIYXNzRW50aXR5IHwgdW5kZWZpbmVkXG4pOiBUaW1lbGluZUVudGl0eSA9PiB7XG4gIGNvbnN0IGRhdGE6IFRpbWVsaW5lU3RhdGVbXSA9IFtdO1xuICBjb25zdCBmaXJzdDogRW50aXR5SGlzdG9yeVN0YXRlID0gc3RhdGVzWzBdO1xuICBmb3IgKGNvbnN0IHN0YXRlIG9mIHN0YXRlcykge1xuICAgIGlmIChkYXRhLmxlbmd0aCA+IDAgJiYgc3RhdGUucyA9PT0gZGF0YVtkYXRhLmxlbmd0aCAtIDFdLnN0YXRlKSB7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG5cbiAgICBjb25zdCBjdXJyZW50QXR0cmlidXRlczogSGFzc0VudGl0eUF0dHJpYnV0ZUJhc2UgPSB7fTtcbiAgICBpZiAoY3VycmVudF9zdGF0ZT8uYXR0cmlidXRlcy5kZXZpY2VfY2xhc3MpIHtcbiAgICAgIGN1cnJlbnRBdHRyaWJ1dGVzLmRldmljZV9jbGFzcyA9IGN1cnJlbnRfc3RhdGU/LmF0dHJpYnV0ZXMuZGV2aWNlX2NsYXNzO1xuICAgIH1cblxuICAgIGRhdGEucHVzaCh7XG4gICAgICBzdGF0ZV9sb2NhbGl6ZTogY29tcHV0ZVN0YXRlRGlzcGxheUZyb21FbnRpdHlBdHRyaWJ1dGVzKFxuICAgICAgICBsb2NhbGl6ZSxcbiAgICAgICAgbGFuZ3VhZ2UsXG4gICAgICAgIGVudGl0aWVzW2VudGl0eUlkXSxcbiAgICAgICAgZW50aXR5SWQsXG4gICAgICAgIHtcbiAgICAgICAgICAuLi4oc3RhdGUuYSB8fCBmaXJzdC5hKSxcbiAgICAgICAgICAuLi5jdXJyZW50QXR0cmlidXRlcyxcbiAgICAgICAgfSxcbiAgICAgICAgc3RhdGUuc1xuICAgICAgKSxcbiAgICAgIHN0YXRlOiBzdGF0ZS5zLFxuICAgICAgLy8gbGMgKGxhc3RfY2hhbmdlZCkgbWF5IGJlIG9taXR0ZWQgaWYgaXRzIHRoZSBzYW1lXG4gICAgICAvLyBhcyBsdSAobGFzdF91cGRhdGVkKS5cbiAgICAgIGxhc3RfY2hhbmdlZDogKHN0YXRlLmxjID8gc3RhdGUubGMgOiBzdGF0ZS5sdSkgKiAxMDAwLFxuICAgIH0pO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBuYW1lOiBjb21wdXRlU3RhdGVOYW1lRnJvbUVudGl0eUF0dHJpYnV0ZXMoXG4gICAgICBlbnRpdHlJZCxcbiAgICAgIGN1cnJlbnRfc3RhdGU/LmF0dHJpYnV0ZXMgfHwgZmlyc3QuYVxuICAgICksXG4gICAgZW50aXR5X2lkOiBlbnRpdHlJZCxcbiAgICBkYXRhLFxuICB9O1xufTtcblxuY29uc3QgcHJvY2Vzc0xpbmVDaGFydEVudGl0aWVzID0gKFxuICB1bml0LFxuICBlbnRpdGllczogSGlzdG9yeVN0YXRlcyxcbiAgaGFzc0VudGl0aWVzOiBIYXNzRW50aXRpZXNcbik6IExpbmVDaGFydFVuaXQgPT4ge1xuICBjb25zdCBkYXRhOiBMaW5lQ2hhcnRFbnRpdHlbXSA9IFtdO1xuXG4gIE9iamVjdC5rZXlzKGVudGl0aWVzKS5mb3JFYWNoKChlbnRpdHlJZCkgPT4ge1xuICAgIGNvbnN0IHN0YXRlcyA9IGVudGl0aWVzW2VudGl0eUlkXTtcbiAgICBjb25zdCBmaXJzdDogRW50aXR5SGlzdG9yeVN0YXRlID0gc3RhdGVzWzBdO1xuICAgIGNvbnN0IGRvbWFpbiA9IGNvbXB1dGVEb21haW4oZW50aXR5SWQpO1xuICAgIGNvbnN0IHByb2Nlc3NlZFN0YXRlczogTGluZUNoYXJ0U3RhdGVbXSA9IFtdO1xuXG4gICAgZm9yIChjb25zdCBzdGF0ZSBvZiBzdGF0ZXMpIHtcbiAgICAgIGxldCBwcm9jZXNzZWRTdGF0ZTogTGluZUNoYXJ0U3RhdGU7XG5cbiAgICAgIGlmIChET01BSU5TX1VTRV9MQVNUX1VQREFURUQuaW5jbHVkZXMoZG9tYWluKSkge1xuICAgICAgICBwcm9jZXNzZWRTdGF0ZSA9IHtcbiAgICAgICAgICBzdGF0ZTogc3RhdGUucyxcbiAgICAgICAgICBsYXN0X2NoYW5nZWQ6IHN0YXRlLmx1ICogMTAwMCxcbiAgICAgICAgICBhdHRyaWJ1dGVzOiB7fSxcbiAgICAgICAgfTtcblxuICAgICAgICBmb3IgKGNvbnN0IGF0dHIgb2YgTElORV9BVFRSSUJVVEVTX1RPX0tFRVApIHtcbiAgICAgICAgICBpZiAoYXR0ciBpbiBzdGF0ZS5hKSB7XG4gICAgICAgICAgICBwcm9jZXNzZWRTdGF0ZS5hdHRyaWJ1dGVzIVthdHRyXSA9IHN0YXRlLmFbYXR0cl07XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBwcm9jZXNzZWRTdGF0ZSA9IHtcbiAgICAgICAgICBzdGF0ZTogc3RhdGUucyxcbiAgICAgICAgICAvLyBsYyAobGFzdF9jaGFuZ2VkKSBtYXkgYmUgb21pdHRlZCBpZiBpdHMgdGhlIHNhbWVcbiAgICAgICAgICAvLyBhcyBsdSAobGFzdF91cGRhdGVkKS5cbiAgICAgICAgICBsYXN0X2NoYW5nZWQ6IChzdGF0ZS5sYyA/IHN0YXRlLmxjIDogc3RhdGUubHUpICogMTAwMCxcbiAgICAgICAgICBhdHRyaWJ1dGVzOiB7fSxcbiAgICAgICAgfTtcbiAgICAgIH1cblxuICAgICAgaWYgKFxuICAgICAgICBwcm9jZXNzZWRTdGF0ZXMubGVuZ3RoID4gMSAmJlxuICAgICAgICBlcXVhbFN0YXRlKFxuICAgICAgICAgIHByb2Nlc3NlZFN0YXRlLFxuICAgICAgICAgIHByb2Nlc3NlZFN0YXRlc1twcm9jZXNzZWRTdGF0ZXMubGVuZ3RoIC0gMV1cbiAgICAgICAgKSAmJlxuICAgICAgICBlcXVhbFN0YXRlKHByb2Nlc3NlZFN0YXRlLCBwcm9jZXNzZWRTdGF0ZXNbcHJvY2Vzc2VkU3RhdGVzLmxlbmd0aCAtIDJdKVxuICAgICAgKSB7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuXG4gICAgICBwcm9jZXNzZWRTdGF0ZXMucHVzaChwcm9jZXNzZWRTdGF0ZSk7XG4gICAgfVxuXG4gICAgY29uc3QgYXR0cmlidXRlcyA9XG4gICAgICBlbnRpdHlJZCBpbiBoYXNzRW50aXRpZXNcbiAgICAgICAgPyBoYXNzRW50aXRpZXNbZW50aXR5SWRdLmF0dHJpYnV0ZXNcbiAgICAgICAgOiBcImZyaWVuZGx5X25hbWVcIiBpbiBmaXJzdC5hXG4gICAgICAgID8gZmlyc3QuYVxuICAgICAgICA6IHVuZGVmaW5lZDtcblxuICAgIGRhdGEucHVzaCh7XG4gICAgICBkb21haW4sXG4gICAgICBuYW1lOiBjb21wdXRlU3RhdGVOYW1lRnJvbUVudGl0eUF0dHJpYnV0ZXMoZW50aXR5SWQsIGF0dHJpYnV0ZXMgfHwge30pLFxuICAgICAgZW50aXR5X2lkOiBlbnRpdHlJZCxcbiAgICAgIHN0YXRlczogcHJvY2Vzc2VkU3RhdGVzLFxuICAgIH0pO1xuICB9KTtcblxuICByZXR1cm4ge1xuICAgIHVuaXQsXG4gICAgaWRlbnRpZmllcjogT2JqZWN0LmtleXMoZW50aXRpZXMpLmpvaW4oXCJcIiksXG4gICAgZGF0YSxcbiAgfTtcbn07XG5cbmNvbnN0IHN0YXRlVXNlc1VuaXRzID0gKHN0YXRlOiBIYXNzRW50aXR5KSA9PlxuICBhdHRyaWJ1dGVzSGF2ZVVuaXRzKHN0YXRlLmF0dHJpYnV0ZXMpO1xuXG5jb25zdCBhdHRyaWJ1dGVzSGF2ZVVuaXRzID0gKGF0dHJpYnV0ZXM6IHsgW2tleTogc3RyaW5nXTogYW55IH0pID0+XG4gIFwidW5pdF9vZl9tZWFzdXJlbWVudFwiIGluIGF0dHJpYnV0ZXMgfHwgXCJzdGF0ZV9jbGFzc1wiIGluIGF0dHJpYnV0ZXM7XG5cbmV4cG9ydCBjb25zdCBjb21wdXRlSGlzdG9yeSA9IChcbiAgaGFzczogSG9tZUFzc2lzdGFudCxcbiAgc3RhdGVIaXN0b3J5OiBIaXN0b3J5U3RhdGVzLFxuICBsb2NhbGl6ZTogTG9jYWxpemVGdW5jXG4pOiBIaXN0b3J5UmVzdWx0ID0+IHtcbiAgY29uc3QgbGluZUNoYXJ0RGV2aWNlczogeyBbdW5pdDogc3RyaW5nXTogSGlzdG9yeVN0YXRlcyB9ID0ge307XG4gIGNvbnN0IHRpbWVsaW5lRGV2aWNlczogVGltZWxpbmVFbnRpdHlbXSA9IFtdO1xuICBpZiAoIXN0YXRlSGlzdG9yeSkge1xuICAgIHJldHVybiB7IGxpbmU6IFtdLCB0aW1lbGluZTogW10gfTtcbiAgfVxuICBPYmplY3Qua2V5cyhzdGF0ZUhpc3RvcnkpLmZvckVhY2goKGVudGl0eUlkKSA9PiB7XG4gICAgY29uc3Qgc3RhdGVJbmZvID0gc3RhdGVIaXN0b3J5W2VudGl0eUlkXTtcbiAgICBpZiAoc3RhdGVJbmZvLmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IGN1cnJlbnRTdGF0ZSA9XG4gICAgICBlbnRpdHlJZCBpbiBoYXNzLnN0YXRlcyA/IGhhc3Muc3RhdGVzW2VudGl0eUlkXSA6IHVuZGVmaW5lZDtcbiAgICBjb25zdCBzdGF0ZVdpdGhVbml0b3JTdGF0ZUNsYXNzID1cbiAgICAgICFjdXJyZW50U3RhdGUgJiZcbiAgICAgIHN0YXRlSW5mby5maW5kKChzdGF0ZSkgPT4gc3RhdGUuYSAmJiBhdHRyaWJ1dGVzSGF2ZVVuaXRzKHN0YXRlLmEpKTtcblxuICAgIGxldCB1bml0OiBzdHJpbmcgfCB1bmRlZmluZWQ7XG5cbiAgICBpZiAoY3VycmVudFN0YXRlICYmIHN0YXRlVXNlc1VuaXRzKGN1cnJlbnRTdGF0ZSkpIHtcbiAgICAgIHVuaXQgPSBjdXJyZW50U3RhdGUuYXR0cmlidXRlcy51bml0X29mX21lYXN1cmVtZW50IHx8IFwiIFwiO1xuICAgIH0gZWxzZSBpZiAoc3RhdGVXaXRoVW5pdG9yU3RhdGVDbGFzcykge1xuICAgICAgdW5pdCA9IHN0YXRlV2l0aFVuaXRvclN0YXRlQ2xhc3MuYS51bml0X29mX21lYXN1cmVtZW50IHx8IFwiIFwiO1xuICAgIH0gZWxzZSB7XG4gICAgICB1bml0ID0ge1xuICAgICAgICB6b25lOiBsb2NhbGl6ZShcInVpLmRpYWxvZ3MubW9yZV9pbmZvX2NvbnRyb2wuem9uZS5ncmFwaF91bml0XCIpLFxuICAgICAgICBjbGltYXRlOiBoYXNzLmNvbmZpZy51bml0X3N5c3RlbS50ZW1wZXJhdHVyZSxcbiAgICAgICAgY291bnRlcjogXCIjXCIsXG4gICAgICAgIGh1bWlkaWZpZXI6IFwiJVwiLFxuICAgICAgICBpbnB1dF9udW1iZXI6IFwiI1wiLFxuICAgICAgICBudW1iZXI6IFwiI1wiLFxuICAgICAgICB3YXRlcl9oZWF0ZXI6IGhhc3MuY29uZmlnLnVuaXRfc3lzdGVtLnRlbXBlcmF0dXJlLFxuICAgICAgfVtjb21wdXRlRG9tYWluKGVudGl0eUlkKV07XG4gICAgfVxuXG4gICAgaWYgKCF1bml0KSB7XG4gICAgICB0aW1lbGluZURldmljZXMucHVzaChcbiAgICAgICAgcHJvY2Vzc1RpbWVsaW5lRW50aXR5KFxuICAgICAgICAgIGxvY2FsaXplLFxuICAgICAgICAgIGhhc3MubG9jYWxlLFxuICAgICAgICAgIGhhc3MuZW50aXRpZXMsXG4gICAgICAgICAgZW50aXR5SWQsXG4gICAgICAgICAgc3RhdGVJbmZvLFxuICAgICAgICAgIGN1cnJlbnRTdGF0ZVxuICAgICAgICApXG4gICAgICApO1xuICAgIH0gZWxzZSBpZiAodW5pdCBpbiBsaW5lQ2hhcnREZXZpY2VzICYmIGVudGl0eUlkIGluIGxpbmVDaGFydERldmljZXNbdW5pdF0pIHtcbiAgICAgIGxpbmVDaGFydERldmljZXNbdW5pdF1bZW50aXR5SWRdLnB1c2goLi4uc3RhdGVJbmZvKTtcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKCEodW5pdCBpbiBsaW5lQ2hhcnREZXZpY2VzKSkge1xuICAgICAgICBsaW5lQ2hhcnREZXZpY2VzW3VuaXRdID0ge307XG4gICAgICB9XG4gICAgICBsaW5lQ2hhcnREZXZpY2VzW3VuaXRdW2VudGl0eUlkXSA9IHN0YXRlSW5mbztcbiAgICB9XG4gIH0pO1xuXG4gIGNvbnN0IHVuaXRTdGF0ZXMgPSBPYmplY3Qua2V5cyhsaW5lQ2hhcnREZXZpY2VzKS5tYXAoKHVuaXQpID0+XG4gICAgcHJvY2Vzc0xpbmVDaGFydEVudGl0aWVzKHVuaXQsIGxpbmVDaGFydERldmljZXNbdW5pdF0sIGhhc3Muc3RhdGVzKVxuICApO1xuXG4gIHJldHVybiB7IGxpbmU6IHVuaXRTdGF0ZXMsIHRpbWVsaW5lOiB0aW1lbGluZURldmljZXMgfTtcbn07XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/data/history.ts\n");

/***/ })

}]);